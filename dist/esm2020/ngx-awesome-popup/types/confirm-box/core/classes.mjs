import { Subject } from 'rxjs';
import { map, take } from 'rxjs/operators';
import { DataControl, dispatch } from '../../../core/global-classes';
import { ServiceLocator } from '../../../locator.service';
import { ConfirmBoxConfigService } from './confirm-box-config.service';
import { ConfirmBoxService } from './confirm-box-service';
export class ConfirmBoxInitializer {
    constructor() {
        this.confirmBoxCarrier = new ConfirmBoxCarrier();
    }
    openConfirmBox$() {
        return this.confirmBoxCarrier.openConfirmBox$().pipe(map(resp => {
            const basicConfirmBoxResponse = new ConfirmBoxResponse();
            const dataControl = new DataControl();
            dataControl.copyValuesFrom(resp, basicConfirmBoxResponse);
            return basicConfirmBoxResponse;
        }), take(1));
    }
    setButtons(_Buttons) {
        this.confirmBoxCarrier.setButtons(_Buttons);
    }
    setConfig(_ConfirmBoxCoreConfig) {
        this.confirmBoxCarrier.setConfig(_ConfirmBoxCoreConfig);
    }
    setDispatch(_Title, _Message = null) {
        this.confirmBoxCarrier.setTitle(_Title);
        this.confirmBoxCarrier.setMessage(_Message);
    }
    setTitle(_Title) {
        this.confirmBoxCarrier.setTitle(_Title);
    }
    setMessage(_Message) {
        this.confirmBoxCarrier.setMessage(_Message);
    }
    setButtonLabels(_Confirm, _Decline) {
        this.confirmBoxCarrier.setButtonLabels(_Confirm, _Decline);
    }
}
export class ConfirmBoxResponse extends DataControl {
    constructor() {
        super();
        this.success = null;
        this.clickedButtonID = null;
    }
    setSuccess(_IsSuccess) {
        this.success = _IsSuccess;
    }
    setClickedButtonID(_ClickedButtonID) {
        this.clickedButtonID = _ClickedButtonID;
    }
}
export class ConfirmBoxeventsController {
    constructor(entityUniqueID) {
        this.entityUniqueID = entityUniqueID;
        this._afterClosed = new Subject();
        this._onButtonClick = new Subject();
        this._buttonList = new Subject();
        this.afterClosed$ = this._afterClosed.asObservable();
        this.onButtonClick$ = this._onButtonClick.asObservable();
        this.buttonList$ = this._buttonList.asObservable();
    }
    close(_Response) {
        const response = _Response ? _Response : this.defaultResponse;
        this._afterClosed.next(response);
    }
    onButtonClick(_Button) {
        this.defaultResponse.setClickedButtonID(_Button.ID);
        this._onButtonClick.next(_Button);
    }
    setButtonList(_ButtonList) {
        this._buttonList.next(_ButtonList);
    }
    setDefaultResponse(_Response) {
        this.defaultResponse = _Response;
    }
}
export class ConfirmBoxDefaultResponse extends ConfirmBoxResponse {
    constructor() {
        super();
        this.confirmBoxBelonging = null;
    }
    setBelonging(_ConfirmBoxBelonging) {
        this.confirmBoxBelonging = _ConfirmBoxBelonging;
    }
}
export class ConfirmBoxCarrier {
    constructor() {
        this.confirmBoxBelonging = new ConfirmBoxBelonging();
    }
    setButtons(_Buttons) {
        if (_Buttons.length) {
            this.confirmBoxBelonging.buttons = _Buttons;
        }
    }
    setTitle(_Title) {
        this.confirmBoxBelonging.dispatch.title = _Title;
    }
    setMessage(_Message) {
        this.confirmBoxBelonging.dispatch.message = _Message;
    }
    setButtonLabels(_Confirm, _Decline) {
        this.confirmBoxBelonging.confirmBoxCoreConfig.confirmLabel = _Confirm;
        this.confirmBoxBelonging.confirmBoxCoreConfig.declineLabel = _Decline;
    }
    setConfig(_ConfirmBoxBelonging) {
        const dataControl = new DataControl();
        dataControl.copyValuesFrom(_ConfirmBoxBelonging, this.confirmBoxBelonging.confirmBoxCoreConfig);
    }
    openConfirmBox$() {
        const service = ServiceLocator.injector.get(ConfirmBoxService);
        const confirmBoxController = service.open(this.confirmBoxBelonging);
        return confirmBoxController.afterClosed$;
    }
}
export class ConfirmBoxSettings {
    constructor() {
        this.buttons = [];
        this.confirmBoxCoreConfig = new confirmBoxCoreConfig();
        this.dispatch = new dispatch();
    }
}
export class ConfirmBoxCustomStyles {
    constructor() {
        this.titleCSS = null;
        this.textCSS = null;
        this.buttonSectionCSS = null;
        this.buttonCSS = null;
        this.wrapperCSS = null;
    }
}
export class confirmBoxCoreConfig {
    constructor() {
        this.width = null;
        this.height = null;
        this.buttonPosition = null;
        this.layoutType = null;
        this.dispatch = null;
        this.confirmLabel = null;
        this.declineLabel = null;
        this.disableIcon = null;
        this.allowHtmlMessage = null;
        this.animationIn = null;
        this.animationOut = null;
        this.customStyles = new ConfirmBoxCustomStyles();
        this.iconStyleClass = null;
    }
}
export class ConfirmBoxBelonging extends ConfirmBoxSettings {
    constructor() {
        super();
        this.entityUniqueID = 'C' + Math.random().toString(36).substr(2, 9);
        this.eventsController = new ConfirmBoxeventsController(this.entityUniqueID);
        const ConfirmBoxCoreConfigurator = ServiceLocator.injector.get(ConfirmBoxConfigService);
        const baseSettings = new ConfirmBoxSettings();
        const dataControl = new DataControl();
        dataControl.copyValuesFrom(ConfirmBoxCoreConfigurator.productionConfig.confirmBoxCoreConfig, baseSettings.confirmBoxCoreConfig);
        this.confirmBoxCoreConfig = baseSettings.confirmBoxCoreConfig;
        this.buttons = ConfirmBoxCoreConfigurator.productionConfig.buttons.slice();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xhc3Nlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL25neC1hd2Vzb21lLXBvcHVwL3R5cGVzL2NvbmZpcm0tYm94L2NvcmUvY2xhc3Nlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUVyRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDMUQsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDdkUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFVMUQsTUFBTSxPQUFPLHFCQUFxQjtJQUloQztRQUZRLHNCQUFpQixHQUFzQixJQUFJLGlCQUFpQixFQUFFLENBQUM7SUFFeEQsQ0FBQztJQUVoQixlQUFlO1FBQ2IsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsZUFBZSxFQUFFLENBQUMsSUFBSSxDQUNsRCxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDVCxNQUFNLHVCQUF1QixHQUFHLElBQUksa0JBQWtCLEVBQUUsQ0FBQztZQUN6RCxNQUFNLFdBQVcsR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFDO1lBQ3RDLFdBQVcsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLHVCQUF1QixDQUFDLENBQUM7WUFDMUQsT0FBTyx1QkFBdUIsQ0FBQztRQUNqQyxDQUFDLENBQUMsRUFDRixJQUFJLENBQUMsQ0FBQyxDQUFDLENBQ1IsQ0FBQztJQUNKLENBQUM7SUFFRCxVQUFVLENBQUMsUUFBbUI7UUFDNUIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMs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QUFDLGdCQUFnQixHQUFHLElBQUksMEJBQTBCLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQzVFLE1BQU0sMEJBQTBCLEdBQTRCLGNBQWMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDakgsTUFBTSxZQUFZLEdBQUcsSUFBSSxrQkFBa0IsRUFBRSxDQUFDO1FBQzlDLE1BQU0sV0FBVyxHQUFHLElBQUksV0FBVyxFQUFFLENBQUM7UUFDdEMsV0FBVyxDQUFDLGNBQWMsQ0FBQywwQkFBMEIsQ0FBQyxnQkFBZ0IsQ0FBQyxvQkFBb0IsRUFBRSxZQUFZLENBQUMsb0JBQW9CLENBQUMsQ0FBQztRQUNoSSxJQUFJLENBQUMsb0JBQW9CLEdBQUcsWUFBWSxDQUFDLG9CQUFvQixDQUFDO1FBQzlELElBQUksQ0FBQyxPQUFPLEdBQUcsMEJBQTBCLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQzdFLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgdGFrZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEFwcGVhcmFuY2VBbmltYXRpb24sIERpYWxvZ0xheW91dERpc3BsYXksIERpc2FwcGVhcmFuY2VBbmltYXRpb24sIFZlcnRpY2FsUG9zaXRpb24gfSBmcm9tICcuLi8uLi8uLi9jb3JlL2VudW1zJztcbmltcG9ydCB7IERhdGFDb250cm9sLCBkaXNwYXRjaCB9IGZyb20gJy4uLy4uLy4uL2NvcmUvZ2xvYmFsLWNsYXNzZXMnO1xuaW1wb3J0IHsgSUJ1dHRvbiwgSURpc3BhdGNoIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9nbG9iYWwtaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBTZXJ2aWNlTG9jYXRvciB9IGZyb20gJy4uLy4uLy4uL2xvY2F0b3Iuc2VydmljZSc7XG5pbXBvcnQgeyBDb25maXJtQm94Q29uZmlnU2VydmljZSB9IGZyb20gJy4vY29uZmlybS1ib3gtY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29uZmlybUJveFNlcnZpY2UgfSBmcm9tICcuL2NvbmZpcm0tYm94LXNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgSUNvbmZpcm1Cb3hCZWxvbmdpbmcsXG4gIElDb25maXJtQm94Q29yZUNvbmZpZyxcbiAgSUNvbmZpcm1Cb3hDdXN0b21TdHlsZXMsXG4gIElDb25maXJtQm94UHVibGljUmVzcG9uc2UsXG4gIElDb25maXJtQm94UmVzcG9uc2UsXG4gIElQcml2YXRlUmVzcG9uc2VNZXJnZWRcbn0gZnJvbSAnLi9pbnRlcmZhY2VzJztcblxuZXhwb3J0IGNsYXNzIENvbmZpcm1Cb3hJbml0aWFsaXplciB7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgcHJpdmF0ZSBjb25maXJtQm94Q2FycmllcjogQ29uZmlybUJveENhcnJpZXIgPSBuZXcgQ29uZmlybUJveENhcnJpZXIoKTtcblxuICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgb3BlbkNvbmZpcm1Cb3gkKCk6IE9ic2VydmFibGU8SUNvbmZpcm1Cb3hQdWJsaWNSZXNwb25zZT4ge1xuICAgIHJldHVybiB0aGlzLmNvbmZpcm1Cb3hDYXJyaWVyLm9wZW5Db25maXJtQm94JCgpLnBpcGUoXG4gICAgICBtYXAocmVzcCA9PiB7XG4gICAgICAgIGNvbnN0IGJhc2ljQ29uZmlybUJveFJlc3BvbnNlID0gbmV3IENvbmZpcm1Cb3hSZXNwb25zZSgpO1xuICAgICAgICBjb25zdCBkYXRhQ29udHJvbCA9IG5ldyBEYXRhQ29udHJvbCgpO1xuICAgICAgICBkYXRhQ29udHJvbC5jb3B5VmFsdWVzRnJvbShyZXNwLCBiYXNpY0NvbmZpcm1Cb3hSZXNwb25zZSk7XG4gICAgICAgIHJldHVybiBiYXNpY0NvbmZpcm1Cb3hSZXNwb25zZTtcbiAgICAgIH0pLFxuICAgICAgdGFrZSgxKVxuICAgICk7XG4gIH1cblxuICBzZXRCdXR0b25zKF9CdXR0b25zOiBJQnV0dG9uW10pOiB2b2lkIHtcbiAgICB0aGlzLmNvbmZpcm1Cb3hDYXJyaWVyLnNldEJ1dHRvbnMoX0J1dHRvbnMpO1xuICB9XG5cbiAgc2V0Q29uZmlnKF9Db25maXJtQm94Q29yZUNvbmZpZzogSUNvbmZpcm1Cb3hDb3JlQ29uZmlnKTogdm9pZCB7XG4gICAgdGhpcy5jb25maXJtQm94Q2Fycmllci5zZXRDb25maWcoX0NvbmZpcm1Cb3hDb3JlQ29uZmlnKTtcbiAgfVxuXG4gIHNldERpc3BhdGNoKF9UaXRsZTogc3RyaW5nLCBfTWVzc2FnZTogc3RyaW5nID0gbnVsbCk6IHZvaWQge1xuICAgIHRoaXMuY29uZmlybUJveENhcnJpZXIuc2V0VGl0bGUoX1RpdGxlKTtcbiAgICB0aGlzLmNvbmZpcm1Cb3hDYXJyaWVyLnNldE1lc3NhZ2UoX01lc3NhZ2UpO1xuICB9XG5cbiAgc2V0VGl0bGUoX1RpdGxlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmNvbmZpcm1Cb3hDYXJyaWVyLnNldFRpdGxlKF9UaXRsZSk7XG4gIH1cblxuICBzZXRNZXNzYWdlKF9NZXNzYWdlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmNvbmZpcm1Cb3hDYXJyaWVyLnNldE1lc3NhZ2UoX01lc3NhZ2UpO1xuICB9XG5cbiAgc2V0QnV0dG9uTGFiZWxzKF9Db25maXJtOiBzdHJpbmcsIF9EZWNsaW5lPzogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5jb25maXJtQm94Q2Fycmllci5zZXRCdXR0b25MYWJlbHMoX0NvbmZpcm0sIF9EZWNsaW5lKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ29uZmlybUJveFJlc3BvbnNlIGV4dGVuZHMgRGF0YUNvbnRyb2wgaW1wbGVtZW50cyBJQ29uZmlybUJveFJlc3BvbnNlLCBJQ29uZmlybUJveFB1YmxpY1Jlc3BvbnNlIHtcbiAgLy8gcHJpdmF0ZSBSZXNwb25zZTogRGlhbG9nUHJlcGFyZVJlc3BvbnNlICAgICAgICAgICAgPSBuZXcgRGlhbG9nUHJlcGFyZVJlc3BvbnNlKCk7XG5cbiAgc3VjY2VzczogYm9vbGVhbiA9IG51bGw7XG4gIGNsaWNrZWRCdXR0b25JRDogc3RyaW5nID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgc2V0U3VjY2VzcyhfSXNTdWNjZXNzOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpcy5zdWNjZXNzID0gX0lzU3VjY2VzcztcbiAgfVxuXG4gIHNldENsaWNrZWRCdXR0b25JRChfQ2xpY2tlZEJ1dHRvbklEKTogdm9pZCB7XG4gICAgdGhpcy5jbGlja2VkQnV0dG9uSUQgPSBfQ2xpY2tlZEJ1dHRvbklEO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDb25maXJtQm94ZXZlbnRzQ29udHJvbGxlciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgX2FmdGVyQ2xvc2VkOiBTdWJqZWN0PElQcml2YXRlUmVzcG9uc2VNZXJnZWQ+ID0gbmV3IFN1YmplY3Q8SVByaXZhdGVSZXNwb25zZU1lcmdlZD4oKTtcbiAgcHJpdmF0ZSByZWFkb25seSBfb25CdXR0b25DbGljazogU3ViamVjdDxJQnV0dG9uPiA9IG5ldyBTdWJqZWN0PElCdXR0b24+KCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgX2J1dHRvbkxpc3Q6IFN1YmplY3Q8SUJ1dHRvbltdPiA9IG5ldyBTdWJqZWN0PElCdXR0b25bXT4oKTtcbiAgZGVmYXVsdFJlc3BvbnNlOiBJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkO1xuICBhZnRlckNsb3NlZCQ6IE9ic2VydmFibGU8SVByaXZhdGVSZXNwb25zZU1lcmdlZD4gPSB0aGlzLl9hZnRlckNsb3NlZC5hc09ic2VydmFibGUoKTtcbiAgb25CdXR0b25DbGljayQ6IE9ic2VydmFibGU8SUJ1dHRvbj4gPSB0aGlzLl9vbkJ1dHRvbkNsaWNrLmFzT2JzZXJ2YWJsZSgpO1xuICBidXR0b25MaXN0JDogT2JzZXJ2YWJsZTxJQnV0dG9uW10+ID0gdGhpcy5fYnV0dG9uTGlzdC5hc09ic2VydmFibGUoKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVudGl0eVVuaXF1ZUlEOiBzdHJpbmcpIHt9XG5cbiAgY2xvc2UoX1Jlc3BvbnNlPzogSVByaXZhdGVSZXNwb25zZU1lcmdlZCk6IHZvaWQge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gX1Jlc3BvbnNlID8gX1Jlc3BvbnNlIDogdGhpcy5kZWZhdWx0UmVzcG9uc2U7XG4gICAgdGhpcy5fYWZ0ZXJDbG9zZWQubmV4dChyZXNwb25zZSk7XG4gIH1cblxuICBvbkJ1dHRvbkNsaWNrKF9CdXR0b246IElCdXR0b24pOiB2b2lkIHtcbiAgICB0aGlzLmRlZmF1bHRSZXNwb25zZS5zZXRDbGlja2VkQnV0dG9uSUQoX0J1dHRvbi5JRCk7XG4gICAgdGhpcy5fb25CdXR0b25DbGljay5uZXh0KF9CdXR0b24pO1xuICB9XG5cbiAgc2V0QnV0dG9uTGlzdChfQnV0dG9uTGlzdDogSUJ1dHRvbltdKTogdm9pZCB7XG4gICAgdGhpcy5fYnV0dG9uTGlzdC5uZXh0KF9CdXR0b25MaXN0KTtcbiAgfVxuXG4gIHNldERlZmF1bHRSZXNwb25zZShfUmVzcG9uc2U6IElQcml2YXRlUmVzcG9uc2VNZXJnZWQpOiB2b2lkIHtcbiAgICB0aGlzLmRlZmF1bHRSZXNwb25zZSA9IF9SZXNwb25zZTtcbiAgfVxufVxuXG4vLyBlbmRyZWdpb25cblxuZXhwb3J0IGNsYXNzIENvbmZpcm1Cb3hEZWZhdWx0UmVzcG9uc2UgZXh0ZW5kcyBDb25maXJtQm94UmVzcG9uc2UgaW1wbGVtZW50cyBJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkIHtcbiAgY29uZmlybUJveEJlbG9uZ2luZzogQ29uZmlybUJveEJlbG9uZ2luZyA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIHNldEJlbG9uZ2luZyhfQ29uZmlybUJveEJlbG9uZ2luZyk6IHZvaWQge1xuICAgIHRoaXMuY29uZmlybUJveEJlbG9uZ2luZyA9IF9Db25maXJtQm94QmVsb25naW5nO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDb25maXJtQm94Q2FycmllciB7XG4gIGNvbmZpcm1Cb3hCZWxvbmdpbmc6IENvbmZpcm1Cb3hCZWxvbmdpbmcgPSBuZXcgQ29uZmlybUJveEJlbG9uZ2luZygpO1xuXG4gIGNvbnN0cnVjdG9yKCkge31cblxuICBzZXRCdXR0b25zKF9CdXR0b25zOiBJQnV0dG9uW10pOiB2b2lkIHtcbiAgICBpZiAoX0J1dHRvbnMubGVuZ3RoKSB7XG4gICAgICB0aGlzLmNvbmZpcm1Cb3hCZWxvbmdpbmcuYnV0dG9ucyA9IF9CdXR0b25zO1xuICAgIH1cbiAgfVxuXG4gIHNldFRpdGxlKF9UaXRsZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5jb25maXJtQm94QmVsb25naW5nLmRpc3BhdGNoLnRpdGxlID0gX1RpdGxlO1xuICB9XG5cbiAgc2V0TWVzc2FnZShfTWVzc2FnZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5jb25maXJtQm94QmVsb25naW5nLmRpc3BhdGNoLm1lc3NhZ2UgPSBfTWVzc2FnZTtcbiAgfVxuXG4gIHNldEJ1dHRvbkxhYmVscyhfQ29uZmlybTogc3RyaW5nLCBfRGVjbGluZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5jb25maXJtQm94QmVsb25naW5nLmNvbmZpcm1Cb3hDb3JlQ29uZmlnLmNvbmZpcm1MYWJlbCA9IF9Db25maXJtO1xuICAgIHRoaXMuY29uZmlybUJveEJlbG9uZ2luZy5jb25maXJtQm94Q29yZUNvbmZpZy5kZWNsaW5lTGFiZWwgPSBfRGVjbGluZTtcbiAgfVxuXG4gIHNldENvbmZpZyhfQ29uZmlybUJveEJlbG9uZ2luZzogSUNvbmZpcm1Cb3hDb3JlQ29uZmlnKTogdm9pZCB7XG4gICAgLy8gcmVnaW9uICoqKiBsb2NhbCBVc2VyQ29uZmlnIChkZWZpbmVkIG9uIHBsYWNlIHdoZXJlIGRpYWxvZyBpcyBjYWxsZWQpICoqKlxuICAgIGNvbnN0IGRhdGFDb250cm9sID0gbmV3IERhdGFDb250cm9sKCk7XG4gICAgZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20oX0NvbmZpcm1Cb3hCZWxvbmdpbmcsIHRoaXMuY29uZmlybUJveEJlbG9uZ2luZy5jb25maXJtQm94Q29yZUNvbmZpZyk7XG4gICAgLy8gZW5kcmVnaW9uXG4gIH1cblxuICBvcGVuQ29uZmlybUJveCQoKTogT2JzZXJ2YWJsZTxJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPiB7XG4gICAgY29uc3Qgc2VydmljZTogQ29uZmlybUJveFNlcnZpY2UgPSBTZXJ2aWNlTG9jYXRvci5pbmplY3Rvci5nZXQoQ29uZmlybUJveFNlcnZpY2UpO1xuICAgIGNvbnN0IGNvbmZpcm1Cb3hDb250cm9sbGVyID0gc2VydmljZS5vcGVuKHRoaXMuY29uZmlybUJveEJlbG9uZ2luZyk7XG4gICAgcmV0dXJuIGNvbmZpcm1Cb3hDb250cm9sbGVyLmFmdGVyQ2xvc2VkJDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ29uZmlybUJveFNldHRpbmdzIHtcbiAgYnV0dG9uczogSUJ1dHRvbltdID0gW107XG4gIGNvbmZpcm1Cb3hDb3JlQ29uZmlnOiBJQ29uZmlybUJveENvcmVDb25maWcgPSBuZXcgY29uZmlybUJveENvcmVDb25maWcoKTtcbiAgZGlzcGF0Y2g6IElEaXNwYXRjaCA9IG5ldyBkaXNwYXRjaCgpO1xufVxuXG5leHBvcnQgY2xhc3MgQ29uZmlybUJveEN1c3RvbVN0eWxlcyBpbXBsZW1lbnRzIElDb25maXJtQm94Q3VzdG9tU3R5bGVzIHtcbiAgdGl0bGVDU1M6IHN0cmluZyA9IG51bGw7XG4gIHRleHRDU1M6IHN0cmluZyA9IG51bGw7XG4gIGJ1dHRvblNlY3Rpb25DU1M6IHN0cmluZyA9IG51bGw7XG4gIGJ1dHRvbkNTUzogc3RyaW5nID0gbnVsbDtcbiAgd3JhcHBlckNTUzogc3RyaW5nID0gbnVsbDtcbn1cblxuZXhwb3J0IGNsYXNzIGNvbmZpcm1Cb3hDb3JlQ29uZmlnIGltcGxlbWVudHMgSUNvbmZpcm1Cb3hDb3JlQ29uZmlnIHtcbiAgd2lkdGg6IHN0cmluZyA9IG51bGw7XG4gIGhlaWdodDogc3RyaW5nID0gbnVsbDtcbiAgYnV0dG9uUG9zaXRpb246IFZlcnRpY2FsUG9zaXRpb24gPSBudWxsO1xuICBsYXlvdXRUeXBlOiBEaWFsb2dMYXlvdXREaXNwbGF5ID0gbnVsbDtcbiAgZGlzcGF0Y2g6IElEaXNwYXRjaCA9IG51bGw7XG4gIGNvbmZpcm1MYWJlbDogc3RyaW5nID0gbnVsbDtcbiAgZGVjbGluZUxhYmVsOiBzdHJpbmcgPSBudWxsO1xuICBkaXNhYmxlSWNvbjogYm9vbGVhbiA9IG51bGw7XG4gIGFsbG93SHRtbE1lc3NhZ2U6IGJvb2xlYW4gPSBudWxsO1xuICBhbmltYXRpb25JbjogQXBwZWFyYW5jZUFuaW1hdGlvbiA9IG51bGw7XG4gIGFuaW1hdGlvbk91dDogRGlzYXBwZWFyYW5jZUFuaW1hdGlvbiA9IG51bGw7XG4gIGN1c3RvbVN0eWxlczogQ29uZmlybUJveEN1c3RvbVN0eWxlcyA9IG5ldyBDb25maXJtQm94Q3VzdG9tU3R5bGVzKCk7XG4gIGljb25TdHlsZUNsYXNzOiBzdHJpbmcgPSBudWxsO1xufVxuXG5leHBvcnQgY2xhc3MgQ29uZmlybUJveEJlbG9uZ2luZyBleHRlbmRzIENvbmZpcm1Cb3hTZXR0aW5ncyBpbXBsZW1lbnRzIElDb25maXJtQm94QmVsb25naW5nIHtcbiAgZW50aXR5VW5pcXVlSUQ6IHN0cmluZyA9ICdDJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KTtcbiAgZXZlbnRzQ29udHJvbGxlcjogQ29uZmlybUJveGV2ZW50c0NvbnRyb2xsZXI7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmV2ZW50c0NvbnRyb2xsZXIgPSBuZXcgQ29uZmlybUJveGV2ZW50c0NvbnRyb2xsZXIodGhpcy5lbnRpdHlVbmlxdWVJRCk7XG4gICAgY29uc3QgQ29uZmlybUJveENvcmVDb25maWd1cmF0b3I6IENvbmZpcm1Cb3hDb25maWdTZXJ2aWNlID0gU2VydmljZUxvY2F0b3IuaW5qZWN0b3IuZ2V0KENvbmZpcm1Cb3hDb25maWdTZXJ2aWNlKTtcbiAgICBjb25zdCBiYXNlU2V0dGluZ3MgPSBuZXcgQ29uZmlybUJveFNldHRpbmdzKCk7XG4gICAgY29uc3QgZGF0YUNvbnRyb2wgPSBuZXcgRGF0YUNvbnRyb2woKTtcbiAgICBkYXRhQ29udHJvbC5jb3B5VmFsdWVzRnJvbShDb25maXJtQm94Q29yZUNvbmZpZ3VyYXRvci5wcm9kdWN0aW9uQ29uZmlnLmNvbmZpcm1Cb3hDb3JlQ29uZmlnLCBiYXNlU2V0dGluZ3MuY29uZmlybUJveENvcmVDb25maWcpO1xuICAgIHRoaXMuY29uZmlybUJveENvcmVDb25maWcgPSBiYXNlU2V0dGluZ3MuY29uZmlybUJveENvcmVDb25maWc7XG4gICAgdGhpcy5idXR0b25zID0gQ29uZmlybUJveENvcmVDb25maWd1cmF0b3IucHJvZHVjdGlvbkNvbmZpZy5idXR0b25zLnNsaWNlKCk7XG4gIH1cbn1cbiJdfQ==