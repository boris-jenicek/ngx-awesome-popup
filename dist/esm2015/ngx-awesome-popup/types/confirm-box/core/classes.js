import { Subject } from 'rxjs';
import { map, take } from 'rxjs/operators';
import { DataControl, Dispatch } from '../../../core/global-classes';
import { ServiceLocator } from '../../../locator.service';
import { ConfirmBoxConfigService } from './confirm-box-config.service';
import { ConfirmBoxService } from './confirm-box-service';
export class ConfirmBoxInitializer {
    constructor() {
        /** @internal */
        this.confirmBoxCarrier = new ConfirmBoxCarrier();
    }
    openConfirmBox$() {
        return this.confirmBoxCarrier.openConfirmBox$().pipe(map(resp => {
            const basicConfirmBoxResponse = new ConfirmBoxResponse();
            const dataControl = new DataControl();
            dataControl.copyValuesFrom(resp, basicConfirmBoxResponse);
            return basicConfirmBoxResponse;
        }), take(1));
    }
    setButtons(_Buttons) {
        this.confirmBoxCarrier.setButtons(_Buttons);
    }
    setConfig(_ConfirmBoxCoreConfig) {
        this.confirmBoxCarrier.setConfig(_ConfirmBoxCoreConfig);
    }
    setDispatch(_Title, _Message = null) {
        this.confirmBoxCarrier.setTitle(_Title);
        this.confirmBoxCarrier.setMessage(_Message);
    }
    setTitle(_Title) {
        this.confirmBoxCarrier.setTitle(_Title);
    }
    setMessage(_Message) {
        this.confirmBoxCarrier.setMessage(_Message);
    }
    setButtonLabels(_Confirm, _Decline) {
        this.confirmBoxCarrier.setButtonLabels(_Confirm, _Decline);
    }
}
export class ConfirmBoxResponse extends DataControl {
    constructor() {
        super();
        // private Response: DialogPrepareResponse            = new DialogPrepareResponse();
        this.Success = null;
        this.ClickedButtonID = null;
    }
    setSuccess(_IsSuccess) {
        this.Success = _IsSuccess;
    }
    setClickedButtonID(_ClickedButtonID) {
        this.ClickedButtonID = _ClickedButtonID;
    }
}
export class ConfirmBoxEventsController {
    constructor(EntityUniqueID) {
        this.EntityUniqueID = EntityUniqueID;
        this._afterClosed = new Subject();
        this.afterClosed$ = this._afterClosed.asObservable();
        this._onButtonClick = new Subject();
        this.onButtonClick$ = this._onButtonClick.asObservable();
        this._buttonList = new Subject();
        this.buttonList$ = this._buttonList.asObservable();
    }
    close(_Response) {
        const response = _Response ? _Response : this.defaultResponse;
        this._afterClosed.next(response);
    }
    onButtonClick(_Button) {
        this.defaultResponse.setClickedButtonID(_Button.ID);
        this._onButtonClick.next(_Button);
    }
    setButtonList(_ButtonList) {
        this._buttonList.next(_ButtonList);
    }
    setDefaultResponse(_Response) {
        this.defaultResponse = _Response;
    }
}
// endregion
export class ConfirmBoxDefaultResponse extends ConfirmBoxResponse {
    constructor() {
        super();
        this.confirmBoxBelonging = null;
    }
    setBelonging(_ConfirmBoxBelonging) {
        this.confirmBoxBelonging = _ConfirmBoxBelonging;
    }
}
export class ConfirmBoxCarrier {
    constructor() {
        this.confirmBoxBelonging = new ConfirmBoxBelonging();
    }
    setButtons(_Buttons) {
        if (_Buttons.length) {
            this.confirmBoxBelonging.Buttons = _Buttons;
        }
    }
    setTitle(_Title) {
        this.confirmBoxBelonging.Dispatch.Title = _Title;
    }
    setMessage(_Message) {
        this.confirmBoxBelonging.Dispatch.Message = _Message;
    }
    setButtonLabels(_Confirm, _Decline) {
        this.confirmBoxBelonging.ConfirmBoxCoreConfig.ConfirmLabel = _Confirm;
        this.confirmBoxBelonging.ConfirmBoxCoreConfig.DeclineLabel = _Decline;
    }
    setConfig(_ConfirmBoxBelonging) {
        // region *** local UserConfig (defined on place where dialog is called) ***
        const dataControl = new DataControl();
        dataControl.copyValuesFrom(_ConfirmBoxBelonging, this.confirmBoxBelonging.ConfirmBoxCoreConfig);
        // endregion
    }
    openConfirmBox$() {
        const service = ServiceLocator.injector.get(ConfirmBoxService);
        const confirmBoxController = service.open(this.confirmBoxBelonging);
        return confirmBoxController.afterClosed$;
    }
}
export class ConfirmBoxSettings {
    constructor() {
        this.Buttons = [];
        this.ConfirmBoxCoreConfig = new ConfirmBoxCoreConfig();
        this.Dispatch = new Dispatch();
    }
}
export class ConfirmBoxCoreConfig {
    constructor() {
        this.Width = null;
        this.Height = null;
        this.ButtonPosition = null;
        this.LayoutType = null;
        this.Dispatch = null;
        this.ConfirmLabel = null;
        this.DeclineLabel = null;
        this.DisableIcon = null;
        this.AllowHTMLMessage = null;
        this.AnimationIn = null;
        this.AnimationOut = null;
    }
}
export class ConfirmBoxBelonging extends ConfirmBoxSettings {
    constructor() {
        super();
        this.EntityUniqueID = 'C' + Math.random().toString(36).substr(2, 9);
        this.EventsController = new ConfirmBoxEventsController(this.EntityUniqueID);
        const ConfirmBoxCoreConfigurator = ServiceLocator.injector.get(ConfirmBoxConfigService);
        const baseSettings = new ConfirmBoxSettings();
        const dataControl = new DataControl();
        dataControl.copyValuesFrom(ConfirmBoxCoreConfigurator.productionConfig.ConfirmBoxCoreConfig, baseSettings.ConfirmBoxCoreConfig);
        this.ConfirmBoxCoreConfig = baseSettings.ConfirmBoxCoreConfig;
        this.Buttons = ConfirmBoxCoreConfigurator.productionConfig.Buttons.slice();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xhc3Nlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL25neC1hd2Vzb21lLXBvcHVwL3R5cGVzL2NvbmZpcm0tYm94L2NvcmUvY2xhc3Nlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFPM0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUVyRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDMUQsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDdkUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFTMUQsTUFBTSxPQUFPLHFCQUFxQjtJQUloQztRQUhBLGdCQUFnQjtRQUNSLHNCQUFpQixHQUFzQixJQUFJLGlCQUFpQixFQUFFLENBQUM7SUFFeEQsQ0FBQztJQUVoQixlQUFlO1FBQ2IsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsZUFBZSxFQUFFLENBQUMsSUFBSSxDQUNsRCxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDVCxNQUFNLHVCQUF1QixHQUFHLElBQUksa0JBQWtCLEVBQUUsQ0FBQztZQUN6RCxNQUFNLFdBQVcsR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFDO1lBQ3RDLFdBQVcsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLHVCQUF1QixDQUFDLENBQUM7WUFDMUQsT0FBTyx1QkFBdUIsQ0FBQztRQUNqQyxDQUFDLENBQUMsRUFDRixJQUFJLENBQUMsQ0FBQyxDQUFDLENBQ1IsQ0FBQztJQUNKLENBQUM7SUFFRCxVQUFVLENBQUMsUUFBbUI7UUFDNUIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FB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V0FBVyxHQUFHLElBQUksV0FBVyxFQUFFLENBQUM7UUFDdEMsV0FBVyxDQUFDLGNBQWMsQ0FDeEIsMEJBQTBCLENBQUMsZ0JBQWdCLENBQUMsb0JBQW9CLEVBQ2hFLFlBQVksQ0FBQyxvQkFBb0IsQ0FDbEMsQ0FBQztRQUNGLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxZQUFZLENBQUMsb0JBQW9CLENBQUM7UUFDOUQsSUFBSSxDQUFDLE9BQU8sR0FBRywwQkFBMEIsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDN0UsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwLCB0YWtlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtcbiAgQXBwZWFyYW5jZUFuaW1hdGlvbixcbiAgRGlhbG9nTGF5b3V0RGlzcGxheSxcbiAgRGlzYXBwZWFyYW5jZUFuaW1hdGlvbixcbiAgVmVydGljYWxQb3NpdGlvblxufSBmcm9tICcuLi8uLi8uLi9jb3JlL2VudW1zJztcbmltcG9ydCB7IERhdGFDb250cm9sLCBEaXNwYXRjaCB9IGZyb20gJy4uLy4uLy4uL2NvcmUvZ2xvYmFsLWNsYXNzZXMnO1xuaW1wb3J0IHsgSUJ1dHRvbiwgSURpc3BhdGNoIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9nbG9iYWwtaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBTZXJ2aWNlTG9jYXRvciB9IGZyb20gJy4uLy4uLy4uL2xvY2F0b3Iuc2VydmljZSc7XG5pbXBvcnQgeyBDb25maXJtQm94Q29uZmlnU2VydmljZSB9IGZyb20gJy4vY29uZmlybS1ib3gtY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29uZmlybUJveFNlcnZpY2UgfSBmcm9tICcuL2NvbmZpcm0tYm94LXNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgSUNvbmZpcm1Cb3hCZWxvbmdpbmcsXG4gIElDb25maXJtQm94Q29yZUNvbmZpZyxcbiAgSUNvbmZpcm1Cb3hQdWJsaWNSZXNwb25zZSxcbiAgSUNvbmZpcm1Cb3hSZXNwb25zZSxcbiAgSVByaXZhdGVSZXNwb25zZU1lcmdlZFxufSBmcm9tICcuL2ludGVyZmFjZXMnO1xuXG5leHBvcnQgY2xhc3MgQ29uZmlybUJveEluaXRpYWxpemVyIHtcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBwcml2YXRlIGNvbmZpcm1Cb3hDYXJyaWVyOiBDb25maXJtQm94Q2FycmllciA9IG5ldyBDb25maXJtQm94Q2FycmllcigpO1xuXG4gIGNvbnN0cnVjdG9yKCkge31cblxuICBvcGVuQ29uZmlybUJveCQoKTogT2JzZXJ2YWJsZTxJQ29uZmlybUJveFB1YmxpY1Jlc3BvbnNlPiB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlybUJveENhcnJpZXIub3BlbkNvbmZpcm1Cb3gkKCkucGlwZShcbiAgICAgIG1hcChyZXNwID0+IHtcbiAgICAgICAgY29uc3QgYmFzaWNDb25maXJtQm94UmVzcG9uc2UgPSBuZXcgQ29uZmlybUJveFJlc3BvbnNlKCk7XG4gICAgICAgIGNvbnN0IGRhdGFDb250cm9sID0gbmV3IERhdGFDb250cm9sKCk7XG4gICAgICAgIGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKHJlc3AsIGJhc2ljQ29uZmlybUJveFJlc3BvbnNlKTtcbiAgICAgICAgcmV0dXJuIGJhc2ljQ29uZmlybUJveFJlc3BvbnNlO1xuICAgICAgfSksXG4gICAgICB0YWtlKDEpXG4gICAgKTtcbiAgfVxuXG4gIHNldEJ1dHRvbnMoX0J1dHRvbnM6IElCdXR0b25bXSk6IHZvaWQge1xuICAgIHRoaXMuY29uZmlybUJveENhcnJpZXIuc2V0QnV0dG9ucyhfQnV0dG9ucyk7XG4gIH1cblxuICBzZXRDb25maWcoX0NvbmZpcm1Cb3hDb3JlQ29uZmlnOiBJQ29uZmlybUJveENvcmVDb25maWcpIHtcbiAgICB0aGlzLmNvbmZpcm1Cb3hDYXJyaWVyLnNldENvbmZpZyhfQ29uZmlybUJveENvcmVDb25maWcpO1xuICB9XG5cbiAgc2V0RGlzcGF0Y2goX1RpdGxlOiBzdHJpbmcsIF9NZXNzYWdlOiBzdHJpbmcgPSBudWxsKTogdm9pZCB7XG4gICAgdGhpcy5jb25maXJtQm94Q2Fycmllci5zZXRUaXRsZShfVGl0bGUpO1xuICAgIHRoaXMuY29uZmlybUJveENhcnJpZXIuc2V0TWVzc2FnZShfTWVzc2FnZSk7XG4gIH1cblxuICBzZXRUaXRsZShfVGl0bGU6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuY29uZmlybUJveENhcnJpZXIuc2V0VGl0bGUoX1RpdGxlKTtcbiAgfVxuXG4gIHNldE1lc3NhZ2UoX01lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuY29uZmlybUJveENhcnJpZXIuc2V0TWVzc2FnZShfTWVzc2FnZSk7XG4gIH1cblxuICBzZXRCdXR0b25MYWJlbHMoX0NvbmZpcm06IHN0cmluZywgX0RlY2xpbmU/OiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmNvbmZpcm1Cb3hDYXJyaWVyLnNldEJ1dHRvbkxhYmVscyhfQ29uZmlybSwgX0RlY2xpbmUpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDb25maXJtQm94UmVzcG9uc2VcbiAgZXh0ZW5kcyBEYXRhQ29udHJvbFxuICBpbXBsZW1lbnRzIElDb25maXJtQm94UmVzcG9uc2UsIElDb25maXJtQm94UHVibGljUmVzcG9uc2Uge1xuICAvLyBwcml2YXRlIFJlc3BvbnNlOiBEaWFsb2dQcmVwYXJlUmVzcG9uc2UgICAgICAgICAgICA9IG5ldyBEaWFsb2dQcmVwYXJlUmVzcG9uc2UoKTtcblxuICBTdWNjZXNzOiBib29sZWFuID0gbnVsbDtcbiAgQ2xpY2tlZEJ1dHRvbklEOiBzdHJpbmcgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBzZXRTdWNjZXNzKF9Jc1N1Y2Nlc3M6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLlN1Y2Nlc3MgPSBfSXNTdWNjZXNzO1xuICB9XG5cbiAgc2V0Q2xpY2tlZEJ1dHRvbklEKF9DbGlja2VkQnV0dG9uSUQpOiB2b2lkIHtcbiAgICB0aGlzLkNsaWNrZWRCdXR0b25JRCA9IF9DbGlja2VkQnV0dG9uSUQ7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIENvbmZpcm1Cb3hFdmVudHNDb250cm9sbGVyIHtcbiAgZGVmYXVsdFJlc3BvbnNlOiBJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgX2FmdGVyQ2xvc2VkOiBTdWJqZWN0PElQcml2YXRlUmVzcG9uc2VNZXJnZWQ+ID0gbmV3IFN1YmplY3Q8SVByaXZhdGVSZXNwb25zZU1lcmdlZD4oKTtcbiAgYWZ0ZXJDbG9zZWQkOiBPYnNlcnZhYmxlPElQcml2YXRlUmVzcG9uc2VNZXJnZWQ+ID0gdGhpcy5fYWZ0ZXJDbG9zZWQuYXNPYnNlcnZhYmxlKCk7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBfb25CdXR0b25DbGljazogU3ViamVjdDxJQnV0dG9uPiA9IG5ldyBTdWJqZWN0PElCdXR0b24+KCk7XG4gIG9uQnV0dG9uQ2xpY2skOiBPYnNlcnZhYmxlPElCdXR0b24+ID0gdGhpcy5fb25CdXR0b25DbGljay5hc09ic2VydmFibGUoKTtcbiAgcHJpdmF0ZSByZWFkb25seSBfYnV0dG9uTGlzdDogU3ViamVjdDxJQnV0dG9uW10+ID0gbmV3IFN1YmplY3Q8SUJ1dHRvbltdPigpO1xuICBidXR0b25MaXN0JDogT2JzZXJ2YWJsZTxJQnV0dG9uW10+ID0gdGhpcy5fYnV0dG9uTGlzdC5hc09ic2VydmFibGUoKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIEVudGl0eVVuaXF1ZUlEOiBzdHJpbmcpIHt9XG5cbiAgY2xvc2UoX1Jlc3BvbnNlPzogSVByaXZhdGVSZXNwb25zZU1lcmdlZCk6IHZvaWQge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gX1Jlc3BvbnNlID8gX1Jlc3BvbnNlIDogdGhpcy5kZWZhdWx0UmVzcG9uc2U7XG4gICAgdGhpcy5fYWZ0ZXJDbG9zZWQubmV4dChyZXNwb25zZSk7XG4gIH1cblxuICBvbkJ1dHRvbkNsaWNrKF9CdXR0b246IElCdXR0b24pOiB2b2lkIHtcbiAgICB0aGlzLmRlZmF1bHRSZXNwb25zZS5zZXRDbGlja2VkQnV0dG9uSUQoX0J1dHRvbi5JRCk7XG4gICAgdGhpcy5fb25CdXR0b25DbGljay5uZXh0KF9CdXR0b24pO1xuICB9XG5cbiAgc2V0QnV0dG9uTGlzdChfQnV0dG9uTGlzdDogSUJ1dHRvbltdKTogdm9pZCB7XG4gICAgdGhpcy5fYnV0dG9uTGlzdC5uZXh0KF9CdXR0b25MaXN0KTtcbiAgfVxuXG4gIHNldERlZmF1bHRSZXNwb25zZShfUmVzcG9uc2U6IElQcml2YXRlUmVzcG9uc2VNZXJnZWQpOiB2b2lkIHtcbiAgICB0aGlzLmRlZmF1bHRSZXNwb25zZSA9IF9SZXNwb25zZTtcbiAgfVxufVxuXG4vLyBlbmRyZWdpb25cblxuZXhwb3J0IGNsYXNzIENvbmZpcm1Cb3hEZWZhdWx0UmVzcG9uc2VcbiAgZXh0ZW5kcyBDb25maXJtQm94UmVzcG9uc2VcbiAgaW1wbGVtZW50cyBJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkIHtcbiAgY29uZmlybUJveEJlbG9uZ2luZzogQ29uZmlybUJveEJlbG9uZ2luZyA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIHNldEJlbG9uZ2luZyhfQ29uZmlybUJveEJlbG9uZ2luZyk6IHZvaWQge1xuICAgIHRoaXMuY29uZmlybUJveEJlbG9uZ2luZyA9IF9Db25maXJtQm94QmVsb25naW5nO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDb25maXJtQm94Q2FycmllciB7XG4gIGNvbmZpcm1Cb3hCZWxvbmdpbmc6IENvbmZpcm1Cb3hCZWxvbmdpbmcgPSBuZXcgQ29uZmlybUJveEJlbG9uZ2luZygpO1xuXG4gIGNvbnN0cnVjdG9yKCkge31cblxuICBzZXRCdXR0b25zKF9CdXR0b25zOiBJQnV0dG9uW10pIHtcbiAgICBpZiAoX0J1dHRvbnMubGVuZ3RoKSB7XG4gICAgICB0aGlzLmNvbmZpcm1Cb3hCZWxvbmdpbmcuQnV0dG9ucyA9IF9CdXR0b25zO1xuICAgIH1cbiAgfVxuXG4gIHNldFRpdGxlKF9UaXRsZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5jb25maXJtQm94QmVsb25naW5nLkRpc3BhdGNoLlRpdGxlID0gX1RpdGxlO1xuICB9XG5cbiAgc2V0TWVzc2FnZShfTWVzc2FnZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5jb25maXJtQm94QmVsb25naW5nLkRpc3BhdGNoLk1lc3NhZ2UgPSBfTWVzc2FnZTtcbiAgfVxuXG4gIHNldEJ1dHRvbkxhYmVscyhfQ29uZmlybTogc3RyaW5nLCBfRGVjbGluZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5jb25maXJtQm94QmVsb25naW5nLkNvbmZpcm1Cb3hDb3JlQ29uZmlnLkNvbmZpcm1MYWJlbCA9IF9Db25maXJtO1xuICAgIHRoaXMuY29uZmlybUJveEJlbG9uZ2luZy5Db25maXJtQm94Q29yZUNvbmZpZy5EZWNsaW5lTGFiZWwgPSBfRGVjbGluZTtcbiAgfVxuXG4gIHNldENvbmZpZyhfQ29uZmlybUJveEJlbG9uZ2luZzogSUNvbmZpcm1Cb3hDb3JlQ29uZmlnKSB7XG4gICAgLy8gcmVnaW9uICoqKiBsb2NhbCBVc2VyQ29uZmlnIChkZWZpbmVkIG9uIHBsYWNlIHdoZXJlIGRpYWxvZyBpcyBjYWxsZWQpICoqKlxuICAgIGNvbnN0IGRhdGFDb250cm9sID0gbmV3IERhdGFDb250cm9sKCk7XG4gICAgZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20oXG4gICAgICBfQ29uZmlybUJveEJlbG9uZ2luZyxcbiAgICAgIHRoaXMuY29uZmlybUJveEJlbG9uZ2luZy5Db25maXJtQm94Q29yZUNvbmZpZ1xuICAgICk7XG4gICAgLy8gZW5kcmVnaW9uXG4gIH1cblxuICBvcGVuQ29uZmlybUJveCQoKTogT2JzZXJ2YWJsZTxJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPiB7XG4gICAgY29uc3Qgc2VydmljZTogQ29uZmlybUJveFNlcnZpY2UgPSBTZXJ2aWNlTG9jYXRvci5pbmplY3Rvci5nZXQoXG4gICAgICBDb25maXJtQm94U2VydmljZVxuICAgICk7XG4gICAgY29uc3QgY29uZmlybUJveENvbnRyb2xsZXIgPSBzZXJ2aWNlLm9wZW4odGhpcy5jb25maXJtQm94QmVsb25naW5nKTtcbiAgICByZXR1cm4gY29uZmlybUJveENvbnRyb2xsZXIuYWZ0ZXJDbG9zZWQkO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDb25maXJtQm94U2V0dGluZ3Mge1xuICBCdXR0b25zOiBJQnV0dG9uW10gPSBbXTtcbiAgQ29uZmlybUJveENvcmVDb25maWc6IElDb25maXJtQm94Q29yZUNvbmZpZyA9IG5ldyBDb25maXJtQm94Q29yZUNvbmZpZygpO1xuICBEaXNwYXRjaDogSURpc3BhdGNoID0gbmV3IERpc3BhdGNoKCk7XG59XG5cbmV4cG9ydCBjbGFzcyBDb25maXJtQm94Q29yZUNvbmZpZyBpbXBsZW1lbnRzIElDb25maXJtQm94Q29yZUNvbmZpZyB7XG4gIFdpZHRoOiBzdHJpbmcgPSBudWxsO1xuICBIZWlnaHQ6IHN0cmluZyA9IG51bGw7XG4gIEJ1dHRvblBvc2l0aW9uOiBWZXJ0aWNhbFBvc2l0aW9uID0gbnVsbDtcbiAgTGF5b3V0VHlwZTogRGlhbG9nTGF5b3V0RGlzcGxheSA9IG51bGw7XG4gIERpc3BhdGNoOiBJRGlzcGF0Y2ggPSBudWxsO1xuICBDb25maXJtTGFiZWw6IHN0cmluZyA9IG51bGw7XG4gIERlY2xpbmVMYWJlbDogc3RyaW5nID0gbnVsbDtcbiAgRGlzYWJsZUljb246IGJvb2xlYW4gPSBudWxsO1xuICBBbGxvd0hUTUxNZXNzYWdlOiBib29sZWFuID0gbnVsbDtcbiAgQW5pbWF0aW9uSW46IEFwcGVhcmFuY2VBbmltYXRpb24gPSBudWxsO1xuICBBbmltYXRpb25PdXQ6IERpc2FwcGVhcmFuY2VBbmltYXRpb24gPSBudWxsO1xufVxuXG5leHBvcnQgY2xhc3MgQ29uZmlybUJveEJlbG9uZ2luZ1xuICBleHRlbmRzIENvbmZpcm1Cb3hTZXR0aW5nc1xuICBpbXBsZW1lbnRzIElDb25maXJtQm94QmVsb25naW5nIHtcbiAgRW50aXR5VW5pcXVlSUQ6IHN0cmluZyA9ICdDJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KTtcbiAgRXZlbnRzQ29udHJvbGxlcjogQ29uZmlybUJveEV2ZW50c0NvbnRyb2xsZXI7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLkV2ZW50c0NvbnRyb2xsZXIgPSBuZXcgQ29uZmlybUJveEV2ZW50c0NvbnRyb2xsZXIodGhpcy5FbnRpdHlVbmlxdWVJRCk7XG4gICAgY29uc3QgQ29uZmlybUJveENvcmVDb25maWd1cmF0b3I6IENvbmZpcm1Cb3hDb25maWdTZXJ2aWNlID0gU2VydmljZUxvY2F0b3IuaW5qZWN0b3IuZ2V0KFxuICAgICAgQ29uZmlybUJveENvbmZpZ1NlcnZpY2VcbiAgICApO1xuICAgIGNvbnN0IGJhc2VTZXR0aW5ncyA9IG5ldyBDb25maXJtQm94U2V0dGluZ3MoKTtcbiAgICBjb25zdCBkYXRhQ29udHJvbCA9IG5ldyBEYXRhQ29udHJvbCgpO1xuICAgIGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKFxuICAgICAgQ29uZmlybUJveENvcmVDb25maWd1cmF0b3IucHJvZHVjdGlvbkNvbmZpZy5Db25maXJtQm94Q29yZUNvbmZpZyxcbiAgICAgIGJhc2VTZXR0aW5ncy5Db25maXJtQm94Q29yZUNvbmZpZ1xuICAgICk7XG4gICAgdGhpcy5Db25maXJtQm94Q29yZUNvbmZpZyA9IGJhc2VTZXR0aW5ncy5Db25maXJtQm94Q29yZUNvbmZpZztcbiAgICB0aGlzLkJ1dHRvbnMgPSBDb25maXJtQm94Q29yZUNvbmZpZ3VyYXRvci5wcm9kdWN0aW9uQ29uZmlnLkJ1dHRvbnMuc2xpY2UoKTtcbiAgfVxufVxuIl19