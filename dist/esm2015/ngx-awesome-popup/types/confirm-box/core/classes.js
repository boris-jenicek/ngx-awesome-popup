import { Subject } from 'rxjs';
import { map, take } from 'rxjs/operators';
import { DataControl, dispatch } from '../../../core/global-classes';
import { ServiceLocator } from '../../../locator.service';
import { ConfirmBoxConfigService } from './confirm-box-config.service';
import { ConfirmBoxService } from './confirm-box-service';
export class ConfirmBoxInitializer {
    constructor() {
        /** @internal */
        this.confirmBoxCarrier = new ConfirmBoxCarrier();
    }
    openConfirmBox$() {
        return this.confirmBoxCarrier.openConfirmBox$().pipe(map(resp => {
            const basicConfirmBoxResponse = new ConfirmBoxResponse();
            const dataControl = new DataControl();
            dataControl.copyValuesFrom(resp, basicConfirmBoxResponse);
            return basicConfirmBoxResponse;
        }), take(1));
    }
    setButtons(_Buttons) {
        this.confirmBoxCarrier.setButtons(_Buttons);
    }
    setConfig(_ConfirmBoxCoreConfig) {
        this.confirmBoxCarrier.setConfig(_ConfirmBoxCoreConfig);
    }
    setDispatch(_Title, _Message = null) {
        this.confirmBoxCarrier.setTitle(_Title);
        this.confirmBoxCarrier.setMessage(_Message);
    }
    setTitle(_Title) {
        this.confirmBoxCarrier.setTitle(_Title);
    }
    setMessage(_Message) {
        this.confirmBoxCarrier.setMessage(_Message);
    }
    setButtonLabels(_Confirm, _Decline) {
        this.confirmBoxCarrier.setButtonLabels(_Confirm, _Decline);
    }
}
export class ConfirmBoxResponse extends DataControl {
    constructor() {
        super();
        // private Response: DialogPrepareResponse            = new DialogPrepareResponse();
        this.success = null;
        this.clickedButtonID = null;
    }
    setSuccess(_IsSuccess) {
        this.success = _IsSuccess;
    }
    setClickedButtonID(_ClickedButtonID) {
        this.clickedButtonID = _ClickedButtonID;
    }
}
export class ConfirmBoxeventsController {
    constructor(entityUniqueID) {
        this.entityUniqueID = entityUniqueID;
        this._afterClosed = new Subject();
        this._onButtonClick = new Subject();
        this._buttonList = new Subject();
        this.afterClosed$ = this._afterClosed.asObservable();
        this.onButtonClick$ = this._onButtonClick.asObservable();
        this.buttonList$ = this._buttonList.asObservable();
    }
    close(_Response) {
        const response = _Response ? _Response : this.defaultResponse;
        this._afterClosed.next(response);
    }
    onButtonClick(_Button) {
        this.defaultResponse.setClickedButtonID(_Button.ID);
        this._onButtonClick.next(_Button);
    }
    setButtonList(_ButtonList) {
        this._buttonList.next(_ButtonList);
    }
    setDefaultResponse(_Response) {
        this.defaultResponse = _Response;
    }
}
// endregion
export class ConfirmBoxDefaultResponse extends ConfirmBoxResponse {
    constructor() {
        super();
        this.confirmBoxBelonging = null;
    }
    setBelonging(_ConfirmBoxBelonging) {
        this.confirmBoxBelonging = _ConfirmBoxBelonging;
    }
}
export class ConfirmBoxCarrier {
    constructor() {
        this.confirmBoxBelonging = new ConfirmBoxBelonging();
    }
    setButtons(_Buttons) {
        if (_Buttons.length) {
            this.confirmBoxBelonging.buttons = _Buttons;
        }
    }
    setTitle(_Title) {
        this.confirmBoxBelonging.dispatch.title = _Title;
    }
    setMessage(_Message) {
        this.confirmBoxBelonging.dispatch.message = _Message;
    }
    setButtonLabels(_Confirm, _Decline) {
        this.confirmBoxBelonging.confirmBoxCoreConfig.confirmLabel = _Confirm;
        this.confirmBoxBelonging.confirmBoxCoreConfig.declineLabel = _Decline;
    }
    setConfig(_ConfirmBoxBelonging) {
        // region *** local UserConfig (defined on place where dialog is called) ***
        const dataControl = new DataControl();
        dataControl.copyValuesFrom(_ConfirmBoxBelonging, this.confirmBoxBelonging.confirmBoxCoreConfig);
        // endregion
    }
    openConfirmBox$() {
        const service = ServiceLocator.injector.get(ConfirmBoxService);
        const confirmBoxController = service.open(this.confirmBoxBelonging);
        return confirmBoxController.afterClosed$;
    }
}
export class ConfirmBoxSettings {
    constructor() {
        this.buttons = [];
        this.confirmBoxCoreConfig = new confirmBoxCoreConfig();
        this.dispatch = new dispatch();
    }
}
export class ConfirmBoxCustomStyles {
    constructor() {
        this.titleCSS = null;
        this.textCSS = null;
        this.buttonSectionCSS = null;
        this.buttonCSS = null;
        this.wrapperCSS = null;
    }
}
export class confirmBoxCoreConfig {
    constructor() {
        this.width = null;
        this.height = null;
        this.buttonPosition = null;
        this.layoutType = null;
        this.dispatch = null;
        this.confirmLabel = null;
        this.declineLabel = null;
        this.disableIcon = null;
        this.allowHtmlMessage = null;
        this.animationIn = null;
        this.animationOut = null;
        this.customStyles = new ConfirmBoxCustomStyles();
    }
}
export class ConfirmBoxBelonging extends ConfirmBoxSettings {
    constructor() {
        super();
        this.entityUniqueID = 'C' + Math.random().toString(36).substr(2, 9);
        this.eventsController = new ConfirmBoxeventsController(this.entityUniqueID);
        const ConfirmBoxCoreConfigurator = ServiceLocator.injector.get(ConfirmBoxConfigService);
        const baseSettings = new ConfirmBoxSettings();
        const dataControl = new DataControl();
        dataControl.copyValuesFrom(ConfirmBoxCoreConfigurator.productionConfig.confirmBoxCoreConfig, baseSettings.confirmBoxCoreConfig);
        this.confirmBoxCoreConfig = baseSettings.confirmBoxCoreConfig;
        this.buttons = ConfirmBoxCoreConfigurator.productionConfig.buttons.slice();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xhc3Nlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL25neC1hd2Vzb21lLXBvcHVwL3R5cGVzL2NvbmZpcm0tYm94L2NvcmUvY2xhc3Nlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFPM0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUVyRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDMUQsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDdkUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFVMUQsTUFBTSxPQUFPLHFCQUFxQjtJQUloQztRQUhBLGdCQUFnQjtRQUNSLHNCQUFpQixHQUFzQixJQUFJLGlCQUFpQixFQUFFLENBQUM7SUFFeEQsQ0FBQztJQUVoQixlQUFlO1FBQ2IsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsZUFBZSxFQUFFLENBQUMsSUFBSSxDQUNsRCxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDVCxNQUFNLHVCQUF1QixHQUFHLElBQUksa0JBQWtCLEVBQUUsQ0FBQztZQUN6RCxNQUFNLFdBQVcsR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFDO1lBQ3RDLFdBQVcsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLHVCQUF1QixDQUFDLENBQUM7WUFDMUQsT0FBTyx1QkFBdUIsQ0FBQztRQUNqQyxDQUFDLENBQUMsRUFDRixJQUFJLENBQUMsQ0FBQyxDQUFDLENBQ1IsQ0FBQztJQUNKLENBQUM7SUFFRCxVQUFVLENBQUMsUUFBbUI7UUFDNUIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FB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QUFFLENBQUMsQ0FBQyxDQUFDO1FBS3JFLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLDBCQUEwQixDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUM1RSxNQUFNLDBCQUEwQixHQUE0QixjQUFjLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1FBQ2pILE1BQU0sWUFBWSxHQUFHLElBQUksa0JBQWtCLEVBQUUsQ0FBQztRQUM5QyxNQUFNLFdBQVcsR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFDO1FBQ3RDLFdBQVcsQ0FBQyxjQUFjLENBQ3hCLDBCQUEwQixDQUFDLGdCQUFnQixDQUFDLG9CQUFvQixFQUNoRSxZQUFZLENBQUMsb0JBQW9CLENBQ2xDLENBQUM7UUFDRixJQUFJLENBQUMsb0JBQW9CLEdBQUcsWUFBWSxDQUFDLG9CQUFvQixDQUFDO1FBQzlELElBQUksQ0FBQyxPQUFPLEdBQUcsMEJBQTBCLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQzdFLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgdGFrZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7XG4gIEFwcGVhcmFuY2VBbmltYXRpb24sXG4gIERpYWxvZ0xheW91dERpc3BsYXksXG4gIERpc2FwcGVhcmFuY2VBbmltYXRpb24sXG4gIFZlcnRpY2FsUG9zaXRpb25cbn0gZnJvbSAnLi4vLi4vLi4vY29yZS9lbnVtcyc7XG5pbXBvcnQgeyBEYXRhQ29udHJvbCwgZGlzcGF0Y2ggfSBmcm9tICcuLi8uLi8uLi9jb3JlL2dsb2JhbC1jbGFzc2VzJztcbmltcG9ydCB7IElCdXR0b24sIElEaXNwYXRjaCB9IGZyb20gJy4uLy4uLy4uL2NvcmUvZ2xvYmFsLWludGVyZmFjZXMnO1xuaW1wb3J0IHsgU2VydmljZUxvY2F0b3IgfSBmcm9tICcuLi8uLi8uLi9sb2NhdG9yLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29uZmlybUJveENvbmZpZ1NlcnZpY2UgfSBmcm9tICcuL2NvbmZpcm0tYm94LWNvbmZpZy5zZXJ2aWNlJztcbmltcG9ydCB7IENvbmZpcm1Cb3hTZXJ2aWNlIH0gZnJvbSAnLi9jb25maXJtLWJveC1zZXJ2aWNlJztcbmltcG9ydCB7XG4gIElDb25maXJtQm94QmVsb25naW5nLFxuICBJQ29uZmlybUJveENvcmVDb25maWcsXG4gIElDb25maXJtQm94Q3VzdG9tU3R5bGVzLFxuICBJQ29uZmlybUJveFB1YmxpY1Jlc3BvbnNlLFxuICBJQ29uZmlybUJveFJlc3BvbnNlLFxuICBJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkXG59IGZyb20gJy4vaW50ZXJmYWNlcyc7XG5cbmV4cG9ydCBjbGFzcyBDb25maXJtQm94SW5pdGlhbGl6ZXIge1xuICAvKiogQGludGVybmFsICovXG4gIHByaXZhdGUgY29uZmlybUJveENhcnJpZXI6IENvbmZpcm1Cb3hDYXJyaWVyID0gbmV3IENvbmZpcm1Cb3hDYXJyaWVyKCk7XG5cbiAgY29uc3RydWN0b3IoKSB7fVxuXG4gIG9wZW5Db25maXJtQm94JCgpOiBPYnNlcnZhYmxlPElDb25maXJtQm94UHVibGljUmVzcG9uc2U+IHtcbiAgICByZXR1cm4gdGhpcy5jb25maXJtQm94Q2Fycmllci5vcGVuQ29uZmlybUJveCQoKS5waXBlKFxuICAgICAgbWFwKHJlc3AgPT4ge1xuICAgICAgICBjb25zdCBiYXNpY0NvbmZpcm1Cb3hSZXNwb25zZSA9IG5ldyBDb25maXJtQm94UmVzcG9uc2UoKTtcbiAgICAgICAgY29uc3QgZGF0YUNvbnRyb2wgPSBuZXcgRGF0YUNvbnRyb2woKTtcbiAgICAgICAgZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20ocmVzcCwgYmFzaWNDb25maXJtQm94UmVzcG9uc2UpO1xuICAgICAgICByZXR1cm4gYmFzaWNDb25maXJtQm94UmVzcG9uc2U7XG4gICAgICB9KSxcbiAgICAgIHRha2UoMSlcbiAgICApO1xuICB9XG5cbiAgc2V0QnV0dG9ucyhfQnV0dG9uczogSUJ1dHRvbltdKTogdm9pZCB7XG4gICAgdGhpcy5jb25maXJtQm94Q2Fycmllci5zZXRCdXR0b25zKF9CdXR0b25zKTtcbiAgfVxuXG4gIHNldENvbmZpZyhfQ29uZmlybUJveENvcmVDb25maWc6IElDb25maXJtQm94Q29yZUNvbmZpZyk6IHZvaWQge1xuICAgIHRoaXMuY29uZmlybUJveENhcnJpZXIuc2V0Q29uZmlnKF9Db25maXJtQm94Q29yZUNvbmZpZyk7XG4gIH1cblxuICBzZXREaXNwYXRjaChfVGl0bGU6IHN0cmluZywgX01lc3NhZ2U6IHN0cmluZyA9IG51bGwpOiB2b2lkIHtcbiAgICB0aGlzLmNvbmZpcm1Cb3hDYXJyaWVyLnNldFRpdGxlKF9UaXRsZSk7XG4gICAgdGhpcy5jb25maXJtQm94Q2Fycmllci5zZXRNZXNzYWdlKF9NZXNzYWdlKTtcbiAgfVxuXG4gIHNldFRpdGxlKF9UaXRsZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5jb25maXJtQm94Q2Fycmllci5zZXRUaXRsZShfVGl0bGUpO1xuICB9XG5cbiAgc2V0TWVzc2FnZShfTWVzc2FnZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5jb25maXJtQm94Q2Fycmllci5zZXRNZXNzYWdlKF9NZXNzYWdlKTtcbiAgfVxuXG4gIHNldEJ1dHRvbkxhYmVscyhfQ29uZmlybTogc3RyaW5nLCBfRGVjbGluZT86IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuY29uZmlybUJveENhcnJpZXIuc2V0QnV0dG9uTGFiZWxzKF9Db25maXJtLCBfRGVjbGluZSk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIENvbmZpcm1Cb3hSZXNwb25zZSBleHRlbmRzIERhdGFDb250cm9sIGltcGxlbWVudHMgSUNvbmZpcm1Cb3hSZXNwb25zZSwgSUNvbmZpcm1Cb3hQdWJsaWNSZXNwb25zZSB7XG4gIC8vIHByaXZhdGUgUmVzcG9uc2U6IERpYWxvZ1ByZXBhcmVSZXNwb25zZSAgICAgICAgICAgID0gbmV3IERpYWxvZ1ByZXBhcmVSZXNwb25zZSgpO1xuXG4gIHN1Y2Nlc3M6IGJvb2xlYW4gPSBudWxsO1xuICBjbGlja2VkQnV0dG9uSUQ6IHN0cmluZyA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIHNldFN1Y2Nlc3MoX0lzU3VjY2VzczogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuc3VjY2VzcyA9IF9Jc1N1Y2Nlc3M7XG4gIH1cblxuICBzZXRDbGlja2VkQnV0dG9uSUQoX0NsaWNrZWRCdXR0b25JRCk6IHZvaWQge1xuICAgIHRoaXMuY2xpY2tlZEJ1dHRvbklEID0gX0NsaWNrZWRCdXR0b25JRDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ29uZmlybUJveGV2ZW50c0NvbnRyb2xsZXIge1xuICBwcml2YXRlIHJlYWRvbmx5IF9hZnRlckNsb3NlZDogU3ViamVjdDxJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPiA9IG5ldyBTdWJqZWN0PElQcml2YXRlUmVzcG9uc2VNZXJnZWQ+KCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgX29uQnV0dG9uQ2xpY2s6IFN1YmplY3Q8SUJ1dHRvbj4gPSBuZXcgU3ViamVjdDxJQnV0dG9uPigpO1xuICBwcml2YXRlIHJlYWRvbmx5IF9idXR0b25MaXN0OiBTdWJqZWN0PElCdXR0b25bXT4gPSBuZXcgU3ViamVjdDxJQnV0dG9uW10+KCk7XG4gIGRlZmF1bHRSZXNwb25zZTogSVByaXZhdGVSZXNwb25zZU1lcmdlZDtcbiAgYWZ0ZXJDbG9zZWQkOiBPYnNlcnZhYmxlPElQcml2YXRlUmVzcG9uc2VNZXJnZWQ+ID0gdGhpcy5fYWZ0ZXJDbG9zZWQuYXNPYnNlcnZhYmxlKCk7XG4gIG9uQnV0dG9uQ2xpY2skOiBPYnNlcnZhYmxlPElCdXR0b24+ID0gdGhpcy5fb25CdXR0b25DbGljay5hc09ic2VydmFibGUoKTtcbiAgYnV0dG9uTGlzdCQ6IE9ic2VydmFibGU8SUJ1dHRvbltdPiA9IHRoaXMuX2J1dHRvbkxpc3QuYXNPYnNlcnZhYmxlKCk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbnRpdHlVbmlxdWVJRDogc3RyaW5nKSB7fVxuXG4gIGNsb3NlKF9SZXNwb25zZT86IElQcml2YXRlUmVzcG9uc2VNZXJnZWQpOiB2b2lkIHtcbiAgICBjb25zdCByZXNwb25zZSA9IF9SZXNwb25zZSA/IF9SZXNwb25zZSA6IHRoaXMuZGVmYXVsdFJlc3BvbnNlO1xuICAgIHRoaXMuX2FmdGVyQ2xvc2VkLm5leHQocmVzcG9uc2UpO1xuICB9XG5cbiAgb25CdXR0b25DbGljayhfQnV0dG9uOiBJQnV0dG9uKTogdm9pZCB7XG4gICAgdGhpcy5kZWZhdWx0UmVzcG9uc2Uuc2V0Q2xpY2tlZEJ1dHRvbklEKF9CdXR0b24uSUQpO1xuICAgIHRoaXMuX29uQnV0dG9uQ2xpY2submV4dChfQnV0dG9uKTtcbiAgfVxuXG4gIHNldEJ1dHRvbkxpc3QoX0J1dHRvbkxpc3Q6IElCdXR0b25bXSk6IHZvaWQge1xuICAgIHRoaXMuX2J1dHRvbkxpc3QubmV4dChfQnV0dG9uTGlzdCk7XG4gIH1cblxuICBzZXREZWZhdWx0UmVzcG9uc2UoX1Jlc3BvbnNlOiBJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkKTogdm9pZCB7XG4gICAgdGhpcy5kZWZhdWx0UmVzcG9uc2UgPSBfUmVzcG9uc2U7XG4gIH1cbn1cblxuLy8gZW5kcmVnaW9uXG5cbmV4cG9ydCBjbGFzcyBDb25maXJtQm94RGVmYXVsdFJlc3BvbnNlIGV4dGVuZHMgQ29uZmlybUJveFJlc3BvbnNlIGltcGxlbWVudHMgSVByaXZhdGVSZXNwb25zZU1lcmdlZCB7XG4gIGNvbmZpcm1Cb3hCZWxvbmdpbmc6IENvbmZpcm1Cb3hCZWxvbmdpbmcgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBzZXRCZWxvbmdpbmcoX0NvbmZpcm1Cb3hCZWxvbmdpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmNvbmZpcm1Cb3hCZWxvbmdpbmcgPSBfQ29uZmlybUJveEJlbG9uZ2luZztcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ29uZmlybUJveENhcnJpZXIge1xuICBjb25maXJtQm94QmVsb25naW5nOiBDb25maXJtQm94QmVsb25naW5nID0gbmV3IENvbmZpcm1Cb3hCZWxvbmdpbmcoKTtcblxuICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgc2V0QnV0dG9ucyhfQnV0dG9uczogSUJ1dHRvbltdKTogdm9pZCB7XG4gICAgaWYgKF9CdXR0b25zLmxlbmd0aCkge1xuICAgICAgdGhpcy5jb25maXJtQm94QmVsb25naW5nLmJ1dHRvbnMgPSBfQnV0dG9ucztcbiAgICB9XG4gIH1cblxuICBzZXRUaXRsZShfVGl0bGU6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuY29uZmlybUJveEJlbG9uZ2luZy5kaXNwYXRjaC50aXRsZSA9IF9UaXRsZTtcbiAgfVxuXG4gIHNldE1lc3NhZ2UoX01lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuY29uZmlybUJveEJlbG9uZ2luZy5kaXNwYXRjaC5tZXNzYWdlID0gX01lc3NhZ2U7XG4gIH1cblxuICBzZXRCdXR0b25MYWJlbHMoX0NvbmZpcm06IHN0cmluZywgX0RlY2xpbmU6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuY29uZmlybUJveEJlbG9uZ2luZy5jb25maXJtQm94Q29yZUNvbmZpZy5jb25maXJtTGFiZWwgPSBfQ29uZmlybTtcbiAgICB0aGlzLmNvbmZpcm1Cb3hCZWxvbmdpbmcuY29uZmlybUJveENvcmVDb25maWcuZGVjbGluZUxhYmVsID0gX0RlY2xpbmU7XG4gIH1cblxuICBzZXRDb25maWcoX0NvbmZpcm1Cb3hCZWxvbmdpbmc6IElDb25maXJtQm94Q29yZUNvbmZpZyk6IHZvaWQge1xuICAgIC8vIHJlZ2lvbiAqKiogbG9jYWwgVXNlckNvbmZpZyAoZGVmaW5lZCBvbiBwbGFjZSB3aGVyZSBkaWFsb2cgaXMgY2FsbGVkKSAqKipcbiAgICBjb25zdCBkYXRhQ29udHJvbCA9IG5ldyBEYXRhQ29udHJvbCgpO1xuICAgIGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKF9Db25maXJtQm94QmVsb25naW5nLCB0aGlzLmNvbmZpcm1Cb3hCZWxvbmdpbmcuY29uZmlybUJveENvcmVDb25maWcpO1xuICAgIC8vIGVuZHJlZ2lvblxuICB9XG5cbiAgb3BlbkNvbmZpcm1Cb3gkKCk6IE9ic2VydmFibGU8SVByaXZhdGVSZXNwb25zZU1lcmdlZD4ge1xuICAgIGNvbnN0IHNlcnZpY2U6IENvbmZpcm1Cb3hTZXJ2aWNlID0gU2VydmljZUxvY2F0b3IuaW5qZWN0b3IuZ2V0KENvbmZpcm1Cb3hTZXJ2aWNlKTtcbiAgICBjb25zdCBjb25maXJtQm94Q29udHJvbGxlciA9IHNlcnZpY2Uub3Blbih0aGlzLmNvbmZpcm1Cb3hCZWxvbmdpbmcpO1xuICAgIHJldHVybiBjb25maXJtQm94Q29udHJvbGxlci5hZnRlckNsb3NlZCQ7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIENvbmZpcm1Cb3hTZXR0aW5ncyB7XG4gIGJ1dHRvbnM6IElCdXR0b25bXSA9IFtdO1xuICBjb25maXJtQm94Q29yZUNvbmZpZzogSUNvbmZpcm1Cb3hDb3JlQ29uZmlnID0gbmV3IGNvbmZpcm1Cb3hDb3JlQ29uZmlnKCk7XG4gIGRpc3BhdGNoOiBJRGlzcGF0Y2ggPSBuZXcgZGlzcGF0Y2goKTtcbn1cblxuZXhwb3J0IGNsYXNzIENvbmZpcm1Cb3hDdXN0b21TdHlsZXMgaW1wbGVtZW50cyBJQ29uZmlybUJveEN1c3RvbVN0eWxlcyB7XG4gIHRpdGxlQ1NTOiBzdHJpbmcgPSBudWxsO1xuICB0ZXh0Q1NTOiBzdHJpbmcgPSBudWxsO1xuICBidXR0b25TZWN0aW9uQ1NTOiBzdHJpbmcgPSBudWxsO1xuICBidXR0b25DU1M6IHN0cmluZyA9IG51bGw7XG4gIHdyYXBwZXJDU1M6IHN0cmluZyA9IG51bGw7XG59XG5cbmV4cG9ydCBjbGFzcyBjb25maXJtQm94Q29yZUNvbmZpZyBpbXBsZW1lbnRzIElDb25maXJtQm94Q29yZUNvbmZpZyB7XG4gIHdpZHRoOiBzdHJpbmcgPSBudWxsO1xuICBoZWlnaHQ6IHN0cmluZyA9IG51bGw7XG4gIGJ1dHRvblBvc2l0aW9uOiBWZXJ0aWNhbFBvc2l0aW9uID0gbnVsbDtcbiAgbGF5b3V0VHlwZTogRGlhbG9nTGF5b3V0RGlzcGxheSA9IG51bGw7XG4gIGRpc3BhdGNoOiBJRGlzcGF0Y2ggPSBudWxsO1xuICBjb25maXJtTGFiZWw6IHN0cmluZyA9IG51bGw7XG4gIGRlY2xpbmVMYWJlbDogc3RyaW5nID0gbnVsbDtcbiAgZGlzYWJsZUljb246IGJvb2xlYW4gPSBudWxsO1xuICBhbGxvd0h0bWxNZXNzYWdlOiBib29sZWFuID0gbnVsbDtcbiAgYW5pbWF0aW9uSW46IEFwcGVhcmFuY2VBbmltYXRpb24gPSBudWxsO1xuICBhbmltYXRpb25PdXQ6IERpc2FwcGVhcmFuY2VBbmltYXRpb24gPSBudWxsO1xuICBjdXN0b21TdHlsZXM6IENvbmZpcm1Cb3hDdXN0b21TdHlsZXMgPSBuZXcgQ29uZmlybUJveEN1c3RvbVN0eWxlcygpO1xufVxuXG5leHBvcnQgY2xhc3MgQ29uZmlybUJveEJlbG9uZ2luZyBleHRlbmRzIENvbmZpcm1Cb3hTZXR0aW5ncyBpbXBsZW1lbnRzIElDb25maXJtQm94QmVsb25naW5nIHtcbiAgZW50aXR5VW5pcXVlSUQ6IHN0cmluZyA9ICdDJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KTtcbiAgZXZlbnRzQ29udHJvbGxlcjogQ29uZmlybUJveGV2ZW50c0NvbnRyb2xsZXI7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmV2ZW50c0NvbnRyb2xsZXIgPSBuZXcgQ29uZmlybUJveGV2ZW50c0NvbnRyb2xsZXIodGhpcy5lbnRpdHlVbmlxdWVJRCk7XG4gICAgY29uc3QgQ29uZmlybUJveENvcmVDb25maWd1cmF0b3I6IENvbmZpcm1Cb3hDb25maWdTZXJ2aWNlID0gU2VydmljZUxvY2F0b3IuaW5qZWN0b3IuZ2V0KENvbmZpcm1Cb3hDb25maWdTZXJ2aWNlKTtcbiAgICBjb25zdCBiYXNlU2V0dGluZ3MgPSBuZXcgQ29uZmlybUJveFNldHRpbmdzKCk7XG4gICAgY29uc3QgZGF0YUNvbnRyb2wgPSBuZXcgRGF0YUNvbnRyb2woKTtcbiAgICBkYXRhQ29udHJvbC5jb3B5VmFsdWVzRnJvbShcbiAgICAgIENvbmZpcm1Cb3hDb3JlQ29uZmlndXJhdG9yLnByb2R1Y3Rpb25Db25maWcuY29uZmlybUJveENvcmVDb25maWcsXG4gICAgICBiYXNlU2V0dGluZ3MuY29uZmlybUJveENvcmVDb25maWdcbiAgICApO1xuICAgIHRoaXMuY29uZmlybUJveENvcmVDb25maWcgPSBiYXNlU2V0dGluZ3MuY29uZmlybUJveENvcmVDb25maWc7XG4gICAgdGhpcy5idXR0b25zID0gQ29uZmlybUJveENvcmVDb25maWd1cmF0b3IucHJvZHVjdGlvbkNvbmZpZy5idXR0b25zLnNsaWNlKCk7XG4gIH1cbn1cbiJdfQ==