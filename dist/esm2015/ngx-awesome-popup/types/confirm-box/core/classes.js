import { Subject } from 'rxjs';
import { map, take } from 'rxjs/operators';
import { DataControl, Dispatch } from '../../../core/global-classes';
import { ServiceLocator } from '../../../locator.service';
import { ConfirmBoxConfigService } from './confirm-box-config.service';
import { ConfirmBoxService } from './confirm-box-service';
export class ConfirmBoxInitializer {
    constructor() {
        /** @internal */
        this.confirmBoxCarrier = new ConfirmBoxCarrier();
    }
    openConfirmBox$() {
        return this.confirmBoxCarrier.openConfirmBox$().pipe(map(resp => {
            const basicConfirmBoxResponse = new ConfirmBoxResponse();
            const dataControl = new DataControl();
            dataControl.copyValuesFrom(resp, basicConfirmBoxResponse);
            return basicConfirmBoxResponse;
        }), take(1));
    }
    setButtons(_Buttons) {
        this.confirmBoxCarrier.setButtons(_Buttons);
    }
    setConfig(_ConfirmBoxCoreConfig) {
        this.confirmBoxCarrier.setConfig(_ConfirmBoxCoreConfig);
    }
    setDispatch(_Title, _Message = null) {
        this.confirmBoxCarrier.setTitle(_Title);
        this.confirmBoxCarrier.setMessage(_Message);
    }
    setTitle(_Title) {
        this.confirmBoxCarrier.setTitle(_Title);
    }
    setMessage(_Message) {
        this.confirmBoxCarrier.setMessage(_Message);
    }
    setButtonLabels(_Confirm, _Decline) {
        this.confirmBoxCarrier.setButtonLabels(_Confirm, _Decline);
    }
}
export class ConfirmBoxResponse extends DataControl {
    constructor() {
        super();
        // private Response: DialogPrepareResponse            = new DialogPrepareResponse();
        this.Success = null;
        this.ClickedButtonID = null;
    }
    setSuccess(_IsSuccess) {
        this.Success = _IsSuccess;
    }
    setClickedButtonID(_ClickedButtonID) {
        this.ClickedButtonID = _ClickedButtonID;
    }
}
export class ConfirmBoxEventsController {
    constructor(EntityUniqueID) {
        this.EntityUniqueID = EntityUniqueID;
        this._afterClosed = new Subject();
        this.afterClosed$ = this._afterClosed.asObservable();
        this._onButtonClick = new Subject();
        this.onButtonClick$ = this._onButtonClick.asObservable();
        this._buttonList = new Subject();
        this.buttonList$ = this._buttonList.asObservable();
    }
    close(_Response) {
        const response = _Response ? _Response : this.defaultResponse;
        this._afterClosed.next(response);
    }
    onButtonClick(_Button) {
        this.defaultResponse.setClickedButtonID(_Button.ID);
        this._onButtonClick.next(_Button);
    }
    setButtonList(_ButtonList) {
        this._buttonList.next(_ButtonList);
    }
    setDefaultResponse(_Response) {
        this.defaultResponse = _Response;
    }
}
// endregion
export class ConfirmBoxDefaultResponse extends ConfirmBoxResponse {
    constructor() {
        super();
        this.confirmBoxBelonging = null;
    }
    setBelonging(_ConfirmBoxBelonging) {
        this.confirmBoxBelonging = _ConfirmBoxBelonging;
    }
}
export class ConfirmBoxCarrier {
    constructor() {
        this.confirmBoxBelonging = new ConfirmBoxBelonging();
    }
    setButtons(_Buttons) {
        if (_Buttons.length) {
            this.confirmBoxBelonging.Buttons = _Buttons;
        }
    }
    setTitle(_Title) {
        this.confirmBoxBelonging.Dispatch.Title = _Title;
    }
    setMessage(_Message) {
        this.confirmBoxBelonging.Dispatch.Message = _Message;
    }
    setButtonLabels(_Confirm, _Decline) {
        this.confirmBoxBelonging.ConfirmBoxCoreConfig.ConfirmLabel = _Confirm;
        this.confirmBoxBelonging.ConfirmBoxCoreConfig.DeclineLabel = _Decline;
    }
    setConfig(_ConfirmBoxBelonging) {
        // region *** local UserConfig (defined on place where dialog is called) ***
        const dataControl = new DataControl();
        dataControl.copyValuesFrom(_ConfirmBoxBelonging, this.confirmBoxBelonging.ConfirmBoxCoreConfig);
        // endregion
    }
    openConfirmBox$() {
        const service = ServiceLocator.injector.get(ConfirmBoxService);
        const confirmBoxController = service.open(this.confirmBoxBelonging);
        return confirmBoxController.afterClosed$;
    }
}
export class ConfirmBoxSettings {
    constructor() {
        this.Buttons = [];
        this.ConfirmBoxCoreConfig = new ConfirmBoxCoreConfig();
        this.Dispatch = new Dispatch();
    }
}
export class ConfirmBoxCustomStyles {
    constructor() {
        this.TitleCSS = null;
        this.TextCSS = null;
        this.ButtonSectionCSS = null;
        this.ButtonCSS = null;
        this.WrapperCSS = null;
    }
}
export class ConfirmBoxCoreConfig {
    constructor() {
        this.Width = null;
        this.Height = null;
        this.ButtonPosition = null;
        this.LayoutType = null;
        this.Dispatch = null;
        this.ConfirmLabel = null;
        this.DeclineLabel = null;
        this.DisableIcon = null;
        this.AllowHTMLMessage = null;
        this.AnimationIn = null;
        this.AnimationOut = null;
        this.CustomStyles = new ConfirmBoxCustomStyles();
    }
}
export class ConfirmBoxBelonging extends ConfirmBoxSettings {
    constructor() {
        super();
        this.EntityUniqueID = 'C' + Math.random().toString(36).substr(2, 9);
        this.EventsController = new ConfirmBoxEventsController(this.EntityUniqueID);
        const ConfirmBoxCoreConfigurator = ServiceLocator.injector.get(ConfirmBoxConfigService);
        const baseSettings = new ConfirmBoxSettings();
        const dataControl = new DataControl();
        dataControl.copyValuesFrom(ConfirmBoxCoreConfigurator.productionConfig.ConfirmBoxCoreConfig, baseSettings.ConfirmBoxCoreConfig);
        this.ConfirmBoxCoreConfig = baseSettings.ConfirmBoxCoreConfig;
        this.Buttons = ConfirmBoxCoreConfigurator.productionConfig.Buttons.slice();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xhc3Nlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL25neC1hd2Vzb21lLXBvcHVwL3R5cGVzL2NvbmZpcm0tYm94L2NvcmUvY2xhc3Nlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFPM0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUVyRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDMUQsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDdkUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFVMUQsTUFBTSxPQUFPLHFCQUFxQjtJQUloQztRQUhBLGdCQUFnQjtRQUNSLHNCQUFpQixHQUFzQixJQUFJLGlCQUFpQixFQUFFLENBQUM7SUFFeEQsQ0FBQztJQUVoQixlQUFlO1FBQ2IsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsZUFBZSxFQUFFLENBQUMsSUFBSSxDQUNsRCxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDVCxNQUFNLHVCQUF1QixHQUFHLElBQUksa0JBQWtCLEVBQUUsQ0FBQztZQUN6RCxNQUFNLFdBQVcsR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFDO1lBQ3RDLFdBQVcsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLHVCQUF1QixDQUFDLENBQUM7WUFDMUQsT0FBTyx1QkFBdUIsQ0FBQztRQUNqQyxDQUFDLENBQUMsRUFDRixJQUFJLENBQUMsQ0FBQyxDQUFDLENBQ1IsQ0FBQztJQUNKLENBQUM7SUFFRCxVQUFVLENBQUMsUUFBbUI7UUFDNUIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FB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QUFFLENBQUMsQ0FBQyxDQUFDO1FBS3JFLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLDBCQUEwQixDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUM1RSxNQUFNLDBCQUEwQixHQUE0QixjQUFjLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1FBQ2pILE1BQU0sWUFBWSxHQUFHLElBQUksa0JBQWtCLEVBQUUsQ0FBQztRQUM5QyxNQUFNLFdBQVcsR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFDO1FBQ3RDLFdBQVcsQ0FBQyxjQUFjLENBQ3hCLDBCQUEwQixDQUFDLGdCQUFnQixDQUFDLG9CQUFvQixFQUNoRSxZQUFZLENBQUMsb0JBQW9CLENBQ2xDLENBQUM7UUFDRixJQUFJLENBQUMsb0JBQW9CLEdBQUcsWUFBWSxDQUFDLG9CQUFvQixDQUFDO1FBQzlELElBQUksQ0FBQyxPQUFPLEdBQUcsMEJBQTBCLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQzdFLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgdGFrZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7XG4gIEFwcGVhcmFuY2VBbmltYXRpb24sXG4gIERpYWxvZ0xheW91dERpc3BsYXksXG4gIERpc2FwcGVhcmFuY2VBbmltYXRpb24sXG4gIFZlcnRpY2FsUG9zaXRpb25cbn0gZnJvbSAnLi4vLi4vLi4vY29yZS9lbnVtcyc7XG5pbXBvcnQgeyBEYXRhQ29udHJvbCwgRGlzcGF0Y2ggfSBmcm9tICcuLi8uLi8uLi9jb3JlL2dsb2JhbC1jbGFzc2VzJztcbmltcG9ydCB7IElCdXR0b24sIElEaXNwYXRjaCB9IGZyb20gJy4uLy4uLy4uL2NvcmUvZ2xvYmFsLWludGVyZmFjZXMnO1xuaW1wb3J0IHsgU2VydmljZUxvY2F0b3IgfSBmcm9tICcuLi8uLi8uLi9sb2NhdG9yLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29uZmlybUJveENvbmZpZ1NlcnZpY2UgfSBmcm9tICcuL2NvbmZpcm0tYm94LWNvbmZpZy5zZXJ2aWNlJztcbmltcG9ydCB7IENvbmZpcm1Cb3hTZXJ2aWNlIH0gZnJvbSAnLi9jb25maXJtLWJveC1zZXJ2aWNlJztcbmltcG9ydCB7XG4gIElDb25maXJtQm94QmVsb25naW5nLFxuICBJQ29uZmlybUJveENvcmVDb25maWcsXG4gIElDb25maXJtQm94Q3VzdG9tU3R5bGVzLFxuICBJQ29uZmlybUJveFB1YmxpY1Jlc3BvbnNlLFxuICBJQ29uZmlybUJveFJlc3BvbnNlLFxuICBJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkXG59IGZyb20gJy4vaW50ZXJmYWNlcyc7XG5cbmV4cG9ydCBjbGFzcyBDb25maXJtQm94SW5pdGlhbGl6ZXIge1xuICAvKiogQGludGVybmFsICovXG4gIHByaXZhdGUgY29uZmlybUJveENhcnJpZXI6IENvbmZpcm1Cb3hDYXJyaWVyID0gbmV3IENvbmZpcm1Cb3hDYXJyaWVyKCk7XG5cbiAgY29uc3RydWN0b3IoKSB7fVxuXG4gIG9wZW5Db25maXJtQm94JCgpOiBPYnNlcnZhYmxlPElDb25maXJtQm94UHVibGljUmVzcG9uc2U+IHtcbiAgICByZXR1cm4gdGhpcy5jb25maXJtQm94Q2Fycmllci5vcGVuQ29uZmlybUJveCQoKS5waXBlKFxuICAgICAgbWFwKHJlc3AgPT4ge1xuICAgICAgICBjb25zdCBiYXNpY0NvbmZpcm1Cb3hSZXNwb25zZSA9IG5ldyBDb25maXJtQm94UmVzcG9uc2UoKTtcbiAgICAgICAgY29uc3QgZGF0YUNvbnRyb2wgPSBuZXcgRGF0YUNvbnRyb2woKTtcbiAgICAgICAgZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20ocmVzcCwgYmFzaWNDb25maXJtQm94UmVzcG9uc2UpO1xuICAgICAgICByZXR1cm4gYmFzaWNDb25maXJtQm94UmVzcG9uc2U7XG4gICAgICB9KSxcbiAgICAgIHRha2UoMSlcbiAgICApO1xuICB9XG5cbiAgc2V0QnV0dG9ucyhfQnV0dG9uczogSUJ1dHRvbltdKTogdm9pZCB7XG4gICAgdGhpcy5jb25maXJtQm94Q2Fycmllci5zZXRCdXR0b25zKF9CdXR0b25zKTtcbiAgfVxuXG4gIHNldENvbmZpZyhfQ29uZmlybUJveENvcmVDb25maWc6IElDb25maXJtQm94Q29yZUNvbmZpZykge1xuICAgIHRoaXMuY29uZmlybUJveENhcnJpZXIuc2V0Q29uZmlnKF9Db25maXJtQm94Q29yZUNvbmZpZyk7XG4gIH1cblxuICBzZXREaXNwYXRjaChfVGl0bGU6IHN0cmluZywgX01lc3NhZ2U6IHN0cmluZyA9IG51bGwpOiB2b2lkIHtcbiAgICB0aGlzLmNvbmZpcm1Cb3hDYXJyaWVyLnNldFRpdGxlKF9UaXRsZSk7XG4gICAgdGhpcy5jb25maXJtQm94Q2Fycmllci5zZXRNZXNzYWdlKF9NZXNzYWdlKTtcbiAgfVxuXG4gIHNldFRpdGxlKF9UaXRsZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5jb25maXJtQm94Q2Fycmllci5zZXRUaXRsZShfVGl0bGUpO1xuICB9XG5cbiAgc2V0TWVzc2FnZShfTWVzc2FnZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5jb25maXJtQm94Q2Fycmllci5zZXRNZXNzYWdlKF9NZXNzYWdlKTtcbiAgfVxuXG4gIHNldEJ1dHRvbkxhYmVscyhfQ29uZmlybTogc3RyaW5nLCBfRGVjbGluZT86IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuY29uZmlybUJveENhcnJpZXIuc2V0QnV0dG9uTGFiZWxzKF9Db25maXJtLCBfRGVjbGluZSk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIENvbmZpcm1Cb3hSZXNwb25zZSBleHRlbmRzIERhdGFDb250cm9sIGltcGxlbWVudHMgSUNvbmZpcm1Cb3hSZXNwb25zZSwgSUNvbmZpcm1Cb3hQdWJsaWNSZXNwb25zZSB7XG4gIC8vIHByaXZhdGUgUmVzcG9uc2U6IERpYWxvZ1ByZXBhcmVSZXNwb25zZSAgICAgICAgICAgID0gbmV3IERpYWxvZ1ByZXBhcmVSZXNwb25zZSgpO1xuXG4gIFN1Y2Nlc3M6IGJvb2xlYW4gPSBudWxsO1xuICBDbGlja2VkQnV0dG9uSUQ6IHN0cmluZyA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIHNldFN1Y2Nlc3MoX0lzU3VjY2VzczogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuU3VjY2VzcyA9IF9Jc1N1Y2Nlc3M7XG4gIH1cblxuICBzZXRDbGlja2VkQnV0dG9uSUQoX0NsaWNrZWRCdXR0b25JRCk6IHZvaWQge1xuICAgIHRoaXMuQ2xpY2tlZEJ1dHRvbklEID0gX0NsaWNrZWRCdXR0b25JRDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ29uZmlybUJveEV2ZW50c0NvbnRyb2xsZXIge1xuICBkZWZhdWx0UmVzcG9uc2U6IElQcml2YXRlUmVzcG9uc2VNZXJnZWQ7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBfYWZ0ZXJDbG9zZWQ6IFN1YmplY3Q8SVByaXZhdGVSZXNwb25zZU1lcmdlZD4gPSBuZXcgU3ViamVjdDxJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPigpO1xuICBhZnRlckNsb3NlZCQ6IE9ic2VydmFibGU8SVByaXZhdGVSZXNwb25zZU1lcmdlZD4gPSB0aGlzLl9hZnRlckNsb3NlZC5hc09ic2VydmFibGUoKTtcblxuICBwcml2YXRlIHJlYWRvbmx5IF9vbkJ1dHRvbkNsaWNrOiBTdWJqZWN0PElCdXR0b24+ID0gbmV3IFN1YmplY3Q8SUJ1dHRvbj4oKTtcbiAgb25CdXR0b25DbGljayQ6IE9ic2VydmFibGU8SUJ1dHRvbj4gPSB0aGlzLl9vbkJ1dHRvbkNsaWNrLmFzT2JzZXJ2YWJsZSgpO1xuICBwcml2YXRlIHJlYWRvbmx5IF9idXR0b25MaXN0OiBTdWJqZWN0PElCdXR0b25bXT4gPSBuZXcgU3ViamVjdDxJQnV0dG9uW10+KCk7XG4gIGJ1dHRvbkxpc3QkOiBPYnNlcnZhYmxlPElCdXR0b25bXT4gPSB0aGlzLl9idXR0b25MaXN0LmFzT2JzZXJ2YWJsZSgpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgRW50aXR5VW5pcXVlSUQ6IHN0cmluZykge31cblxuICBjbG9zZShfUmVzcG9uc2U/OiBJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkKTogdm9pZCB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBfUmVzcG9uc2UgPyBfUmVzcG9uc2UgOiB0aGlzLmRlZmF1bHRSZXNwb25zZTtcbiAgICB0aGlzLl9hZnRlckNsb3NlZC5uZXh0KHJlc3BvbnNlKTtcbiAgfVxuXG4gIG9uQnV0dG9uQ2xpY2soX0J1dHRvbjogSUJ1dHRvbik6IHZvaWQge1xuICAgIHRoaXMuZGVmYXVsdFJlc3BvbnNlLnNldENsaWNrZWRCdXR0b25JRChfQnV0dG9uLklEKTtcbiAgICB0aGlzLl9vbkJ1dHRvbkNsaWNrLm5leHQoX0J1dHRvbik7XG4gIH1cblxuICBzZXRCdXR0b25MaXN0KF9CdXR0b25MaXN0OiBJQnV0dG9uW10pOiB2b2lkIHtcbiAgICB0aGlzLl9idXR0b25MaXN0Lm5leHQoX0J1dHRvbkxpc3QpO1xuICB9XG5cbiAgc2V0RGVmYXVsdFJlc3BvbnNlKF9SZXNwb25zZTogSVByaXZhdGVSZXNwb25zZU1lcmdlZCk6IHZvaWQge1xuICAgIHRoaXMuZGVmYXVsdFJlc3BvbnNlID0gX1Jlc3BvbnNlO1xuICB9XG59XG5cbi8vIGVuZHJlZ2lvblxuXG5leHBvcnQgY2xhc3MgQ29uZmlybUJveERlZmF1bHRSZXNwb25zZSBleHRlbmRzIENvbmZpcm1Cb3hSZXNwb25zZSBpbXBsZW1lbnRzIElQcml2YXRlUmVzcG9uc2VNZXJnZWQge1xuICBjb25maXJtQm94QmVsb25naW5nOiBDb25maXJtQm94QmVsb25naW5nID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgc2V0QmVsb25naW5nKF9Db25maXJtQm94QmVsb25naW5nKTogdm9pZCB7XG4gICAgdGhpcy5jb25maXJtQm94QmVsb25naW5nID0gX0NvbmZpcm1Cb3hCZWxvbmdpbmc7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIENvbmZpcm1Cb3hDYXJyaWVyIHtcbiAgY29uZmlybUJveEJlbG9uZ2luZzogQ29uZmlybUJveEJlbG9uZ2luZyA9IG5ldyBDb25maXJtQm94QmVsb25naW5nKCk7XG5cbiAgY29uc3RydWN0b3IoKSB7fVxuXG4gIHNldEJ1dHRvbnMoX0J1dHRvbnM6IElCdXR0b25bXSkge1xuICAgIGlmIChfQnV0dG9ucy5sZW5ndGgpIHtcbiAgICAgIHRoaXMuY29uZmlybUJveEJlbG9uZ2luZy5CdXR0b25zID0gX0J1dHRvbnM7XG4gICAgfVxuICB9XG5cbiAgc2V0VGl0bGUoX1RpdGxlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmNvbmZpcm1Cb3hCZWxvbmdpbmcuRGlzcGF0Y2guVGl0bGUgPSBfVGl0bGU7XG4gIH1cblxuICBzZXRNZXNzYWdlKF9NZXNzYWdlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmNvbmZpcm1Cb3hCZWxvbmdpbmcuRGlzcGF0Y2guTWVzc2FnZSA9IF9NZXNzYWdlO1xuICB9XG5cbiAgc2V0QnV0dG9uTGFiZWxzKF9Db25maXJtOiBzdHJpbmcsIF9EZWNsaW5lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmNvbmZpcm1Cb3hCZWxvbmdpbmcuQ29uZmlybUJveENvcmVDb25maWcuQ29uZmlybUxhYmVsID0gX0NvbmZpcm07XG4gICAgdGhpcy5jb25maXJtQm94QmVsb25naW5nLkNvbmZpcm1Cb3hDb3JlQ29uZmlnLkRlY2xpbmVMYWJlbCA9IF9EZWNsaW5lO1xuICB9XG5cbiAgc2V0Q29uZmlnKF9Db25maXJtQm94QmVsb25naW5nOiBJQ29uZmlybUJveENvcmVDb25maWcpIHtcbiAgICAvLyByZWdpb24gKioqIGxvY2FsIFVzZXJDb25maWcgKGRlZmluZWQgb24gcGxhY2Ugd2hlcmUgZGlhbG9nIGlzIGNhbGxlZCkgKioqXG4gICAgY29uc3QgZGF0YUNvbnRyb2wgPSBuZXcgRGF0YUNvbnRyb2woKTtcbiAgICBkYXRhQ29udHJvbC5jb3B5VmFsdWVzRnJvbShfQ29uZmlybUJveEJlbG9uZ2luZywgdGhpcy5jb25maXJtQm94QmVsb25naW5nLkNvbmZpcm1Cb3hDb3JlQ29uZmlnKTtcbiAgICAvLyBlbmRyZWdpb25cbiAgfVxuXG4gIG9wZW5Db25maXJtQm94JCgpOiBPYnNlcnZhYmxlPElQcml2YXRlUmVzcG9uc2VNZXJnZWQ+IHtcbiAgICBjb25zdCBzZXJ2aWNlOiBDb25maXJtQm94U2VydmljZSA9IFNlcnZpY2VMb2NhdG9yLmluamVjdG9yLmdldChDb25maXJtQm94U2VydmljZSk7XG4gICAgY29uc3QgY29uZmlybUJveENvbnRyb2xsZXIgPSBzZXJ2aWNlLm9wZW4odGhpcy5jb25maXJtQm94QmVsb25naW5nKTtcbiAgICByZXR1cm4gY29uZmlybUJveENvbnRyb2xsZXIuYWZ0ZXJDbG9zZWQkO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDb25maXJtQm94U2V0dGluZ3Mge1xuICBCdXR0b25zOiBJQnV0dG9uW10gPSBbXTtcbiAgQ29uZmlybUJveENvcmVDb25maWc6IElDb25maXJtQm94Q29yZUNvbmZpZyA9IG5ldyBDb25maXJtQm94Q29yZUNvbmZpZygpO1xuICBEaXNwYXRjaDogSURpc3BhdGNoID0gbmV3IERpc3BhdGNoKCk7XG59XG5cbmV4cG9ydCBjbGFzcyBDb25maXJtQm94Q3VzdG9tU3R5bGVzIGltcGxlbWVudHMgSUNvbmZpcm1Cb3hDdXN0b21TdHlsZXMge1xuICBUaXRsZUNTUzogc3RyaW5nID0gbnVsbDtcbiAgVGV4dENTUzogc3RyaW5nID0gbnVsbDtcbiAgQnV0dG9uU2VjdGlvbkNTUzogc3RyaW5nID0gbnVsbDtcbiAgQnV0dG9uQ1NTOiBzdHJpbmcgPSBudWxsO1xuICBXcmFwcGVyQ1NTOiBzdHJpbmcgPSBudWxsO1xufVxuXG5leHBvcnQgY2xhc3MgQ29uZmlybUJveENvcmVDb25maWcgaW1wbGVtZW50cyBJQ29uZmlybUJveENvcmVDb25maWcge1xuICBXaWR0aDogc3RyaW5nID0gbnVsbDtcbiAgSGVpZ2h0OiBzdHJpbmcgPSBudWxsO1xuICBCdXR0b25Qb3NpdGlvbjogVmVydGljYWxQb3NpdGlvbiA9IG51bGw7XG4gIExheW91dFR5cGU6IERpYWxvZ0xheW91dERpc3BsYXkgPSBudWxsO1xuICBEaXNwYXRjaDogSURpc3BhdGNoID0gbnVsbDtcbiAgQ29uZmlybUxhYmVsOiBzdHJpbmcgPSBudWxsO1xuICBEZWNsaW5lTGFiZWw6IHN0cmluZyA9IG51bGw7XG4gIERpc2FibGVJY29uOiBib29sZWFuID0gbnVsbDtcbiAgQWxsb3dIVE1MTWVzc2FnZTogYm9vbGVhbiA9IG51bGw7XG4gIEFuaW1hdGlvbkluOiBBcHBlYXJhbmNlQW5pbWF0aW9uID0gbnVsbDtcbiAgQW5pbWF0aW9uT3V0OiBEaXNhcHBlYXJhbmNlQW5pbWF0aW9uID0gbnVsbDtcbiAgQ3VzdG9tU3R5bGVzOiBDb25maXJtQm94Q3VzdG9tU3R5bGVzID0gbmV3IENvbmZpcm1Cb3hDdXN0b21TdHlsZXMoKTtcbn1cblxuZXhwb3J0IGNsYXNzIENvbmZpcm1Cb3hCZWxvbmdpbmcgZXh0ZW5kcyBDb25maXJtQm94U2V0dGluZ3MgaW1wbGVtZW50cyBJQ29uZmlybUJveEJlbG9uZ2luZyB7XG4gIEVudGl0eVVuaXF1ZUlEOiBzdHJpbmcgPSAnQycgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7XG4gIEV2ZW50c0NvbnRyb2xsZXI6IENvbmZpcm1Cb3hFdmVudHNDb250cm9sbGVyO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5FdmVudHNDb250cm9sbGVyID0gbmV3IENvbmZpcm1Cb3hFdmVudHNDb250cm9sbGVyKHRoaXMuRW50aXR5VW5pcXVlSUQpO1xuICAgIGNvbnN0IENvbmZpcm1Cb3hDb3JlQ29uZmlndXJhdG9yOiBDb25maXJtQm94Q29uZmlnU2VydmljZSA9IFNlcnZpY2VMb2NhdG9yLmluamVjdG9yLmdldChDb25maXJtQm94Q29uZmlnU2VydmljZSk7XG4gICAgY29uc3QgYmFzZVNldHRpbmdzID0gbmV3IENvbmZpcm1Cb3hTZXR0aW5ncygpO1xuICAgIGNvbnN0IGRhdGFDb250cm9sID0gbmV3IERhdGFDb250cm9sKCk7XG4gICAgZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20oXG4gICAgICBDb25maXJtQm94Q29yZUNvbmZpZ3VyYXRvci5wcm9kdWN0aW9uQ29uZmlnLkNvbmZpcm1Cb3hDb3JlQ29uZmlnLFxuICAgICAgYmFzZVNldHRpbmdzLkNvbmZpcm1Cb3hDb3JlQ29uZmlnXG4gICAgKTtcbiAgICB0aGlzLkNvbmZpcm1Cb3hDb3JlQ29uZmlnID0gYmFzZVNldHRpbmdzLkNvbmZpcm1Cb3hDb3JlQ29uZmlnO1xuICAgIHRoaXMuQnV0dG9ucyA9IENvbmZpcm1Cb3hDb3JlQ29uZmlndXJhdG9yLnByb2R1Y3Rpb25Db25maWcuQnV0dG9ucy5zbGljZSgpO1xuICB9XG59XG4iXX0=