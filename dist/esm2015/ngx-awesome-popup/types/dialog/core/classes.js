import { Subject } from 'rxjs';
import { map, take } from 'rxjs/operators';
import { DataControl, Sizes } from '../../../core/global-classes';
import { ServiceLocator } from '../../../locator.service';
import { DialogConfigService } from './dialog-config.service';
import { DialogService } from './dialog.service';
// region *** Public ***
export class DialogInitializer {
    constructor(component) {
        this.component = component;
        this.dialogCarrier = new DialogCarrier();
        this.dialogCarrier.setComponent(this.component);
    }
    /** Generic method accept expected payload from dynamic child component.*/
    openDialog$() {
        return this.dialogCarrier.openDialog$().pipe(map(resp => {
            const basicDialogResponse = new DialogResponse();
            const dataControl = new DataControl();
            dataControl.copyValuesFrom(resp, basicDialogResponse);
            return basicDialogResponse;
        }), take(1));
    }
    /** It accepts list of custom buttons */
    setButtons(_Buttons) {
        this.dialogCarrier.setButtons(_Buttons);
    }
    setCustomData(_CustomData) {
        this.dialogCarrier.setCustomData(_CustomData);
    }
    setConfig(_DialogConfig) {
        this.dialogCarrier.setConfig(_DialogConfig);
    }
}
export class DialogResponse extends DataControl {
    constructor() {
        super();
        // private Response: DialogPrepareResponse            = new DialogPrepareResponse();
        this.Payload = null;
        this.Success = null;
        this.ClickedButtonID = null;
    }
    /**
     * @ignore
     */
    setPayload(_Payload) {
        this.Payload = _Payload;
    }
    /**
     * @ignore
     */
    setClickedButtonID(_ClickedButtonID) {
        this.ClickedButtonID = _ClickedButtonID;
    }
}
export class DialogEventsController {
    constructor(EntityUniqueID) {
        this.EntityUniqueID = EntityUniqueID;
        this._afterClosed = new Subject();
        this.afterClosed$ = this._afterClosed.asObservable();
        this._afterLoader = new Subject();
        this.afterLoader$ = this._afterLoader.asObservable();
        this._onButtonClick = new Subject();
        this.onButtonClick$ = this._onButtonClick.asObservable();
        this._buttonList = new Subject();
        this.buttonList$ = this._buttonList.asObservable();
    }
    close(_Payload = null) {
        this.defaultResponse.setPayload(_Payload);
        this._afterClosed.next(this.defaultResponse);
    }
    onButtonClick(_Button) {
        this.defaultResponse.setClickedButtonID(_Button.ID);
        this._onButtonClick.next(_Button);
    }
    setButtonList(_ButtonList) {
        this._buttonList.next(_ButtonList);
    }
    closeLoader() {
        setTimeout(() => {
            this._afterLoader.next(this.EntityUniqueID);
        }, 0);
    }
    setDefaultResponse(_Response) {
        this.defaultResponse = _Response;
    }
}
// endregion
export class DialogDefaultResponse extends DialogResponse {
    constructor() {
        super();
        this.DialogBelonging = null;
    }
    setBelonging(_DialogBelonging) {
        this.DialogBelonging = _DialogBelonging;
    }
}
export class DialogCarrier {
    constructor() {
        this.dialogBelonging = new DialogBelonging();
    }
    setComponent(_Component) {
        this.component = _Component;
    }
    setButtons(_Buttons) {
        if (_Buttons.length) {
            this.dialogBelonging.Buttons = _Buttons;
        }
    }
    setCustomData(_CustomData) {
        this.dialogBelonging.CustomData = _CustomData;
    }
    setConfig(_DialogConfig) {
        // region *** local UserConfig (defined on place where dialog is called) ***
        const dataControl = new DataControl();
        dataControl.copyValuesFrom(_DialogConfig, this.dialogBelonging.DialogCoreConfig);
        if (_DialogConfig === null || _DialogConfig === void 0 ? void 0 : _DialogConfig.LoaderComponent) {
            this.dialogBelonging.DialogCoreConfig.DisplayLoader = true;
        }
        // endregion
    }
    openDialog$() {
        const service = ServiceLocator.injector.get(DialogService);
        const dialogController = service.open(this.component, this.dialogBelonging);
        return dialogController.afterClosed$;
    }
}
export class DialogCustomStyles {
    constructor() {
        this.ButtonSectionCSS = null;
        this.ButtonCSS = null;
        this.WrapperCSS = null;
    }
}
export class DialogCoreConfig extends Sizes {
    constructor() {
        super(...arguments);
        this.EscapeKeyClose = null;
        this.HideScrollbar = null;
        this.ButtonPosition = null;
        this.LayoutType = null;
        this.DisplayLoader = null;
        this.LoaderComponent = null;
        this.AnimationIn = null;
        this.AnimationOut = null;
        this.CustomStyles = new DialogCustomStyles();
    }
}
export class DialogSettings {
    constructor() {
        this.Buttons = [];
        this.DialogCoreConfig = new DialogCoreConfig();
    }
}
export class DialogBelonging extends DialogSettings {
    constructor() {
        super();
        /** @internal */
        this.EntityUniqueID = 'D' + Math.random().toString(36).substr(2, 9);
        this.CustomData = null;
        this.EventsController = new DialogEventsController(this.EntityUniqueID);
        const dialogConfigurator = ServiceLocator.injector.get(DialogConfigService);
        const baseSettings = new DialogSettings();
        const dataControl = new DataControl();
        dataControl.copyValuesFrom(dialogConfigurator.productionConfig.DialogCoreConfig, baseSettings.DialogCoreConfig);
        this.DialogCoreConfig = baseSettings.DialogCoreConfig;
        this.Buttons = dialogConfigurator.productionConfig.Buttons.slice();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xhc3Nlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL25neC1hd2Vzb21lLXBvcHVwL3R5cGVzL2RpYWxvZy9jb3JlL2NsYXNzZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBTzNDLE9BQU8sRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFFbEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzFELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQzlELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQVdqRCx3QkFBd0I7QUFFeEIsTUFBTSxPQUFPLGlCQUFpQjtJQUc1QixZQUFvQixTQUFvQjtRQUFwQixjQUFTLEdBQVQsU0FBUyxDQUFXO1FBRmhDLGtCQUFhLEdBQWtCLElBQUksYUFBYSxFQUFFLENBQUM7UUFHekQsSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ2xELENBQUM7SUFFRCwwRUFBMEU7SUFDMUUsV0FBVztRQUNULE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxJQUFJLENBQzFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUNULE1BQU0sbUJBQW1CLEdBQUcsSUFBSSxjQUFjLEVBQUUsQ0FBQztZQUNqRCxNQUFNLFdBQVcsR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFDO1lBQ3RDLFdBQVcsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLG1CQUFtQixDQUFDLENBQUM7WUFDdEQsT0FBTyxtQkFBbUIsQ0FBQztRQUM3QixDQUFDLENBQUMsRUFD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QWMsRUFBRSxDQUFDO1FBQzFDLE1BQU0sV0FBVyxHQUFHLElBQUksV0FBVyxFQUFFLENBQUM7UUFDdEMsV0FBVyxDQUFDLGNBQWMsQ0FBQyxrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxnQkFBZ0IsRUFBRSxZQUFZLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUNoSCxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsWUFBWSxDQUFDLGdCQUFnQixDQUFDO1FBQ3RELElBQUksQ0FBQyxPQUFPLEdBQUcsa0JBQWtCLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3JFLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFR5cGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgdGFrZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7XG4gIEFwcGVhcmFuY2VBbmltYXRpb24sXG4gIERpYWxvZ0xheW91dERpc3BsYXksXG4gIERpc2FwcGVhcmFuY2VBbmltYXRpb24sXG4gIFZlcnRpY2FsUG9zaXRpb25cbn0gZnJvbSAnLi4vLi4vLi4vY29yZS9lbnVtcyc7XG5pbXBvcnQgeyBEYXRhQ29udHJvbCwgU2l6ZXMgfSBmcm9tICcuLi8uLi8uLi9jb3JlL2dsb2JhbC1jbGFzc2VzJztcbmltcG9ydCB7IElCdXR0b24gfSBmcm9tICcuLi8uLi8uLi9jb3JlL2dsb2JhbC1pbnRlcmZhY2VzJztcbmltcG9ydCB7IFNlcnZpY2VMb2NhdG9yIH0gZnJvbSAnLi4vLi4vLi4vbG9jYXRvci5zZXJ2aWNlJztcbmltcG9ydCB7IERpYWxvZ0NvbmZpZ1NlcnZpY2UgfSBmcm9tICcuL2RpYWxvZy1jb25maWcuc2VydmljZSc7XG5pbXBvcnQgeyBEaWFsb2dTZXJ2aWNlIH0gZnJvbSAnLi9kaWFsb2cuc2VydmljZSc7XG5pbXBvcnQge1xuICBJRGlhbG9nQmVsb25naW5nLFxuICBJRGlhbG9nQ29yZUNvbmZpZyxcbiAgSURpYWxvZ0N1c3RvbVN0eWxlcyxcbiAgSURpYWxvZ0V2ZW50c0NvbnRyb2xsZXIsXG4gIElEaWFsb2dQdWJsaWNSZXNwb25zZSxcbiAgSURpYWxvZ1Jlc3BvbnNlLFxuICBJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkXG59IGZyb20gJy4vaW50ZXJmYWNlcyc7XG5cbi8vIHJlZ2lvbiAqKiogUHVibGljICoqKlxuXG5leHBvcnQgY2xhc3MgRGlhbG9nSW5pdGlhbGl6ZXIge1xuICBwcml2YXRlIGRpYWxvZ0NhcnJpZXI6IERpYWxvZ0NhcnJpZXIgPSBuZXcgRGlhbG9nQ2FycmllcigpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY29tcG9uZW50OiBUeXBlPGFueT4pIHtcbiAgICB0aGlzLmRpYWxvZ0NhcnJpZXIuc2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50KTtcbiAgfVxuXG4gIC8qKiBHZW5lcmljIG1ldGhvZCBhY2NlcHQgZXhwZWN0ZWQgcGF5bG9hZCBmcm9tIGR5bmFtaWMgY2hpbGQgY29tcG9uZW50LiovXG4gIG9wZW5EaWFsb2ckPFJlc3BvbnNlUGF5bG9hZCA9IGFueT4oKTogT2JzZXJ2YWJsZTxJRGlhbG9nUHVibGljUmVzcG9uc2U8UmVzcG9uc2VQYXlsb2FkPj4ge1xuICAgIHJldHVybiB0aGlzLmRpYWxvZ0NhcnJpZXIub3BlbkRpYWxvZyQoKS5waXBlKFxuICAgICAgbWFwKHJlc3AgPT4ge1xuICAgICAgICBjb25zdCBiYXNpY0RpYWxvZ1Jlc3BvbnNlID0gbmV3IERpYWxvZ1Jlc3BvbnNlKCk7XG4gICAgICAgIGNvbnN0IGRhdGFDb250cm9sID0gbmV3IERhdGFDb250cm9sKCk7XG4gICAgICAgIGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKHJlc3AsIGJhc2ljRGlhbG9nUmVzcG9uc2UpO1xuICAgICAgICByZXR1cm4gYmFzaWNEaWFsb2dSZXNwb25zZTtcbiAgICAgIH0pLFxuICAgICAgdGFrZSgxKVxuICAgICk7XG4gIH1cblxuICAvKiogSXQgYWNjZXB0cyBsaXN0IG9mIGN1c3RvbSBidXR0b25zICovXG4gIHNldEJ1dHRvbnMoX0J1dHRvbnM6IElCdXR0b25bXSk6IHZvaWQge1xuICAgIHRoaXMuZGlhbG9nQ2Fycmllci5zZXRCdXR0b25zKF9CdXR0b25zKTtcbiAgfVxuXG4gIHNldEN1c3RvbURhdGEoX0N1c3RvbURhdGE6IGFueSkge1xuICAgIHRoaXMuZGlhbG9nQ2Fycmllci5zZXRDdXN0b21EYXRhKF9DdXN0b21EYXRhKTtcbiAgfVxuXG4gIHNldENvbmZpZyhfRGlhbG9nQ29uZmlnOiBJRGlhbG9nQ29yZUNvbmZpZykge1xuICAgIHRoaXMuZGlhbG9nQ2Fycmllci5zZXRDb25maWcoX0RpYWxvZ0NvbmZpZyk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIERpYWxvZ1Jlc3BvbnNlIGV4dGVuZHMgRGF0YUNvbnRyb2wgaW1wbGVtZW50cyBJRGlhbG9nUmVzcG9uc2UsIElEaWFsb2dQdWJsaWNSZXNwb25zZTxhbnk+IHtcbiAgLy8gcHJpdmF0ZSBSZXNwb25zZTogRGlhbG9nUHJlcGFyZVJlc3BvbnNlICAgICAgICAgICAgPSBuZXcgRGlhbG9nUHJlcGFyZVJlc3BvbnNlKCk7XG5cbiAgUGF5bG9hZDogYW55ID0gbnVsbDtcbiAgU3VjY2VzczogYm9vbGVhbiA9IG51bGw7XG4gIENsaWNrZWRCdXR0b25JRDogc3RyaW5nID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIHNldFBheWxvYWQoX1BheWxvYWQ6IGFueSk6IHZvaWQge1xuICAgIHRoaXMuUGF5bG9hZCA9IF9QYXlsb2FkO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIHNldENsaWNrZWRCdXR0b25JRChfQ2xpY2tlZEJ1dHRvbklEKTogdm9pZCB7XG4gICAgdGhpcy5DbGlja2VkQnV0dG9uSUQgPSBfQ2xpY2tlZEJ1dHRvbklEO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBEaWFsb2dFdmVudHNDb250cm9sbGVyIGltcGxlbWVudHMgSURpYWxvZ0V2ZW50c0NvbnRyb2xsZXIge1xuICBkZWZhdWx0UmVzcG9uc2U6IElQcml2YXRlUmVzcG9uc2VNZXJnZWQ7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBfYWZ0ZXJDbG9zZWQ6IFN1YmplY3Q8SVByaXZhdGVSZXNwb25zZU1lcmdlZD4gPSBuZXcgU3ViamVjdDxJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPigpO1xuICBhZnRlckNsb3NlZCQ6IE9ic2VydmFibGU8SVByaXZhdGVSZXNwb25zZU1lcmdlZD4gPSB0aGlzLl9hZnRlckNsb3NlZC5hc09ic2VydmFibGUoKTtcblxuICBwcml2YXRlIHJlYWRvbmx5IF9hZnRlckxvYWRlcjogYW55ID0gbmV3IFN1YmplY3Q8c3RyaW5nPigpO1xuICBhZnRlckxvYWRlciQ6IE9ic2VydmFibGU8c3RyaW5nPiA9IHRoaXMuX2FmdGVyTG9hZGVyLmFzT2JzZXJ2YWJsZSgpO1xuICBwcml2YXRlIHJlYWRvbmx5IF9vbkJ1dHRvbkNsaWNrOiBTdWJqZWN0PElCdXR0b24+ID0gbmV3IFN1YmplY3Q8SUJ1dHRvbj4oKTtcbiAgb25CdXR0b25DbGljayQ6IE9ic2VydmFibGU8SUJ1dHRvbj4gPSB0aGlzLl9vbkJ1dHRvbkNsaWNrLmFzT2JzZXJ2YWJsZSgpO1xuICBwcml2YXRlIHJlYWRvbmx5IF9idXR0b25MaXN0OiBTdWJqZWN0PElCdXR0b25bXT4gPSBuZXcgU3ViamVjdDxJQnV0dG9uW10+KCk7XG4gIGJ1dHRvbkxpc3QkOiBPYnNlcnZhYmxlPElCdXR0b25bXT4gPSB0aGlzLl9idXR0b25MaXN0LmFzT2JzZXJ2YWJsZSgpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgRW50aXR5VW5pcXVlSUQ6IHN0cmluZykge31cblxuICBjbG9zZShfUGF5bG9hZDogYW55ID0gbnVsbCk6IHZvaWQge1xuICAgIHRoaXMuZGVmYXVsdFJlc3BvbnNlLnNldFBheWxvYWQoX1BheWxvYWQpO1xuICAgIHRoaXMuX2FmdGVyQ2xvc2VkLm5leHQodGhpcy5kZWZhdWx0UmVzcG9uc2UpO1xuICB9XG5cbiAgb25CdXR0b25DbGljayhfQnV0dG9uOiBJQnV0dG9uKTogdm9pZCB7XG4gICAgdGhpcy5kZWZhdWx0UmVzcG9uc2Uuc2V0Q2xpY2tlZEJ1dHRvbklEKF9CdXR0b24uSUQpO1xuICAgIHRoaXMuX29uQnV0dG9uQ2xpY2submV4dChfQnV0dG9uKTtcbiAgfVxuXG4gIHNldEJ1dHRvbkxpc3QoX0J1dHRvbkxpc3Q6IElCdXR0b25bXSk6IHZvaWQge1xuICAgIHRoaXMuX2J1dHRvbkxpc3QubmV4dChfQnV0dG9uTGlzdCk7XG4gIH1cblxuICBjbG9zZUxvYWRlcigpOiB2b2lkIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuX2FmdGVyTG9hZGVyLm5leHQodGhpcy5FbnRpdHlVbmlxdWVJRCk7XG4gICAgfSwgMCk7XG4gIH1cblxuICBzZXREZWZhdWx0UmVzcG9uc2UoX1Jlc3BvbnNlOiBJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkKTogdm9pZCB7XG4gICAgdGhpcy5kZWZhdWx0UmVzcG9uc2UgPSBfUmVzcG9uc2U7XG4gIH1cbn1cblxuLy8gZW5kcmVnaW9uXG5cbmV4cG9ydCBjbGFzcyBEaWFsb2dEZWZhdWx0UmVzcG9uc2UgZXh0ZW5kcyBEaWFsb2dSZXNwb25zZSBpbXBsZW1lbnRzIElQcml2YXRlUmVzcG9uc2VNZXJnZWQge1xuICBEaWFsb2dCZWxvbmdpbmc6IElEaWFsb2dCZWxvbmdpbmcgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBzZXRCZWxvbmdpbmcoX0RpYWxvZ0JlbG9uZ2luZyk6IHZvaWQge1xuICAgIHRoaXMuRGlhbG9nQmVsb25naW5nID0gX0RpYWxvZ0JlbG9uZ2luZztcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgRGlhbG9nQ2FycmllciB7XG4gIGRpYWxvZ0JlbG9uZ2luZzogRGlhbG9nQmVsb25naW5nID0gbmV3IERpYWxvZ0JlbG9uZ2luZygpO1xuICBwcml2YXRlIGNvbXBvbmVudDogVHlwZTxhbnk+O1xuXG4gIGNvbnN0cnVjdG9yKCkge31cblxuICBzZXRDb21wb25lbnQoX0NvbXBvbmVudDogVHlwZTxhbnk+KTogdm9pZCB7XG4gICAgdGhpcy5jb21wb25lbnQgPSBfQ29tcG9uZW50O1xuICB9XG5cbiAgc2V0QnV0dG9ucyhfQnV0dG9uczogSUJ1dHRvbltdKSB7XG4gICAgaWYgKF9CdXR0b25zLmxlbmd0aCkge1xuICAgICAgdGhpcy5kaWFsb2dCZWxvbmdpbmcuQnV0dG9ucyA9IF9CdXR0b25zO1xuICAgIH1cbiAgfVxuXG4gIHNldEN1c3RvbURhdGEoX0N1c3RvbURhdGE6IGFueSkge1xuICAgIHRoaXMuZGlhbG9nQmVsb25naW5nLkN1c3RvbURhdGEgPSBfQ3VzdG9tRGF0YTtcbiAgfVxuXG4gIHNldENvbmZpZyhfRGlhbG9nQ29uZmlnOiBJRGlhbG9nQ29yZUNvbmZpZykge1xuICAgIC8vIHJlZ2lvbiAqKiogbG9jYWwgVXNlckNvbmZpZyAoZGVmaW5lZCBvbiBwbGFjZSB3aGVyZSBkaWFsb2cgaXMgY2FsbGVkKSAqKipcbiAgICBjb25zdCBkYXRhQ29udHJvbCA9IG5ldyBEYXRhQ29udHJvbCgpO1xuICAgIGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKF9EaWFsb2dDb25maWcsIHRoaXMuZGlhbG9nQmVsb25naW5nLkRpYWxvZ0NvcmVDb25maWcpO1xuICAgIGlmIChfRGlhbG9nQ29uZmlnPy5Mb2FkZXJDb21wb25lbnQpIHtcbiAgICAgIHRoaXMuZGlhbG9nQmVsb25naW5nLkRpYWxvZ0NvcmVDb25maWcuRGlzcGxheUxvYWRlciA9IHRydWU7XG4gICAgfVxuICAgIC8vIGVuZHJlZ2lvblxuICB9XG5cbiAgb3BlbkRpYWxvZyQoKTogT2JzZXJ2YWJsZTxJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPiB7XG4gICAgY29uc3Qgc2VydmljZTogRGlhbG9nU2VydmljZSA9IFNlcnZpY2VMb2NhdG9yLmluamVjdG9yLmdldChEaWFsb2dTZXJ2aWNlKTtcbiAgICBjb25zdCBkaWFsb2dDb250cm9sbGVyID0gc2VydmljZS5vcGVuKHRoaXMuY29tcG9uZW50LCB0aGlzLmRpYWxvZ0JlbG9uZ2luZyk7XG4gICAgcmV0dXJuIGRpYWxvZ0NvbnRyb2xsZXIuYWZ0ZXJDbG9zZWQkO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBEaWFsb2dDdXN0b21TdHlsZXMgaW1wbGVtZW50cyBJRGlhbG9nQ3VzdG9tU3R5bGVzIHtcbiAgQnV0dG9uU2VjdGlvbkNTUzogc3RyaW5nID0gbnVsbDtcbiAgQnV0dG9uQ1NTOiBzdHJpbmcgPSBudWxsO1xuICBXcmFwcGVyQ1NTOiBzdHJpbmcgPSBudWxsO1xufVxuXG5leHBvcnQgY2xhc3MgRGlhbG9nQ29yZUNvbmZpZyBleHRlbmRzIFNpemVzIGltcGxlbWVudHMgSURpYWxvZ0NvcmVDb25maWcge1xuICBFc2NhcGVLZXlDbG9zZTogYm9vbGVhbiA9IG51bGw7XG4gIEhpZGVTY3JvbGxiYXI6IGJvb2xlYW4gPSBudWxsO1xuICBCdXR0b25Qb3NpdGlvbjogVmVydGljYWxQb3NpdGlvbiA9IG51bGw7XG4gIExheW91dFR5cGU6IERpYWxvZ0xheW91dERpc3BsYXkgPSBudWxsO1xuICBEaXNwbGF5TG9hZGVyOiBib29sZWFuID0gbnVsbDtcbiAgTG9hZGVyQ29tcG9uZW50OiBUeXBlPGFueT4gPSBudWxsO1xuICBBbmltYXRpb25JbjogQXBwZWFyYW5jZUFuaW1hdGlvbiA9IG51bGw7XG4gIEFuaW1hdGlvbk91dDogRGlzYXBwZWFyYW5jZUFuaW1hdGlvbiA9IG51bGw7XG4gIEN1c3RvbVN0eWxlczogSURpYWxvZ0N1c3RvbVN0eWxlcyA9IG5ldyBEaWFsb2dDdXN0b21TdHlsZXMoKTtcbn1cblxuZXhwb3J0IGNsYXNzIERpYWxvZ1NldHRpbmdzIHtcbiAgQnV0dG9uczogSUJ1dHRvbltdID0gW107XG4gIERpYWxvZ0NvcmVDb25maWc6IElEaWFsb2dDb3JlQ29uZmlnID0gbmV3IERpYWxvZ0NvcmVDb25maWcoKTtcbn1cblxuZXhwb3J0IGNsYXNzIERpYWxvZ0JlbG9uZ2luZzxDdXN0b21EYXRhID0gYW55PiBleHRlbmRzIERpYWxvZ1NldHRpbmdzIGltcGxlbWVudHMgSURpYWxvZ0JlbG9uZ2luZyB7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgRW50aXR5VW5pcXVlSUQ6IHN0cmluZyA9ICdEJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KTtcblxuICBDdXN0b21EYXRhOiBDdXN0b21EYXRhID0gbnVsbDtcbiAgRXZlbnRzQ29udHJvbGxlcjogSURpYWxvZ0V2ZW50c0NvbnRyb2xsZXI7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLkV2ZW50c0NvbnRyb2xsZXIgPSBuZXcgRGlhbG9nRXZlbnRzQ29udHJvbGxlcih0aGlzLkVudGl0eVVuaXF1ZUlEKTtcbiAgICBjb25zdCBkaWFsb2dDb25maWd1cmF0b3I6IERpYWxvZ0NvbmZpZ1NlcnZpY2UgPSBTZXJ2aWNlTG9jYXRvci5pbmplY3Rvci5nZXQoRGlhbG9nQ29uZmlnU2VydmljZSk7XG4gICAgY29uc3QgYmFzZVNldHRpbmdzID0gbmV3IERpYWxvZ1NldHRpbmdzKCk7XG4gICAgY29uc3QgZGF0YUNvbnRyb2wgPSBuZXcgRGF0YUNvbnRyb2woKTtcbiAgICBkYXRhQ29udHJvbC5jb3B5VmFsdWVzRnJvbShkaWFsb2dDb25maWd1cmF0b3IucHJvZHVjdGlvbkNvbmZpZy5EaWFsb2dDb3JlQ29uZmlnLCBiYXNlU2V0dGluZ3MuRGlhbG9nQ29yZUNvbmZpZyk7XG4gICAgdGhpcy5EaWFsb2dDb3JlQ29uZmlnID0gYmFzZVNldHRpbmdzLkRpYWxvZ0NvcmVDb25maWc7XG4gICAgdGhpcy5CdXR0b25zID0gZGlhbG9nQ29uZmlndXJhdG9yLnByb2R1Y3Rpb25Db25maWcuQnV0dG9ucy5zbGljZSgpO1xuICB9XG59XG4iXX0=