import { Subject } from "rxjs";
import { map, take } from "rxjs/operators";
import { GlobalClass } from "../../../core/global";
import { ServiceLocator } from "../../../locator.service";
import { DialogConfigService } from "./dialog-config.service";
import { DialogService } from "./dialog.service";
export var DialogClass;
(function (DialogClass) {
    // region *** Public ***
    class DialogInitializer {
        constructor(component) {
            this.component = component;
            this.dialogCarrier = new DialogClass.DialogCarrier();
            this.dialogCarrier.setComponent(this.component);
        }
        /** Generic method accept expected payload from dynamic child component.*/
        openDialog$() {
            return this.dialogCarrier.openDialog$().pipe(map((resp) => {
                const basicDialogResponse = new DialogResponse();
                const dataControl = new GlobalClass.DataControl();
                dataControl.copyValuesFrom(resp, basicDialogResponse);
                return basicDialogResponse;
            }), take(1));
        }
        /** It accepts list of custom buttons */
        setButtons(_Buttons) {
            this.dialogCarrier.setButtons(_Buttons);
        }
        setCustomData(_CustomData) {
            this.dialogCarrier.setCustomData(_CustomData);
        }
        setConfig(_DialogConfig) {
            this.dialogCarrier.setConfig(_DialogConfig);
        }
    }
    DialogClass.DialogInitializer = DialogInitializer;
    class DialogResponse extends GlobalClass.DataControl {
        constructor() {
            super();
            // private Response: DialogPrepareResponse            = new DialogPrepareResponse();
            this.Payload = null;
            this.Success = null;
            this.ClickedButtonID = null;
        }
        /**
         * @ignore
         */
        setPayload(_Payload) {
            this.Payload = _Payload;
        }
        /**
         * @ignore
         */
        setClickedButtonID(_ClickedButtonID) {
            this.ClickedButtonID = _ClickedButtonID;
        }
    }
    DialogClass.DialogResponse = DialogResponse;
    class DialogEventsController {
        constructor(EntityUniqueID) {
            this.EntityUniqueID = EntityUniqueID;
            this._afterClosed = new Subject();
            this.afterClosed$ = this._afterClosed.asObservable();
            this._afterLoader = new Subject();
            this.afterLoader$ = this._afterLoader.asObservable();
            this._onButtonClick = new Subject();
            this.onButtonClick$ = this._onButtonClick.asObservable();
            this._buttonList = new Subject();
            this.buttonList$ = this._buttonList.asObservable();
        }
        close(_Payload = null) {
            this.defaultResponse.setPayload(_Payload);
            this._afterClosed.next(this.defaultResponse);
        }
        onButtonClick(_Button) {
            this.defaultResponse.setClickedButtonID(_Button.ID);
            this._onButtonClick.next(_Button);
        }
        setButtonList(_ButtonList) {
            this._buttonList.next(_ButtonList);
        }
        closeLoader() {
            setTimeout(() => {
                this._afterLoader.next(this.EntityUniqueID);
            }, 0);
        }
        setDefaultResponse(_Response) {
            this.defaultResponse = _Response;
        }
    }
    DialogClass.DialogEventsController = DialogEventsController;
    // endregion
    class DialogDefaultResponse extends DialogResponse {
        constructor() {
            super();
            this.DialogBelonging = null;
        }
        setBelonging(_DialogBelonging) {
            this.DialogBelonging = _DialogBelonging;
        }
    }
    DialogClass.DialogDefaultResponse = DialogDefaultResponse;
    class DialogCarrier {
        constructor() {
            this.dialogBelonging = new DialogBelonging();
        }
        setComponent(_Component) {
            this.component = _Component;
        }
        setButtons(_Buttons) {
            if (_Buttons.length) {
                this.dialogBelonging.Buttons = _Buttons;
            }
        }
        setCustomData(_CustomData) {
            this.dialogBelonging.CustomData = _CustomData;
        }
        setConfig(_DialogConfig) {
            // region *** local UserConfig (defined on place where dialog is called) ***
            const dataControl = new GlobalClass.DataControl();
            dataControl.copyValuesFrom(_DialogConfig, this.dialogBelonging.DialogCoreConfig);
            if (_DialogConfig === null || _DialogConfig === void 0 ? void 0 : _DialogConfig.LoaderComponent) {
                this.dialogBelonging.DialogCoreConfig.DisplayLoader = true;
            }
            // endregion
        }
        openDialog$() {
            const service = ServiceLocator.injector.get(DialogService);
            const dialogController = service.open(this.component, this.dialogBelonging);
            return dialogController.afterClosed$;
        }
    }
    DialogClass.DialogCarrier = DialogCarrier;
    class DialogCoreConfig extends GlobalClass.Sizes {
        constructor() {
            super(...arguments);
            this.EscapeKeyClose = null;
            this.HideScrollbar = null;
            this.ButtonPosition = null;
            this.LayoutType = null;
            this.DisplayLoader = null;
            this.LoaderComponent = null;
        }
    }
    DialogClass.DialogCoreConfig = DialogCoreConfig;
    class DialogSettings {
        constructor() {
            this.Buttons = [];
            this.DialogCoreConfig = new DialogCoreConfig();
        }
    }
    DialogClass.DialogSettings = DialogSettings;
    class DialogBelonging extends DialogSettings {
        constructor() {
            super();
            /** @internal */
            this.EntityUniqueID = "D" + Math.random().toString(36).substr(2, 9);
            this.CustomData = null;
            this.EventsController = new DialogEventsController(this.EntityUniqueID);
            const dialogConfigurator = ServiceLocator.injector.get(DialogConfigService);
            const baseSettings = new DialogSettings();
            const dataControl = new GlobalClass.DataControl();
            dataControl.copyValuesFrom(dialogConfigurator.productionConfig.DialogCoreConfig, baseSettings.DialogCoreConfig);
            this.DialogCoreConfig = baseSettings.DialogCoreConfig;
            this.Buttons = dialogConfigurator.productionConfig.Buttons.slice();
        }
    }
    DialogClass.DialogBelonging = DialogBelonging;
})(DialogClass || (DialogClass = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9uZ3gtYXdlc29tZS1wb3B1cC90eXBlcy9kaWFsb2cvY29yZS9tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0MsT0FBTyxFQUFFLFdBQVcsRUFBbUIsTUFBTSxzQkFBc0IsQ0FBQztBQUNwRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDMUQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDOUQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBa0dqRCxNQUFNLEtBQVcsV0FBVyxDQXdOM0I7QUF4TkQsV0FBaUIsV0FBVztJQUMxQix3QkFBd0I7SUFFeEIsTUFBYSxpQkFBaUI7UUFHNUIsWUFBb0IsU0FBb0I7WUFBcEIsY0FBUyxHQUFULFNBQVMsQ0FBVztZQUZoQyxrQkFBYSxHQUFrQixJQUFJLFdBQVcsQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUdyRSxJQUFJLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDbEQsQ0FBQztRQUVELDBFQUEwRTtRQUMxRSxXQUFXO1lBR1QsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsRUFBRSxDQUFDLElBQUksQ0FDMUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7Z0JBQ1gsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO2dCQUNqRCxNQUFNLFdBQVcsR0FBRyxJQUFJLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDbEQsV0FBVyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsbUJB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R0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO1lBQzFDLE1BQU0sV0FBVyxHQUFHLElBQUksV0FBVyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2xELFdBQVcsQ0FBQyxjQUFjLENBQ3hCLGtCQUFrQixDQUFDLGdCQUFnQixDQUFDLGdCQUFnQixFQUNwRCxZQUFZLENBQUMsZ0JBQWdCLENBQzlCLENBQUM7WUFDRixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsWUFBWSxDQUFDLGdCQUFnQixDQUFDO1lBQ3RELElBQUksQ0FBQyxPQUFPLEdBQUcsa0JBQWtCLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3JFLENBQUM7S0FDRjtJQXhCWSwyQkFBZSxrQkF3QjNCLENBQUE7QUFDSCxDQUFDLEVBeE5nQixXQUFXLEtBQVgsV0FBVyxRQXdOM0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUeXBlIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgbWFwLCB0YWtlIH0gZnJvbSBcInJ4anMvb3BlcmF0b3JzXCI7XG5pbXBvcnQgeyBEaWFsb2dMYXlvdXREaXNwbGF5LCBWZXJ0aWNhbFBvc2l0aW9uIH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW51bXNcIjtcbmltcG9ydCB7IEdsb2JhbENsYXNzLCBHbG9iYWxJbnRlcmZhY2UgfSBmcm9tIFwiLi4vLi4vLi4vY29yZS9nbG9iYWxcIjtcbmltcG9ydCB7IFNlcnZpY2VMb2NhdG9yIH0gZnJvbSBcIi4uLy4uLy4uL2xvY2F0b3Iuc2VydmljZVwiO1xuaW1wb3J0IHsgRGlhbG9nQ29uZmlnU2VydmljZSB9IGZyb20gXCIuL2RpYWxvZy1jb25maWcuc2VydmljZVwiO1xuaW1wb3J0IHsgRGlhbG9nU2VydmljZSB9IGZyb20gXCIuL2RpYWxvZy5zZXJ2aWNlXCI7XG5cbmV4cG9ydCBuYW1lc3BhY2UgRGlhbG9nSW50ZXJmYWNlIHtcbiAgLyoqXG4gICAqIENoZWNrIGludGVyZmFjZSBvZiBwcm9wZXJ0aWVzLlxuICAgKi9cbiAgZXhwb3J0IGludGVyZmFjZSBJRGlhbG9nVXNlckNvbmZpZyB7XG4gICAgQnV0dG9ucz86IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW107XG4gICAgRGlhbG9nQ29yZUNvbmZpZz86IERpYWxvZ0ludGVyZmFjZS5JRGlhbG9nQ29yZUNvbmZpZztcbiAgfVxuXG4gIC8qKlxuICAgKiBPcHRpb25hbCB1c2VyIGNvbmZpZ3VyYXRpb24uXG4gICAqXG4gICAqIEV4YW1wbGU6XG4gICAqIGBgYHR5cGVzY3JpcHRcbiAgICogLy8gRGlhbG9nIGNvcmUgY29uZmlnIG9iamVjdCBleGFtcGxlLlxuICAgKiBjb25zdCBkaWFsb2dDb3JlQ29uZmlnID0ge1xuICAgKiAgICAgRGlhbG9nQ29yZUNvbmZpZzoge1xuICAgKiAgICAgICAgV2lkdGggICAgICAgICAgOiAnNTAwcHgnLFxuICAgKiAgICAgICAgLy8gTWluV2lkdGggICAgICAgOiAnMzAwcHgnLCAgLy8gdjEuMS4wXG4gICAqICAgICAgICAvLyBNYXhXaWR0aCAgICAgICA6ICc3MDBweCcsICAvLyB2MS4xLjBcbiAgICogICAgICAgIEhlaWdodCAgICAgICAgIDogJzUwMHB4JyxcbiAgICogICAgICAgIC8vIE1pbkhlaWdodCAgICAgIDogJzEwMHZoJywgIC8vIHYxLjEuMFxuICAgKiAgICAgICAgLy8gTWF4SGVpZ2h0ICAgICAgOiAnMTAwcHgnLCAgLy8gdjEuMS4wXG4gICAqICAgICAgICBIaWRlU2Nyb2xsYmFyICA6IHRydWUsICAgICAgICAvLyB2MS4xLjBcbiAgICogICAgICAgIEVzY2FwZUtleUNsb3NlIDogdHJ1ZSwgICAgICAgIC8vIHYxLjEuMFxuICAgKiAgICAgICAgLy8gRnVsbFNjcmVlbiA6IHRydWUsICAgICAgICAgLy8gdjEuMS4wXG4gICAqICAgICAgICBCdXR0b25Qb3NpdGlvbiA6ICdyaWdodCcsXG4gICAqICAgICAgICBMYXlvdXRUeXBlOiBEaWFsb2dMYXlvdXREaXNwbGF5LklORk8sXG4gICAqICAgICAgICAvLyBMb2FkZXJDb21wb25lbnQ6IC8vIEFueSBBbmd1bGFyIGNvbXBvbmVudCBjbGFzcyBuYW1lIGNhbiBiZSBpbmNsdWRlZCBhcyBhIGxvYWRlci5cbiAgICogICAgICAgIERpc3BsYXlMb2FkZXI6IGZhbHNlIC8vIFRoaXMgd2lsbCBvdmVycmlkZSBMb2FkZXJDb21wb25lbnQuXG4gICAqICAgICB9XG4gICAqICB9XG4gICAqIGBgYFxuICAgKi9cbiAgZXhwb3J0IGludGVyZmFjZSBJRGlhbG9nQ29yZUNvbmZpZyBleHRlbmRzIEdsb2JhbEludGVyZmFjZS5JU2l6ZXMge1xuICAgIEVzY2FwZUtleUNsb3NlPzogYm9vbGVhbjtcbiAgICBIaWRlU2Nyb2xsYmFyPzogYm9vbGVhbjtcbiAgICBCdXR0b25Qb3NpdGlvbj86IFZlcnRpY2FsUG9zaXRpb247XG4gICAgTGF5b3V0VHlwZT86IERpYWxvZ0xheW91dERpc3BsYXk7XG4gICAgRGlzcGxheUxvYWRlcj86IGJvb2xlYW47XG4gICAgTG9hZGVyQ29tcG9uZW50PzogVHlwZTxhbnk+O1xuICB9XG5cbiAgZXhwb3J0IGludGVyZmFjZSBJRGlhbG9nQmVsb25naW5nIHtcbiAgICBCdXR0b25zOiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdO1xuICAgIERpYWxvZ0NvcmVDb25maWc6IERpYWxvZ0ludGVyZmFjZS5JRGlhbG9nQ29yZUNvbmZpZztcbiAgICBFbnRpdHlVbmlxdWVJRDogc3RyaW5nO1xuICAgIEN1c3RvbURhdGE6IGFueTtcbiAgICBFdmVudHNDb250cm9sbGVyOiBEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ0V2ZW50c0NvbnRyb2xsZXI7XG4gIH1cblxuICBleHBvcnQgaW50ZXJmYWNlIElEaWFsb2dFdmVudHNDb250cm9sbGVyIHtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgZGVmYXVsdFJlc3BvbnNlOiBEaWFsb2dJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZDtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgYWZ0ZXJDbG9zZWQkOiBPYnNlcnZhYmxlPERpYWxvZ0ludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPjtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgYWZ0ZXJMb2FkZXIkOiBPYnNlcnZhYmxlPHN0cmluZz47XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIG9uQnV0dG9uQ2xpY2skOiBPYnNlcnZhYmxlPEdsb2JhbEludGVyZmFjZS5JQnV0dG9uPjtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgYnV0dG9uTGlzdCQ6IE9ic2VydmFibGU8R2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXT47XG5cbiAgICBjbG9zZShfUGF5bG9hZD86IGFueSk6IHZvaWQ7XG5cbiAgICBvbkJ1dHRvbkNsaWNrKF9CdXR0b246IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uKTogdm9pZDtcblxuICAgIHNldEJ1dHRvbkxpc3QoX0J1dHRvbkxpc3Q6IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10pOiB2b2lkO1xuXG4gICAgY2xvc2VMb2FkZXIoKTogdm9pZDtcblxuICAgIHNldERlZmF1bHRSZXNwb25zZShfUmVzcG9uc2U6IERpYWxvZ0ludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkKTogdm9pZDtcblxuICAgIHNldERlZmF1bHRSZXNwb25zZShfUmVzcG9uc2U6IERpYWxvZ0ludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkKTogdm9pZDtcbiAgfVxuXG4gIGV4cG9ydCBpbnRlcmZhY2UgSURpYWxvZ1Jlc3BvbnNlIHtcbiAgICBzZXRQYXlsb2FkKF9QYXlsb2FkOiBhbnkpOiB2b2lkO1xuXG4gICAgc2V0Q2xpY2tlZEJ1dHRvbklEKF9DbGlja2VkQnV0dG9uSUQpOiB2b2lkO1xuICB9XG5cbiAgZXhwb3J0IGludGVyZmFjZSBJRGlhbG9nUHVibGljUmVzcG9uc2U8UmVzcG9uc2VQYXlsb2FkPiB7XG4gICAgLyoqIEdlbmVyaWMgcHJvcGVydHkgdHlwZSwgYWNjZXB0IGV4cGVjdGVkIHBheWxvYWQgZnJvbSBkeW5hbWljIGNoaWxkIGNvbXBvbmVudC4gKi9cbiAgICBQYXlsb2FkOiBSZXNwb25zZVBheWxvYWQ7XG4gICAgU3VjY2VzczogYm9vbGVhbjtcbiAgICBDbGlja2VkQnV0dG9uSUQ6IHN0cmluZztcbiAgfVxuXG4gIGV4cG9ydCBpbnRlcmZhY2UgSVByaXZhdGVSZXNwb25zZU1lcmdlZFxuICAgIGV4dGVuZHMgSURpYWxvZ1Jlc3BvbnNlLFxuICAgICAgR2xvYmFsSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2Uge1xuICAgIERpYWxvZ0JlbG9uZ2luZzogRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dCZWxvbmdpbmc7XG4gIH1cbn1cblxuZXhwb3J0IG5hbWVzcGFjZSBEaWFsb2dDbGFzcyB7XG4gIC8vIHJlZ2lvbiAqKiogUHVibGljICoqKlxuXG4gIGV4cG9ydCBjbGFzcyBEaWFsb2dJbml0aWFsaXplciB7XG4gICAgcHJpdmF0ZSBkaWFsb2dDYXJyaWVyOiBEaWFsb2dDYXJyaWVyID0gbmV3IERpYWxvZ0NsYXNzLkRpYWxvZ0NhcnJpZXIoKTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgY29tcG9uZW50OiBUeXBlPGFueT4pIHtcbiAgICAgIHRoaXMuZGlhbG9nQ2Fycmllci5zZXRDb21wb25lbnQodGhpcy5jb21wb25lbnQpO1xuICAgIH1cblxuICAgIC8qKiBHZW5lcmljIG1ldGhvZCBhY2NlcHQgZXhwZWN0ZWQgcGF5bG9hZCBmcm9tIGR5bmFtaWMgY2hpbGQgY29tcG9uZW50LiovXG4gICAgb3BlbkRpYWxvZyQ8UmVzcG9uc2VQYXlsb2FkID0gYW55PigpOiBPYnNlcnZhYmxlPFxuICAgICAgRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dQdWJsaWNSZXNwb25zZTxSZXNwb25zZVBheWxvYWQ+XG4gICAgPiB7XG4gICAgICByZXR1cm4gdGhpcy5kaWFsb2dDYXJyaWVyLm9wZW5EaWFsb2ckKCkucGlwZShcbiAgICAgICAgbWFwKChyZXNwKSA9PiB7XG4gICAgICAgICAgY29uc3QgYmFzaWNEaWFsb2dSZXNwb25zZSA9IG5ldyBEaWFsb2dSZXNwb25zZSgpO1xuICAgICAgICAgIGNvbnN0IGRhdGFDb250cm9sID0gbmV3IEdsb2JhbENsYXNzLkRhdGFDb250cm9sKCk7XG4gICAgICAgICAgZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20ocmVzcCwgYmFzaWNEaWFsb2dSZXNwb25zZSk7XG4gICAgICAgICAgcmV0dXJuIGJhc2ljRGlhbG9nUmVzcG9uc2U7XG4gICAgICAgIH0pLFxuICAgICAgICB0YWtlKDEpXG4gICAgICApO1xuICAgIH1cblxuICAgIC8qKiBJdCBhY2NlcHRzIGxpc3Qgb2YgY3VzdG9tIGJ1dHRvbnMgKi9cbiAgICBzZXRCdXR0b25zKF9CdXR0b25zOiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdKTogdm9pZCB7XG4gICAgICB0aGlzLmRpYWxvZ0NhcnJpZXIuc2V0QnV0dG9ucyhfQnV0dG9ucyk7XG4gICAgfVxuXG4gICAgc2V0Q3VzdG9tRGF0YShfQ3VzdG9tRGF0YTogYW55KSB7XG4gICAgICB0aGlzLmRpYWxvZ0NhcnJpZXIuc2V0Q3VzdG9tRGF0YShfQ3VzdG9tRGF0YSk7XG4gICAgfVxuXG4gICAgc2V0Q29uZmlnKF9EaWFsb2dDb25maWc6IERpYWxvZ0ludGVyZmFjZS5JRGlhbG9nQ29yZUNvbmZpZykge1xuICAgICAgdGhpcy5kaWFsb2dDYXJyaWVyLnNldENvbmZpZyhfRGlhbG9nQ29uZmlnKTtcbiAgICB9XG4gIH1cblxuICBleHBvcnQgY2xhc3MgRGlhbG9nUmVzcG9uc2VcbiAgICBleHRlbmRzIEdsb2JhbENsYXNzLkRhdGFDb250cm9sXG4gICAgaW1wbGVtZW50c1xuICAgICAgRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dSZXNwb25zZSxcbiAgICAgIERpYWxvZ0ludGVyZmFjZS5JRGlhbG9nUHVibGljUmVzcG9uc2U8YW55PiB7XG4gICAgLy8gcHJpdmF0ZSBSZXNwb25zZTogRGlhbG9nUHJlcGFyZVJlc3BvbnNlICAgICAgICAgICAgPSBuZXcgRGlhbG9nUHJlcGFyZVJlc3BvbnNlKCk7XG5cbiAgICBQYXlsb2FkOiBhbnkgPSBudWxsO1xuICAgIFN1Y2Nlc3M6IGJvb2xlYW4gPSBudWxsO1xuICAgIENsaWNrZWRCdXR0b25JRDogc3RyaW5nID0gbnVsbDtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgc3VwZXIoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgc2V0UGF5bG9hZChfUGF5bG9hZDogYW55KTogdm9pZCB7XG4gICAgICB0aGlzLlBheWxvYWQgPSBfUGF5bG9hZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgc2V0Q2xpY2tlZEJ1dHRvbklEKF9DbGlja2VkQnV0dG9uSUQpOiB2b2lkIHtcbiAgICAgIHRoaXMuQ2xpY2tlZEJ1dHRvbklEID0gX0NsaWNrZWRCdXR0b25JRDtcbiAgICB9XG4gIH1cblxuICBleHBvcnQgY2xhc3MgRGlhbG9nRXZlbnRzQ29udHJvbGxlclxuICAgIGltcGxlbWVudHMgRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dFdmVudHNDb250cm9sbGVyIHtcbiAgICBkZWZhdWx0UmVzcG9uc2U6IERpYWxvZ0ludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkO1xuXG4gICAgcHJpdmF0ZSByZWFkb25seSBfYWZ0ZXJDbG9zZWQ6IFN1YmplY3Q8RGlhbG9nSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQ+ID0gbmV3IFN1YmplY3Q8RGlhbG9nSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQ+KCk7XG4gICAgYWZ0ZXJDbG9zZWQkOiBPYnNlcnZhYmxlPERpYWxvZ0ludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPiA9IHRoaXMuX2FmdGVyQ2xvc2VkLmFzT2JzZXJ2YWJsZSgpO1xuXG4gICAgcHJpdmF0ZSByZWFkb25seSBfYWZ0ZXJMb2FkZXI6IGFueSA9IG5ldyBTdWJqZWN0PHN0cmluZz4oKTtcbiAgICBhZnRlckxvYWRlciQ6IE9ic2VydmFibGU8c3RyaW5nPiA9IHRoaXMuX2FmdGVyTG9hZGVyLmFzT2JzZXJ2YWJsZSgpO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX29uQnV0dG9uQ2xpY2s6IFN1YmplY3Q8R2xvYmFsSW50ZXJmYWNlLklCdXR0b24+ID0gbmV3IFN1YmplY3Q8R2xvYmFsSW50ZXJmYWNlLklCdXR0b24+KCk7XG4gICAgb25CdXR0b25DbGljayQ6IE9ic2VydmFibGU8R2xvYmFsSW50ZXJmYWNlLklCdXR0b24+ID0gdGhpcy5fb25CdXR0b25DbGljay5hc09ic2VydmFibGUoKTtcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9idXR0b25MaXN0OiBTdWJqZWN0PFxuICAgICAgR2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXVxuICAgID4gPSBuZXcgU3ViamVjdDxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdPigpO1xuICAgIGJ1dHRvbkxpc3QkOiBPYnNlcnZhYmxlPFxuICAgICAgR2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXVxuICAgID4gPSB0aGlzLl9idXR0b25MaXN0LmFzT2JzZXJ2YWJsZSgpO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBFbnRpdHlVbmlxdWVJRDogc3RyaW5nKSB7fVxuXG4gICAgY2xvc2UoX1BheWxvYWQ6IGFueSA9IG51bGwpOiB2b2lkIHtcbiAgICAgIHRoaXMuZGVmYXVsdFJlc3BvbnNlLnNldFBheWxvYWQoX1BheWxvYWQpO1xuICAgICAgdGhpcy5fYWZ0ZXJDbG9zZWQubmV4dCh0aGlzLmRlZmF1bHRSZXNwb25zZSk7XG4gICAgfVxuXG4gICAgb25CdXR0b25DbGljayhfQnV0dG9uOiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbik6IHZvaWQge1xuICAgICAgdGhpcy5kZWZhdWx0UmVzcG9uc2Uuc2V0Q2xpY2tlZEJ1dHRvbklEKF9CdXR0b24uSUQpO1xuICAgICAgdGhpcy5fb25CdXR0b25DbGljay5uZXh0KF9CdXR0b24pO1xuICAgIH1cblxuICAgIHNldEJ1dHRvbkxpc3QoX0J1dHRvbkxpc3Q6IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10pOiB2b2lkIHtcbiAgICAgIHRoaXMuX2J1dHRvbkxpc3QubmV4dChfQnV0dG9uTGlzdCk7XG4gICAgfVxuXG4gICAgY2xvc2VMb2FkZXIoKTogdm9pZCB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5fYWZ0ZXJMb2FkZXIubmV4dCh0aGlzLkVudGl0eVVuaXF1ZUlEKTtcbiAgICAgIH0sIDApO1xuICAgIH1cblxuICAgIHNldERlZmF1bHRSZXNwb25zZShcbiAgICAgIF9SZXNwb25zZTogRGlhbG9nSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWRcbiAgICApOiB2b2lkIHtcbiAgICAgIHRoaXMuZGVmYXVsdFJlc3BvbnNlID0gX1Jlc3BvbnNlO1xuICAgIH1cbiAgfVxuXG4gIC8vIGVuZHJlZ2lvblxuXG4gIGV4cG9ydCBjbGFzcyBEaWFsb2dEZWZhdWx0UmVzcG9uc2VcbiAgICBleHRlbmRzIERpYWxvZ1Jlc3BvbnNlXG4gICAgaW1wbGVtZW50cyBEaWFsb2dJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZCB7XG4gICAgRGlhbG9nQmVsb25naW5nOiBEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ0JlbG9uZ2luZyA9IG51bGw7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgIHN1cGVyKCk7XG4gICAgfVxuXG4gICAgc2V0QmVsb25naW5nKF9EaWFsb2dCZWxvbmdpbmcpOiB2b2lkIHtcbiAgICAgIHRoaXMuRGlhbG9nQmVsb25naW5nID0gX0RpYWxvZ0JlbG9uZ2luZztcbiAgICB9XG4gIH1cblxuICBleHBvcnQgY2xhc3MgRGlhbG9nQ2FycmllciB7XG4gICAgZGlhbG9nQmVsb25naW5nOiBEaWFsb2dCZWxvbmdpbmcgPSBuZXcgRGlhbG9nQmVsb25naW5nKCk7XG4gICAgcHJpdmF0ZSBjb21wb25lbnQ6IFR5cGU8YW55PjtcblxuICAgIGNvbnN0cnVjdG9yKCkge31cblxuICAgIHNldENvbXBvbmVudChfQ29tcG9uZW50OiBUeXBlPGFueT4pOiB2b2lkIHtcbiAgICAgIHRoaXMuY29tcG9uZW50ID0gX0NvbXBvbmVudDtcbiAgICB9XG5cbiAgICBzZXRCdXR0b25zKF9CdXR0b25zOiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdKSB7XG4gICAgICBpZiAoX0J1dHRvbnMubGVuZ3RoKSB7XG4gICAgICAgIHRoaXMuZGlhbG9nQmVsb25naW5nLkJ1dHRvbnMgPSBfQnV0dG9ucztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBzZXRDdXN0b21EYXRhKF9DdXN0b21EYXRhOiBhbnkpIHtcbiAgICAgIHRoaXMuZGlhbG9nQmVsb25naW5nLkN1c3RvbURhdGEgPSBfQ3VzdG9tRGF0YTtcbiAgICB9XG5cbiAgICBzZXRDb25maWcoX0RpYWxvZ0NvbmZpZzogRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dDb3JlQ29uZmlnKSB7XG4gICAgICAvLyByZWdpb24gKioqIGxvY2FsIFVzZXJDb25maWcgKGRlZmluZWQgb24gcGxhY2Ugd2hlcmUgZGlhbG9nIGlzIGNhbGxlZCkgKioqXG4gICAgICBjb25zdCBkYXRhQ29udHJvbCA9IG5ldyBHbG9iYWxDbGFzcy5EYXRhQ29udHJvbCgpO1xuICAgICAgZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20oXG4gICAgICAgIF9EaWFsb2dDb25maWcsXG4gICAgICAgIHRoaXMuZGlhbG9nQmVsb25naW5nLkRpYWxvZ0NvcmVDb25maWdcbiAgICAgICk7XG4gICAgICBpZiAoX0RpYWxvZ0NvbmZpZz8uTG9hZGVyQ29tcG9uZW50KSB7XG4gICAgICAgIHRoaXMuZGlhbG9nQmVsb25naW5nLkRpYWxvZ0NvcmVDb25maWcuRGlzcGxheUxvYWRlciA9IHRydWU7XG4gICAgICB9XG4gICAgICAvLyBlbmRyZWdpb25cbiAgICB9XG5cbiAgICBvcGVuRGlhbG9nJCgpOiBPYnNlcnZhYmxlPERpYWxvZ0ludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPiB7XG4gICAgICBjb25zdCBzZXJ2aWNlOiBEaWFsb2dTZXJ2aWNlID0gU2VydmljZUxvY2F0b3IuaW5qZWN0b3IuZ2V0KERpYWxvZ1NlcnZpY2UpO1xuICAgICAgY29uc3QgZGlhbG9nQ29udHJvbGxlciA9IHNlcnZpY2Uub3BlbihcbiAgICAgICAgdGhpcy5jb21wb25lbnQsXG4gICAgICAgIHRoaXMuZGlhbG9nQmVsb25naW5nXG4gICAgICApO1xuICAgICAgcmV0dXJuIGRpYWxvZ0NvbnRyb2xsZXIuYWZ0ZXJDbG9zZWQkO1xuICAgIH1cbiAgfVxuXG4gIGV4cG9ydCBjbGFzcyBEaWFsb2dDb3JlQ29uZmlnXG4gICAgZXh0ZW5kcyBHbG9iYWxDbGFzcy5TaXplc1xuICAgIGltcGxlbWVudHMgRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dDb3JlQ29uZmlnIHtcbiAgICBFc2NhcGVLZXlDbG9zZTogYm9vbGVhbiA9IG51bGw7XG4gICAgSGlkZVNjcm9sbGJhcjogYm9vbGVhbiA9IG51bGw7XG4gICAgQnV0dG9uUG9zaXRpb246IFZlcnRpY2FsUG9zaXRpb24gPSBudWxsO1xuICAgIExheW91dFR5cGU6IERpYWxvZ0xheW91dERpc3BsYXkgPSBudWxsO1xuICAgIERpc3BsYXlMb2FkZXI6IGJvb2xlYW4gPSBudWxsO1xuICAgIExvYWRlckNvbXBvbmVudDogVHlwZTxhbnk+ID0gbnVsbDtcbiAgfVxuXG4gIGV4cG9ydCBjbGFzcyBEaWFsb2dTZXR0aW5ncyB7XG4gICAgQnV0dG9uczogR2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXSA9IFtdO1xuICAgIERpYWxvZ0NvcmVDb25maWc6IERpYWxvZ0ludGVyZmFjZS5JRGlhbG9nQ29yZUNvbmZpZyA9IG5ldyBEaWFsb2dDb3JlQ29uZmlnKCk7XG4gIH1cblxuICBleHBvcnQgY2xhc3MgRGlhbG9nQmVsb25naW5nPEN1c3RvbURhdGEgPSBhbnk+XG4gICAgZXh0ZW5kcyBEaWFsb2dTZXR0aW5nc1xuICAgIGltcGxlbWVudHMgRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dCZWxvbmdpbmcge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBFbnRpdHlVbmlxdWVJRDogc3RyaW5nID0gXCJEXCIgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7XG5cbiAgICBDdXN0b21EYXRhOiBDdXN0b21EYXRhID0gbnVsbDtcbiAgICBFdmVudHNDb250cm9sbGVyOiBEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ0V2ZW50c0NvbnRyb2xsZXI7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgIHN1cGVyKCk7XG4gICAgICB0aGlzLkV2ZW50c0NvbnRyb2xsZXIgPSBuZXcgRGlhbG9nRXZlbnRzQ29udHJvbGxlcih0aGlzLkVudGl0eVVuaXF1ZUlEKTtcbiAgICAgIGNvbnN0IGRpYWxvZ0NvbmZpZ3VyYXRvcjogRGlhbG9nQ29uZmlnU2VydmljZSA9IFNlcnZpY2VMb2NhdG9yLmluamVjdG9yLmdldChcbiAgICAgICAgRGlhbG9nQ29uZmlnU2VydmljZVxuICAgICAgKTtcbiAgICAgIGNvbnN0IGJhc2VTZXR0aW5ncyA9IG5ldyBEaWFsb2dTZXR0aW5ncygpO1xuICAgICAgY29uc3QgZGF0YUNvbnRyb2wgPSBuZXcgR2xvYmFsQ2xhc3MuRGF0YUNvbnRyb2woKTtcbiAgICAgIGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKFxuICAgICAgICBkaWFsb2dDb25maWd1cmF0b3IucHJvZHVjdGlvbkNvbmZpZy5EaWFsb2dDb3JlQ29uZmlnLFxuICAgICAgICBiYXNlU2V0dGluZ3MuRGlhbG9nQ29yZUNvbmZpZ1xuICAgICAgKTtcbiAgICAgIHRoaXMuRGlhbG9nQ29yZUNvbmZpZyA9IGJhc2VTZXR0aW5ncy5EaWFsb2dDb3JlQ29uZmlnO1xuICAgICAgdGhpcy5CdXR0b25zID0gZGlhbG9nQ29uZmlndXJhdG9yLnByb2R1Y3Rpb25Db25maWcuQnV0dG9ucy5zbGljZSgpO1xuICAgIH1cbiAgfVxufVxuIl19