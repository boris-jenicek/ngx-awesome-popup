import { Subject } from 'rxjs';
import { map, take } from 'rxjs/operators';
import { DataControl, Dispatch } from '../../../core/global-classes';
import { ServiceLocator } from '../../../locator.service';
import { ToastNotificationConfigService } from './toast-notification-config.service';
import { ToastNotificationService } from './toast-notification.service';
// region *** Public ***
export class ToastNotificationInitializer {
    constructor() {
        this.toastNotificationCarrier = new ToastNotificationCarrier();
    }
    openToastNotification$() {
        return this.toastNotificationCarrier.openToastNotification$().pipe(map(resp => {
            const basicToastNotificationResponse = new ToastNotificationResponse();
            const dataControl = new DataControl();
            dataControl.copyValuesFrom(resp, basicToastNotificationResponse);
            return basicToastNotificationResponse;
        }), take(1));
    }
    setButtons(_Buttons) {
        this.toastNotificationCarrier.setButtons(_Buttons);
    }
    setConfig(_ToastNotificationConfig) {
        this.toastNotificationCarrier.setConfig(_ToastNotificationConfig);
    }
    setDispatch(_Title, _Message = null) {
        this.toastNotificationCarrier.setTitle(_Title);
        this.toastNotificationCarrier.setMessage(_Message);
    }
    setTitle(_Title) {
        this.toastNotificationCarrier.setTitle(_Title);
    }
    setMessage(_Message) {
        this.toastNotificationCarrier.setMessage(_Message);
    }
    setButtonLabels(_Confirm, _Decline) {
        this.toastNotificationCarrier.setButtonLabels(_Confirm, _Decline);
    }
}
export class ToastNotificationResponse extends DataControl {
    constructor() {
        super();
        // private Response: DialogPrepareResponse            = new DialogPrepareResponse();
        this.Success = null;
        this.ClickedButtonID = null;
    }
    setSuccess(_IsSuccess) {
        this.Success = _IsSuccess;
    }
    setClickedButtonID(_ClickedButtonID) {
        this.ClickedButtonID = _ClickedButtonID;
    }
}
export class ToastNotificationEventsController {
    constructor(EntityUniqueID) {
        this.EntityUniqueID = EntityUniqueID;
        this._afterClosed = new Subject();
        this.afterClosed$ = this._afterClosed.asObservable();
        this._onButtonClick = new Subject();
        this.onButtonClick$ = this._onButtonClick.asObservable();
        this._buttonList = new Subject();
        this.buttonList$ = this._buttonList.asObservable();
    }
    close(_Response) {
        const response = _Response ? _Response : this.defaultResponse;
        this._afterClosed.next(response);
    }
    onButtonClick(_Button) {
        this.defaultResponse.setClickedButtonID(_Button.ID);
        this._onButtonClick.next(_Button);
    }
    setButtonList(_ButtonList) {
        this._buttonList.next(_ButtonList);
    }
    setDefaultResponse(_Response) {
        this.defaultResponse = _Response;
    }
}
// endregion
export class ToastNotificationDefaultResponse extends ToastNotificationResponse {
    constructor() {
        super();
        this.toastNotificationBelonging = null;
    }
    setBelonging(_ToastNotificationBelonging) {
        this.toastNotificationBelonging = _ToastNotificationBelonging;
    }
}
export class ToastNotificationCarrier {
    constructor() {
        this.toastNotificationBelonging = new ToastNotificationBelonging();
    }
    setButtons(_Buttons) {
        if (_Buttons.length) {
            this.toastNotificationBelonging.Buttons = _Buttons;
        }
    }
    setTitle(_Title) {
        this.toastNotificationBelonging.Dispatch.Title = _Title;
    }
    setMessage(_Message) {
        this.toastNotificationBelonging.Dispatch.Message = _Message;
    }
    setButtonLabels(_Confirm, _Decline) {
        this.toastNotificationBelonging.ToastCoreConfig.ConfirmLabel = _Confirm;
        this.toastNotificationBelonging.ToastCoreConfig.DeclineLabel = _Decline;
    }
    setConfig(_ToastNotificationBelonging) {
        // region *** local UserConfig (defined on place where dialog is called) ***
        const dataControl = new DataControl();
        dataControl.copyValuesFrom(_ToastNotificationBelonging, this.toastNotificationBelonging.ToastCoreConfig);
        // endregion
    }
    openToastNotification$() {
        if (!this.toastNotificationBelonging.Dispatch.Title && !this.toastNotificationBelonging.Dispatch.Message) {
            throw Error('Toast notification can not be without both message and title.');
        }
        const service = ServiceLocator.injector.get(ToastNotificationService);
        return service.openToast$(this.toastNotificationBelonging);
    }
}
export class GlobalToastSettings {
    constructor() {
        this.AllowedNotificationsAtOnce = null;
    }
}
export class ResetToastGlobalSettings {
    constructor(globalToastConfig) {
        const globalToastConfigService = ServiceLocator.injector.get(ToastNotificationConfigService);
        if (globalToastConfigService) {
            globalToastConfigService.setResetGlobalToastConfig(globalToastConfig);
        }
        else {
            globalToastConfigService.setResetGlobalToastConfig();
        }
    }
}
export class ToastSettings {
    constructor() {
        this.Buttons = [];
        this.ToastCoreConfig = new ToastCoreConfig();
        this.Dispatch = new Dispatch();
        this.GlobalSettings = new GlobalToastSettings();
    }
}
export class ToastCoreConfig {
    constructor() {
        this.ToastPosition = null;
        this.ProgressBar = null;
        this.ToastUserViewType = null;
        this.OpenInElementID = null;
        this.ButtonPosition = null;
        this.TextPosition = null;
        this.LayoutType = null;
        this.Dispatch = null;
        this.ConfirmLabel = null;
        this.DeclineLabel = null;
        this.AutoCloseDelay = null;
        this.DisableIcon = null;
        this.AllowHTMLMessage = null;
        this.AnimationIn = null;
        this.AnimationOut = null;
    }
}
export class ToastNotificationBelonging extends ToastSettings {
    constructor() {
        super();
        this.EntityUniqueID = 'T' + Math.random().toString(36).substr(2, 9);
        this.EventsController = new ToastNotificationEventsController(this.EntityUniqueID);
        const toastNotificationConfigurator = ServiceLocator.injector.get(ToastNotificationConfigService);
        const baseSettings = new ToastSettings();
        const dataControl = new DataControl();
        dataControl.copyValuesFrom(toastNotificationConfigurator.productionConfig.ToastCoreConfig, baseSettings.ToastCoreConfig);
        this.ToastCoreConfig = baseSettings.ToastCoreConfig;
        this.Buttons = toastNotificationConfigurator.productionConfig.Buttons.slice();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xhc3Nlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL25neC1hd2Vzb21lLXBvcHVwL3R5cGVzL3RvYXN0LW5vdGlmaWNhdGlvbi9jb3JlL2NsYXNzZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBTzNDLE9BQU8sRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFFckUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBVTFELE9BQU8sRUFBRSw4QkFBOEIsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBQ3JGLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBRXhFLHdCQUF3QjtBQUN4QixNQUFNLE9BQU8sNEJBQTRCO0lBR3ZDO1FBRlEsNkJBQXdCLEdBQTZCLElBQUksd0JBQXdCLEVBQUUsQ0FBQztJQUU3RSxDQUFDO0lBRWhCLHNCQUFzQjtRQUNwQixPQUFPLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLElBQUksQ0FDaEUsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ1QsTUFBTSw4QkFBOEIsR0FBRyxJQUFJLHlCQUF5QixFQUFFLENBQUM7WUFDdkUsTUFBTSxXQUFXLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQztZQUN0QyxXQUFXLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSw4QkFBOEIsQ0FBQyxDQUFDO1lBQ2pFLE9BQU8sOEJBQThCLENBQUM7UUFDeEMsQ0FBQyxDQUFDLEVBQ0YsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUNSLENBQUM7SUFDSixDQUFDO0lBRUQsVUFBVSxDQUFDLFFBQW1CO1FBQzVCLElBQUksQ0FBQyx3QkFBd0Is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QUFDO1FBQzNCLGlCQUFZLEdBQVcsSUFBSSxDQUFDO1FBQzVCLGlCQUFZLEdBQVcsSUFBSSxDQUFDO1FBQzVCLG1CQUFjLEdBQVcsSUFBSSxDQUFDO1FBQzlCLGdCQUFXLEdBQVksSUFBSSxDQUFDO1FBQzVCLHFCQUFnQixHQUFZLElBQUksQ0FBQztRQUNqQyxnQkFBVyxHQUF3QixJQUFJLENBQUM7UUFDeEMsaUJBQVksR0FBMkIsSUFBSSxDQUFDO0lBQzlDLENBQUM7Q0FBQTtBQUVELE1BQU0sT0FBTywwQkFBMkIsU0FBUSxhQUFhO0lBSTNEO1FBQ0UsS0FBSyxFQUFFLENBQUM7UUFKVixtQkFBYyxHQUFXLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFLckUsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksaUNBQWlDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ25GLE1BQU0sNkJBQTZCLEdBQW1DLGNBQWMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUMvRiw4QkFBOEIsQ0FDL0IsQ0FBQztRQUNGLE1BQU0sWUFBWSxHQUFHLElBQUksYUFBYSxFQUFFLENBQUM7UUFDekMsTUFBTSxXQUFXLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQztRQUN0QyxXQUFXLENBQUMsY0FBYyxDQUN4Qiw2QkFBNkIsQ0FBQyxnQkFBZ0IsQ0FBQyxlQUFlLEVBQzlELFlBQVksQ0FBQyxlQUFlLENBQzdCLENBQUM7UUFDRixJQUFJLENBQUMsZUFBZSxHQUFHLFlBQVksQ0FBQyxlQUFlLENBQUM7UUFDcEQsSUFBSSxDQUFDLE9BQU8sR0FBRyw2QkFBNkIsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDaEYsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwLCB0YWtlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtcbiAgQXBwZWFyYW5jZUFuaW1hdGlvbixcbiAgRGlhbG9nTGF5b3V0RGlzcGxheSxcbiAgRGlzYXBwZWFyYW5jZUFuaW1hdGlvbixcbiAgVmVydGljYWxQb3NpdGlvblxufSBmcm9tICcuLi8uLi8uLi9jb3JlL2VudW1zJztcbmltcG9ydCB7IERhdGFDb250cm9sLCBEaXNwYXRjaCB9IGZyb20gJy4uLy4uLy4uL2NvcmUvZ2xvYmFsLWNsYXNzZXMnO1xuaW1wb3J0IHsgSUJ1dHRvbiwgSURpc3BhdGNoIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9nbG9iYWwtaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBTZXJ2aWNlTG9jYXRvciB9IGZyb20gJy4uLy4uLy4uL2xvY2F0b3Iuc2VydmljZSc7XG5pbXBvcnQgeyBUb2FzdFBvc2l0aW9uRW51bSwgVG9hc3RQcm9ncmVzc0JhckVudW0sIFRvYXN0VXNlclZpZXdUeXBlRW51bSB9IGZyb20gJy4vZW51bXMnO1xuaW1wb3J0IHtcbiAgSUdsb2JhbFRvYXN0U2V0dGluZ3MsXG4gIElQcml2YXRlUmVzcG9uc2VNZXJnZWQsXG4gIElUb2FzdENvcmVDb25maWcsXG4gIElUb2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZyxcbiAgSVRvYXN0Tm90aWZpY2F0aW9uUHVibGljUmVzcG9uc2UsXG4gIElUb2FzdE5vdGlmaWNhdGlvblJlc3BvbnNlXG59IGZyb20gJy4vaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBUb2FzdE5vdGlmaWNhdGlvbkNvbmZpZ1NlcnZpY2UgfSBmcm9tICcuL3RvYXN0LW5vdGlmaWNhdGlvbi1jb25maWcuc2VydmljZSc7XG5pbXBvcnQgeyBUb2FzdE5vdGlmaWNhdGlvblNlcnZpY2UgfSBmcm9tICcuL3RvYXN0LW5vdGlmaWNhdGlvbi5zZXJ2aWNlJztcblxuLy8gcmVnaW9uICoqKiBQdWJsaWMgKioqXG5leHBvcnQgY2xhc3MgVG9hc3ROb3RpZmljYXRpb25Jbml0aWFsaXplciB7XG4gIHByaXZhdGUgdG9hc3ROb3RpZmljYXRpb25DYXJyaWVyOiBUb2FzdE5vdGlmaWNhdGlvbkNhcnJpZXIgPSBuZXcgVG9hc3ROb3RpZmljYXRpb25DYXJyaWVyKCk7XG5cbiAgY29uc3RydWN0b3IoKSB7fVxuXG4gIG9wZW5Ub2FzdE5vdGlmaWNhdGlvbiQoKTogT2JzZXJ2YWJsZTxJVG9hc3ROb3RpZmljYXRpb25QdWJsaWNSZXNwb25zZT4ge1xuICAgIHJldHVybiB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQ2Fycmllci5vcGVuVG9hc3ROb3RpZmljYXRpb24kKCkucGlwZShcbiAgICAgIG1hcChyZXNwID0+IHtcbiAgICAgICAgY29uc3QgYmFzaWNUb2FzdE5vdGlmaWNhdGlvblJlc3BvbnNlID0gbmV3IFRvYXN0Tm90aWZpY2F0aW9uUmVzcG9uc2UoKTtcbiAgICAgICAgY29uc3QgZGF0YUNvbnRyb2wgPSBuZXcgRGF0YUNvbnRyb2woKTtcbiAgICAgICAgZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20ocmVzcCwgYmFzaWNUb2FzdE5vdGlmaWNhdGlvblJlc3BvbnNlKTtcbiAgICAgICAgcmV0dXJuIGJhc2ljVG9hc3ROb3RpZmljYXRpb25SZXNwb25zZTtcbiAgICAgIH0pLFxuICAgICAgdGFrZSgxKVxuICAgICk7XG4gIH1cblxuICBzZXRCdXR0b25zKF9CdXR0b25zOiBJQnV0dG9uW10pOiB2b2lkIHtcbiAgICB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQ2Fycmllci5zZXRCdXR0b25zKF9CdXR0b25zKTtcbiAgfVxuXG4gIHNldENvbmZpZyhfVG9hc3ROb3RpZmljYXRpb25Db25maWc6IElUb2FzdENvcmVDb25maWcpIHtcbiAgICB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQ2Fycmllci5zZXRDb25maWcoX1RvYXN0Tm90aWZpY2F0aW9uQ29uZmlnKTtcbiAgfVxuXG4gIHNldERpc3BhdGNoKF9UaXRsZTogc3RyaW5nLCBfTWVzc2FnZTogc3RyaW5nID0gbnVsbCk6IHZvaWQge1xuICAgIHRoaXMudG9hc3ROb3RpZmljYXRpb25DYXJyaWVyLnNldFRpdGxlKF9UaXRsZSk7XG4gICAgdGhpcy50b2FzdE5vdGlmaWNhdGlvbkNhcnJpZXIuc2V0TWVzc2FnZShfTWVzc2FnZSk7XG4gIH1cblxuICBzZXRUaXRsZShfVGl0bGU6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMudG9hc3ROb3RpZmljYXRpb25DYXJyaWVyLnNldFRpdGxlKF9UaXRsZSk7XG4gIH1cblxuICBzZXRNZXNzYWdlKF9NZXNzYWdlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQ2Fycmllci5zZXRNZXNzYWdlKF9NZXNzYWdlKTtcbiAgfVxuXG4gIHNldEJ1dHRvbkxhYmVscyhfQ29uZmlybTogc3RyaW5nLCBfRGVjbGluZT86IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMudG9hc3ROb3RpZmljYXRpb25DYXJyaWVyLnNldEJ1dHRvbkxhYmVscyhfQ29uZmlybSwgX0RlY2xpbmUpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBUb2FzdE5vdGlmaWNhdGlvblJlc3BvbnNlXG4gIGV4dGVuZHMgRGF0YUNvbnRyb2xcbiAgaW1wbGVtZW50cyBJVG9hc3ROb3RpZmljYXRpb25SZXNwb25zZSwgSVRvYXN0Tm90aWZpY2F0aW9uUHVibGljUmVzcG9uc2Uge1xuICAvLyBwcml2YXRlIFJlc3BvbnNlOiBEaWFsb2dQcmVwYXJlUmVzcG9uc2UgICAgICAgICAgICA9IG5ldyBEaWFsb2dQcmVwYXJlUmVzcG9uc2UoKTtcblxuICBTdWNjZXNzOiBib29sZWFuID0gbnVsbDtcbiAgQ2xpY2tlZEJ1dHRvbklEOiBzdHJpbmcgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBzZXRTdWNjZXNzKF9Jc1N1Y2Nlc3M6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLlN1Y2Nlc3MgPSBfSXNTdWNjZXNzO1xuICB9XG5cbiAgc2V0Q2xpY2tlZEJ1dHRvbklEKF9DbGlja2VkQnV0dG9uSUQpOiB2b2lkIHtcbiAgICB0aGlzLkNsaWNrZWRCdXR0b25JRCA9IF9DbGlja2VkQnV0dG9uSUQ7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFRvYXN0Tm90aWZpY2F0aW9uRXZlbnRzQ29udHJvbGxlciB7XG4gIGRlZmF1bHRSZXNwb25zZTogSVByaXZhdGVSZXNwb25zZU1lcmdlZDtcblxuICBwcml2YXRlIHJlYWRvbmx5IF9hZnRlckNsb3NlZDogU3ViamVjdDxJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPiA9IG5ldyBTdWJqZWN0PElQcml2YXRlUmVzcG9uc2VNZXJnZWQ+KCk7XG4gIGFmdGVyQ2xvc2VkJDogT2JzZXJ2YWJsZTxJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPiA9IHRoaXMuX2FmdGVyQ2xvc2VkLmFzT2JzZXJ2YWJsZSgpO1xuICBwcml2YXRlIHJlYWRvbmx5IF9vbkJ1dHRvbkNsaWNrOiBTdWJqZWN0PElCdXR0b24+ID0gbmV3IFN1YmplY3Q8SUJ1dHRvbj4oKTtcbiAgb25CdXR0b25DbGljayQ6IE9ic2VydmFibGU8SUJ1dHRvbj4gPSB0aGlzLl9vbkJ1dHRvbkNsaWNrLmFzT2JzZXJ2YWJsZSgpO1xuICBwcml2YXRlIHJlYWRvbmx5IF9idXR0b25MaXN0OiBTdWJqZWN0PElCdXR0b25bXT4gPSBuZXcgU3ViamVjdDxJQnV0dG9uW10+KCk7XG4gIGJ1dHRvbkxpc3QkOiBPYnNlcnZhYmxlPElCdXR0b25bXT4gPSB0aGlzLl9idXR0b25MaXN0LmFzT2JzZXJ2YWJsZSgpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgRW50aXR5VW5pcXVlSUQ6IHN0cmluZykge31cblxuICBjbG9zZShfUmVzcG9uc2U/OiBJUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkKTogdm9pZCB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBfUmVzcG9uc2UgPyBfUmVzcG9uc2UgOiB0aGlzLmRlZmF1bHRSZXNwb25zZTtcbiAgICB0aGlzLl9hZnRlckNsb3NlZC5uZXh0KHJlc3BvbnNlKTtcbiAgfVxuXG4gIG9uQnV0dG9uQ2xpY2soX0J1dHRvbjogSUJ1dHRvbik6IHZvaWQge1xuICAgIHRoaXMuZGVmYXVsdFJlc3BvbnNlLnNldENsaWNrZWRCdXR0b25JRChfQnV0dG9uLklEKTtcbiAgICB0aGlzLl9vbkJ1dHRvbkNsaWNrLm5leHQoX0J1dHRvbik7XG4gIH1cblxuICBzZXRCdXR0b25MaXN0KF9CdXR0b25MaXN0OiBJQnV0dG9uW10pOiB2b2lkIHtcbiAgICB0aGlzLl9idXR0b25MaXN0Lm5leHQoX0J1dHRvbkxpc3QpO1xuICB9XG5cbiAgc2V0RGVmYXVsdFJlc3BvbnNlKF9SZXNwb25zZTogSVByaXZhdGVSZXNwb25zZU1lcmdlZCk6IHZvaWQge1xuICAgIHRoaXMuZGVmYXVsdFJlc3BvbnNlID0gX1Jlc3BvbnNlO1xuICB9XG59XG5cbi8vIGVuZHJlZ2lvblxuXG5leHBvcnQgY2xhc3MgVG9hc3ROb3RpZmljYXRpb25EZWZhdWx0UmVzcG9uc2UgZXh0ZW5kcyBUb2FzdE5vdGlmaWNhdGlvblJlc3BvbnNlIGltcGxlbWVudHMgSVByaXZhdGVSZXNwb25zZU1lcmdlZCB7XG4gIHRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nOiBUb2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZyA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIHNldEJlbG9uZ2luZyhfVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcpOiB2b2lkIHtcbiAgICB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nID0gX1RvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBUb2FzdE5vdGlmaWNhdGlvbkNhcnJpZXIge1xuICB0b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZzogVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcgPSBuZXcgVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcoKTtcblxuICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgc2V0QnV0dG9ucyhfQnV0dG9uczogSUJ1dHRvbltdKSB7XG4gICAgaWYgKF9CdXR0b25zLmxlbmd0aCkge1xuICAgICAgdGhpcy50b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZy5CdXR0b25zID0gX0J1dHRvbnM7XG4gICAgfVxuICB9XG5cbiAgc2V0VGl0bGUoX1RpdGxlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nLkRpc3BhdGNoLlRpdGxlID0gX1RpdGxlO1xuICB9XG5cbiAgc2V0TWVzc2FnZShfTWVzc2FnZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy50b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZy5EaXNwYXRjaC5NZXNzYWdlID0gX01lc3NhZ2U7XG4gIH1cblxuICBzZXRCdXR0b25MYWJlbHMoX0NvbmZpcm06IHN0cmluZywgX0RlY2xpbmU6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMudG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcuVG9hc3RDb3JlQ29uZmlnLkNvbmZpcm1MYWJlbCA9IF9Db25maXJtO1xuICAgIHRoaXMudG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcuVG9hc3RDb3JlQ29uZmlnLkRlY2xpbmVMYWJlbCA9IF9EZWNsaW5lO1xuICB9XG5cbiAgc2V0Q29uZmlnKF9Ub2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZzogSVRvYXN0Q29yZUNvbmZpZykge1xuICAgIC8vIHJlZ2lvbiAqKiogbG9jYWwgVXNlckNvbmZpZyAoZGVmaW5lZCBvbiBwbGFjZSB3aGVyZSBkaWFsb2cgaXMgY2FsbGVkKSAqKipcbiAgICBjb25zdCBkYXRhQ29udHJvbCA9IG5ldyBEYXRhQ29udHJvbCgpO1xuICAgIGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKF9Ub2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZywgdGhpcy50b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZy5Ub2FzdENvcmVDb25maWcpO1xuICAgIC8vIGVuZHJlZ2lvblxuICB9XG5cbiAgb3BlblRvYXN0Tm90aWZpY2F0aW9uJCgpOiBPYnNlcnZhYmxlPElQcml2YXRlUmVzcG9uc2VNZXJnZWQ+IHtcbiAgICBpZiAoIXRoaXMudG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcuRGlzcGF0Y2guVGl0bGUgJiYgIXRoaXMudG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcuRGlzcGF0Y2guTWVzc2FnZSkge1xuICAgICAgdGhyb3cgRXJyb3IoJ1RvYXN0IG5vdGlmaWNhdGlvbiBjYW4gbm90IGJlIHdpdGhvdXQgYm90aCBtZXNzYWdlIGFuZCB0aXRsZS4nKTtcbiAgICB9XG4gICAgY29uc3Qgc2VydmljZTogVG9hc3ROb3RpZmljYXRpb25TZXJ2aWNlID0gU2VydmljZUxvY2F0b3IuaW5qZWN0b3IuZ2V0KFRvYXN0Tm90aWZpY2F0aW9uU2VydmljZSk7XG4gICAgcmV0dXJuIHNlcnZpY2Uub3BlblRvYXN0JCh0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgR2xvYmFsVG9hc3RTZXR0aW5ncyBpbXBsZW1lbnRzIElHbG9iYWxUb2FzdFNldHRpbmdzIHtcbiAgQWxsb3dlZE5vdGlmaWNhdGlvbnNBdE9uY2U6IG51bWJlciA9IG51bGw7XG59XG5cbmV4cG9ydCBjbGFzcyBSZXNldFRvYXN0R2xvYmFsU2V0dGluZ3Mge1xuICBjb25zdHJ1Y3RvcihnbG9iYWxUb2FzdENvbmZpZz86IElHbG9iYWxUb2FzdFNldHRpbmdzKSB7XG4gICAgY29uc3QgZ2xvYmFsVG9hc3RDb25maWdTZXJ2aWNlOiBUb2FzdE5vdGlmaWNhdGlvbkNvbmZpZ1NlcnZpY2UgPSBTZXJ2aWNlTG9jYXRvci5pbmplY3Rvci5nZXQoXG4gICAgICBUb2FzdE5vdGlmaWNhdGlvbkNvbmZpZ1NlcnZpY2VcbiAgICApO1xuICAgIGlmIChnbG9iYWxUb2FzdENvbmZpZ1NlcnZpY2UpIHtcbiAgICAgIGdsb2JhbFRvYXN0Q29uZmlnU2VydmljZS5zZXRSZXNldEdsb2JhbFRvYXN0Q29uZmlnKGdsb2JhbFRvYXN0Q29uZmlnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZ2xvYmFsVG9hc3RDb25maWdTZXJ2aWNlLnNldFJlc2V0R2xvYmFsVG9hc3RDb25maWcoKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFRvYXN0U2V0dGluZ3Mge1xuICBCdXR0b25zOiBJQnV0dG9uW10gPSBbXTtcbiAgVG9hc3RDb3JlQ29uZmlnOiBJVG9hc3RDb3JlQ29uZmlnID0gbmV3IFRvYXN0Q29yZUNvbmZpZygpO1xuICBEaXNwYXRjaDogSURpc3BhdGNoID0gbmV3IERpc3BhdGNoKCk7XG4gIEdsb2JhbFNldHRpbmdzOiBHbG9iYWxUb2FzdFNldHRpbmdzID0gbmV3IEdsb2JhbFRvYXN0U2V0dGluZ3MoKTtcbn1cblxuZXhwb3J0IGNsYXNzIFRvYXN0Q29yZUNvbmZpZyBpbXBsZW1lbnRzIElUb2FzdENvcmVDb25maWcge1xuICBUb2FzdFBvc2l0aW9uOiBUb2FzdFBvc2l0aW9uRW51bSA9IG51bGw7XG4gIFByb2dyZXNzQmFyOiBUb2FzdFByb2dyZXNzQmFyRW51bSA9IG51bGw7XG4gIFRvYXN0VXNlclZpZXdUeXBlOiBUb2FzdFVzZXJWaWV3VHlwZUVudW0gPSBudWxsO1xuICBPcGVuSW5FbGVtZW50SUQ6IHN0cmluZyA9IG51bGw7XG4gIEJ1dHRvblBvc2l0aW9uOiBWZXJ0aWNhbFBvc2l0aW9uID0gbnVsbDtcbiAgVGV4dFBvc2l0aW9uOiBWZXJ0aWNhbFBvc2l0aW9uID0gbnVsbDtcbiAgTGF5b3V0VHlwZTogRGlhbG9nTGF5b3V0RGlzcGxheSA9IG51bGw7XG4gIERpc3BhdGNoOiBJRGlzcGF0Y2ggPSBudWxsO1xuICBDb25maXJtTGFiZWw6IHN0cmluZyA9IG51bGw7XG4gIERlY2xpbmVMYWJlbDogc3RyaW5nID0gbnVsbDtcbiAgQXV0b0Nsb3NlRGVsYXk6IG51bWJlciA9IG51bGw7XG4gIERpc2FibGVJY29uOiBib29sZWFuID0gbnVsbDtcbiAgQWxsb3dIVE1MTWVzc2FnZTogYm9vbGVhbiA9IG51bGw7XG4gIEFuaW1hdGlvbkluOiBBcHBlYXJhbmNlQW5pbWF0aW9uID0gbnVsbDtcbiAgQW5pbWF0aW9uT3V0OiBEaXNhcHBlYXJhbmNlQW5pbWF0aW9uID0gbnVsbDtcbn1cblxuZXhwb3J0IGNsYXNzIFRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nIGV4dGVuZHMgVG9hc3RTZXR0aW5ncyBpbXBsZW1lbnRzIElUb2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZyB7XG4gIEVudGl0eVVuaXF1ZUlEOiBzdHJpbmcgPSAnVCcgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7XG4gIEV2ZW50c0NvbnRyb2xsZXI6IFRvYXN0Tm90aWZpY2F0aW9uRXZlbnRzQ29udHJvbGxlcjtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuRXZlbnRzQ29udHJvbGxlciA9IG5ldyBUb2FzdE5vdGlmaWNhdGlvbkV2ZW50c0NvbnRyb2xsZXIodGhpcy5FbnRpdHlVbmlxdWVJRCk7XG4gICAgY29uc3QgdG9hc3ROb3RpZmljYXRpb25Db25maWd1cmF0b3I6IFRvYXN0Tm90aWZpY2F0aW9uQ29uZmlnU2VydmljZSA9IFNlcnZpY2VMb2NhdG9yLmluamVjdG9yLmdldChcbiAgICAgIFRvYXN0Tm90aWZpY2F0aW9uQ29uZmlnU2VydmljZVxuICAgICk7XG4gICAgY29uc3QgYmFzZVNldHRpbmdzID0gbmV3IFRvYXN0U2V0dGluZ3MoKTtcbiAgICBjb25zdCBkYXRhQ29udHJvbCA9IG5ldyBEYXRhQ29udHJvbCgpO1xuICAgIGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKFxuICAgICAgdG9hc3ROb3RpZmljYXRpb25Db25maWd1cmF0b3IucHJvZHVjdGlvbkNvbmZpZy5Ub2FzdENvcmVDb25maWcsXG4gICAgICBiYXNlU2V0dGluZ3MuVG9hc3RDb3JlQ29uZmlnXG4gICAgKTtcbiAgICB0aGlzLlRvYXN0Q29yZUNvbmZpZyA9IGJhc2VTZXR0aW5ncy5Ub2FzdENvcmVDb25maWc7XG4gICAgdGhpcy5CdXR0b25zID0gdG9hc3ROb3RpZmljYXRpb25Db25maWd1cmF0b3IucHJvZHVjdGlvbkNvbmZpZy5CdXR0b25zLnNsaWNlKCk7XG4gIH1cbn1cbiJdfQ==