import { ServiceLocator } from '../locator.service';
import { ButtonLayoutDisplay } from './enums';
import { GlobalConfigService } from './global-config.service';
export class Sizes {
    constructor() {
        this.width = null;
        this.minWidth = null;
        this.maxWidth = null;
        this.height = null;
        this.minHeight = null;
        this.maxHeight = null;
        this.fullScreen = null;
    }
}
export class dispatch {
    constructor() {
        this.title = null;
        this.message = null;
    }
}
export class ButtonMaker {
    constructor(label, ID, layoutType = ButtonLayoutDisplay.PRIMARY) {
        this.label = label;
        this.ID = ID;
        this.layoutType = layoutType;
    }
}
export class GlobalUserConfig {
    constructor(_GlobalUserConfig) {
        this.colorList = new ColorTypes();
        if (_GlobalUserConfig) {
            const dataControl = new DataControl();
            dataControl.copyValuesFrom(_GlobalUserConfig, this);
            const colorList = new ColorTypes();
            this.colorList = dataControl.copyValuesFrom(this.colorList, colorList);
        }
    }
}
export class ColorTypes {
    constructor() {
        this.primary = null;
        this.secondary = null;
        this.success = null;
        this.info = null;
        this.warning = null;
        this.danger = null;
        this.light = null;
        this.dark = null;
    }
}
export class ResetGlobalConfig {
    constructor(globalConfig) {
        const globalConfigService = ServiceLocator.injector.get(GlobalConfigService);
        if (globalConfig) {
            globalConfigService.setUserColors(globalConfig.colorList);
            globalConfigService.setNodeStyles(globalConfigService.productionGlobalConfig.displayColor, true);
        }
        else {
            globalConfigService.resetStyles();
        }
    }
}
export class GlobalConfig {
    constructor() {
        this.displayColor = new DisplayColor();
    }
}
export class DisplayColor {
    constructor() {
        this.primary = null;
        this.secondary = null;
        this.success = null;
        this.info = null;
        this.warning = null;
        this.danger = null;
        this.light = null;
        this.dark = null;
    }
}
export class ColorProvider {
    constructor(_Color) {
        this.Base = null;
        this.Brighten = null;
        this.BrightenForShade = null;
        this.Darken = null;
        this.DarkenForShade = null;
        this.ContrastColor = null;
        this.TransparentDarkenVariance = null;
        this.BrightShade = null;
        this.BrightWarmly = null;
        this.IsBaseBright = null;
        if ((this.Base = this.isColor(_Color))) {
            this.Brighten = this.brightness(this.Base, 'brighten', 25);
            this.BrightenForShade = this.brightness(this.Base, 'brighten', 10);
            this.Darken = this.brightness(this.Base, 'darken', 20);
            this.DarkenForShade = this.brightness(this.Base, 'darken', 10);
            const luminance = Math.floor(this.luminance(this.Base) * 100);
            const darken = luminance > 50 ? 5 : luminance > 40 ? 10 : luminance > 20 ? 15 : luminance;
            const brighten = luminance > 55 ? 65 : luminance > 45 ? 60 : luminance > 20 ? 55 : luminance > 10 ? 45 : 80;
            this.BrightShade = this.brightness(this.brightness(this.Base, 'darken', darken), 'brighten', brighten);
            this.BrightWarmly = this.brightness(this.brightness(this.saturate(this.Base), 'darken', darken - 10), 'brighten', brighten - 5);
            this.TransparentDarkenVariance = this.brightness(this.transparentize(this.Base, 80), 'darken', 40);
            if (this.isBright(this.Base)) {
                this.ContrastColor = 'rgba(58,65,71,0.5)';
                this.IsBaseBright = true;
            }
            else {
                this.ContrastColor = 'rgb(255,255,255, 0.7)';
                this.IsBaseBright = false;
            }
            /*	       console.log('%c BrightShade ', `background: ${this.BrightShade}; color: ${this.ContrastColor}`, this.BrightShade);
                                 console.log('%c BrightWarmly ', `background: ${this.BrightWarmly}; color: ${this.ContrastColor}`, this.BrightWarmly);
                                 console.log('%c Brighten ', `background: ${this.Brighten}; color: ${this.ContrastColor}`, this.Brighten);
                                 console.log('%c BrightenForShade ', `background: ${this.BrightenForShade}; color: ${this.ContrastColor}`, this.BrightenForShade);
                                 console.log('%c Base ', `background: ${this.Base}; color: ${this.ContrastColor}`, this.Base);
                                 console.log('%c DarkenForShade ', `background: ${this.DarkenForShade}; color: ${this.ContrastColor}`, this.DarkenForShade);
                                 console.log('%c Darken ', `background: ${this.Darken}; color: ${this.ContrastColor}`, this.Darken);
                                 console.log('%c TransparentDarkenVariance ', `background: ${this.TransparentDarkenVariance}; color: ${this.ContrastColor}`, this.TransparentDarkenVariance);
                  */
        }
    }
    saturate(_Rgb) {
        const rgbIntArray = this.getRGBArray(_Rgb);
        const greyVal = this.getLightnessOfRGB(_Rgb) * 55;
        const [lowest, middle, highest] = this.getLowMidHi(rgbIntArray);
        if (lowest.val === highest.val) {
            return _Rgb;
        }
        const saturationRange = Math.round(Math.min(255 - greyVal, greyVal));
        const maxChange = Math.min(255 - highest.val, lowest.val);
        const changeAmount = Math.min(saturationRange / 10, maxChange);
        const middleValueRatio = (greyVal - middle.val) / (greyVal - highest.val) + 0.07;
        const returnArray = [];
        returnArray[highest.index] = Math.round(highest.val + changeAmount);
        returnArray[lowest.index] = Math.round(lowest.val - changeAmount);
        returnArray[middle.index] = Math.round(greyVal + (returnArray[highest.index] - greyVal) * middleValueRatio + 5);
        return `rgb(${[returnArray].join()})`;
    }
    brightness(_Rgb, _Action, _Percentage) {
        const rgbIntArray = this.getRGBArray(_Rgb);
        const [lowest, middle, highest] = this.getLowMidHi(rgbIntArray);
        if (_Action === 'brighten' && lowest.val === 255) {
            return _Rgb;
        }
        if (_Action === 'darken' && highest.val === 0) {
            return _Rgb;
        }
        const amount = (_Percentage / 100) * 255;
        let returnList = [];
        if (_Action === 'brighten') {
            returnList[lowest.index] = Math.round(lowest.val + Math.min(255 - lowest.val, amount));
            const increaseFraction = (returnList[lowest.index] - lowest.val) / (255 - lowest.val);
            returnList[middle.index] = middle.val + (255 - middle.val) * increaseFraction;
            returnList[highest.index] = highest.val + (255 - highest.val) * increaseFraction;
        }
        if (_Action === 'darken') {
            returnList[highest.index] = highest.val - Math.min(highest.val, amount);
            const decreaseFraction = (highest.val - returnList[highest.index]) / highest.val;
            returnList[middle.index] = middle.val - middle.val * decreaseFraction;
            returnList[lowest.index] = lowest.val - lowest.val * decreaseFraction;
        }
        returnList = returnList.map(item => Math.round(item));
        if (rgbIntArray.length > 3) {
            returnList.push(rgbIntArray[3]);
            return `rgba(${returnList.join()})`;
        }
        return `rgb(${returnList.join()})`;
    }
    getLightnessOfRGB(_Rgb) {
        const rgbIntArray = this.getRGBArray(_Rgb);
        const highest = Math.max(...rgbIntArray);
        const lowest = Math.min(...rgbIntArray);
        return (highest + lowest) / 2 / 255;
    }
    isBright(_Rgb) {
        return this.contrast(this.luminance(_Rgb));
    }
    //
    getLowMidHi(_RgbArray) {
        const rgbArrayCopy = _RgbArray.slice();
        const rgbArrayWithoutAlpha = _RgbArray.length > 3 ? rgbArrayCopy.reverse().slice(1).reverse() : _RgbArray;
        let highest = { val: -1, index: -1 };
        let lowest = { val: Infinity, index: -1 };
        rgbArrayWithoutAlpha.map((val, index) => {
            if (val > highest.val) {
                highest = { val: val, index: index };
            }
            if (val < lowest.val) {
                lowest = { val: val, index: index };
            }
        });
        if (lowest.index === highest.index) {
            lowest.index = highest.index + 1;
        }
        const middleIndex = 3 - highest.index - lowest.index;
        const middle = {
            val: rgbArrayWithoutAlpha[middleIndex],
            index: middleIndex
        };
        return [lowest, middle, highest];
    }
    contrast(_Luminance) {
        const brightest = Math.max(1.05, _Luminance + 0.05);
        const darkest = Math.min(1.05, _Luminance + 0.05);
        const contrast = brightest / darkest;
        return contrast < 2.7;
    }
    isColor(_StrColor) {
        const CSSDeclaration = new Option().style;
        CSSDeclaration.color = _StrColor;
        return CSSDeclaration.color ? CSSDeclaration.color : null;
    }
    getRGBArray(_Rgb) {
        return _Rgb
            .replace(/^(rgb|rgba)\(/, '')
            .replace(/\)$/, '')
            .replace(/\s/g, '')
            .split(',')
            .map(x => +x);
    }
    luminance(_Rgb) {
        const rgbIntArray = this.getRGBArray(_Rgb);
        const W3algorithm = rgbIntArray.map(item => {
            item /= 255;
            return item <= 0.03928 ? item / 12.92 : Math.pow((item + 0.055) / 1.055, 2.4);
        });
        return W3algorithm[0] * 0.2126 + W3algorithm[1] * 0.7152 + W3algorithm[2] * 0.0722;
    }
    transparentize(_Rgb, _Percentage) {
        const baseArray = this.Base.replace(/^(rgb|rgba)\(/, '')
            .replace(/\)$/, '')
            .replace(/\s/g, '')
            .split(',')
            .map(x => +x);
        if (baseArray.length > 3) {
            baseArray.pop();
        }
        const amount = (100 - _Percentage) / 100;
        baseArray.push(amount);
        return `rgb(${baseArray.join()})`;
    }
}
export class DataControl {
    /**
     * @ignore
     */
    copyValuesFrom(_Data, _DestinationObject) {
        if (typeof _Data !== 'object') {
            return _DestinationObject;
        }
        const dataKeys = Object.keys(_Data);
        const destinationObjectKeys = Object.keys(_DestinationObject);
        dataKeys.forEach(key => {
            if (destinationObjectKeys.find(tKey => tKey === key || tKey === '_' + key)) {
                if (key.includes('Date')) {
                    const date = Date.parse(_Data[key]);
                    if (date) {
                        _DestinationObject[key] = new Date(date);
                    }
                    else {
                        if (_Data[key] !== null) {
                            _DestinationObject[key] = _Data[key];
                        }
                    }
                }
                else {
                    if (_Data[key] !== null) {
                        _DestinationObject[key] = _Data[key];
                    }
                }
            }
        });
        return _DestinationObject;
    }
}
export class Timer {
    constructor() {
        this.TimePassed = 0;
        this.Progress = 0;
        this.Remaining = 100;
    }
    setMilliseconds(_Milliseconds) {
        this.Milliseconds = _Milliseconds;
    }
    reset() {
        this.TimePassed = 0;
        this.Progress = 0;
    }
    pause() {
        this.TimePassed = 0;
        this.Progress = 0;
    }
    stop() {
        this.TimePassed = 0;
        clearInterval(this.Timer);
    }
    start() {
        this.Timer = setInterval(() => {
            if (this.TimePassed >= this.Milliseconds) {
                clearInterval(this.Timer);
                return;
            }
            this.TimePassed += 100;
            this.Progress = (this.TimePassed * 100) / this.Milliseconds;
            this.Remaining = 100 - this.Progress;
        }, 100);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2xvYmFsLWNsYXNzZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9uZ3gtYXdlc29tZS1wb3B1cC9jb3JlL2dsb2JhbC1jbGFzc2VzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDOUMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFHOUQsTUFBTSxPQUFPLEtBQUs7SUFBbEI7UUFDRSxVQUFLLEdBQVcsSUFBSSxDQUFDO1FBQ3JCLGFBQVEsR0FBVyxJQUFJLENBQUM7UUFDeEIsYUFBUSxHQUFXLElBQUksQ0FBQztRQUN4QixXQUFNLEdBQVcsSUFBSSxDQUFDO1FBQ3RCLGNBQVMsR0FBVyxJQUFJLENBQUM7UUFDekIsY0FBUyxHQUFXLElBQUksQ0FBQztRQUN6QixlQUFVLEdBQVksSUFBSSxDQUFDO0lBQzdCLENBQUM7Q0FBQTtBQUVELE1BQU0sT0FBTyxRQUFRO0lBQXJCO1FBQ0UsVUFBSyxHQUFXLElBQUksQ0FBQztRQUNyQixZQUFPLEdBQVcsSUFBSSxDQUFDO0lBQ3pCLENBQUM7Q0FBQTtBQUVELE1BQU0sT0FBTyxXQUFXO0lBQ3RCLFlBQ1MsS0FBYSxFQUNiLEVBQVUsRUFDVixhQUFrQyxtQkFBbUIsQ0FBQyxPQUFPO1FBRjdELFVBQUssR0FBTCxLQUFLLENBQVE7UUFDYixPQUFFLEdBQUYsRUFBRSxDQUFRO1FBQ1YsZUFBVSxHQUFWLFVBQVUsQ0FBbUQ7SUFDbkUsQ0FBQztDQUNMO0FBRUQsTUFBTSxPQUFPLGdCQUFnQjtJQUczQixZQUFZLGlCQUFvQztRQUZoRCxjQUFTLEdBQWdCLElBQUksVUFBVSxFQUFFLENBQUM7UUFHeEMsSUFBSSxpQkFBaUIsRUFBRTtZQUNyQixNQUFNLFdBQVcsR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFD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QUFVLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDL0QsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztZQUM5RCxNQUFNLE1BQU0sR0FBRyxTQUFTLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFDMUYsTUFBTSxRQUFRLEdBQUcsU0FBUyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDNUcsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUUsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQ3ZHLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FDakMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxRQUFRLEVBQUUsTUFBTSxHQUFHLEVBQUUsQ0FBQyxFQUNoRSxVQUFVLEVBQ1YsUUFBUSxHQUFHLENBQUMsQ0FDYixDQUFDO1lBQ0YsSUFBSSxDQUFD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dG9yLnNlcnZpY2UnO1xuaW1wb3J0IHsgQnV0dG9uTGF5b3V0RGlzcGxheSB9IGZyb20gJy4vZW51bXMnO1xuaW1wb3J0IHsgR2xvYmFsQ29uZmlnU2VydmljZSB9IGZyb20gJy4vZ2xvYmFsLWNvbmZpZy5zZXJ2aWNlJztcbmltcG9ydCB7IElCdXR0b24sIElDb2xvck9iamVjdCwgSUNvbG9yVHlwZXMsIElHbG9iYWxDb25maWcsIElHbG9iYWxVc2VyQ29uZmlnLCBJU2l6ZXMgfSBmcm9tICcuL2dsb2JhbC1pbnRlcmZhY2VzJztcblxuZXhwb3J0IGNsYXNzIFNpemVzIGltcGxlbWVudHMgSVNpemVzIHtcbiAgd2lkdGg6IHN0cmluZyA9IG51bGw7XG4gIG1pbldpZHRoOiBzdHJpbmcgPSBudWxsO1xuICBtYXhXaWR0aDogc3RyaW5nID0gbnVsbDtcbiAgaGVpZ2h0OiBzdHJpbmcgPSBudWxsO1xuICBtaW5IZWlnaHQ6IHN0cmluZyA9IG51bGw7XG4gIG1heEhlaWdodDogc3RyaW5nID0gbnVsbDtcbiAgZnVsbFNjcmVlbjogYm9vbGVhbiA9IG51bGw7XG59XG5cbmV4cG9ydCBjbGFzcyBkaXNwYXRjaCB7XG4gIHRpdGxlOiBzdHJpbmcgPSBudWxsO1xuICBtZXNzYWdlOiBzdHJpbmcgPSBudWxsO1xufVxuXG5leHBvcnQgY2xhc3MgQnV0dG9uTWFrZXIgaW1wbGVtZW50cyBJQnV0dG9uIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGxhYmVsOiBzdHJpbmcsXG4gICAgcHVibGljIElEOiBzdHJpbmcsXG4gICAgcHVibGljIGxheW91dFR5cGU6IEJ1dHRvbkxheW91dERpc3BsYXkgPSBCdXR0b25MYXlvdXREaXNwbGF5LlBSSU1BUllcbiAgKSB7fVxufVxuXG5leHBvcnQgY2xhc3MgR2xvYmFsVXNlckNvbmZpZyBpbXBsZW1lbnRzIElHbG9iYWxVc2VyQ29uZmlnIHtcbiAgY29sb3JMaXN0OiBJQ29sb3JUeXBlcyA9IG5ldyBDb2xvclR5cGVzKCk7XG5cbiAgY29uc3RydWN0b3IoX0dsb2JhbFVzZXJDb25maWc6IElHbG9iYWxVc2VyQ29uZmlnKSB7XG4gICAgaWYgKF9HbG9iYWxVc2VyQ29uZmlnKSB7XG4gICAgICBjb25zdCBkYXRhQ29udHJvbCA9IG5ldyBEYXRhQ29udHJvbCgpO1xuICAgICAgZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20oX0dsb2JhbFVzZXJDb25maWcsIHRoaXMpO1xuICAgICAgY29uc3QgY29sb3JMaXN0ID0gbmV3IENvbG9yVHlwZXMoKTtcbiAgICAgIHRoaXMuY29sb3JMaXN0ID0gZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20odGhpcy5jb2xvckxpc3QsIGNvbG9yTGlzdCk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDb2xvclR5cGVzIGltcGxlbWVudHMgSUNvbG9yVHlwZXMge1xuICBwcmltYXJ5OiBzdHJpbmcgPSBudWxsO1xuICBzZWNvbmRhcnk6IHN0cmluZyA9IG51bGw7XG4gIHN1Y2Nlc3M6IHN0cmluZyA9IG51bGw7XG4gIGluZm86IHN0cmluZyA9IG51bGw7XG4gIHdhcm5pbmc6IHN0cmluZyA9IG51bGw7XG4gIGRhbmdlcjogc3RyaW5nID0gbnVsbDtcbiAgbGlnaHQ6IHN0cmluZyA9IG51bGw7XG4gIGRhcms6IHN0cmluZyA9IG51bGw7XG59XG5cbmV4cG9ydCBjbGFzcyBSZXNldEdsb2JhbENvbmZpZyB7XG4gIGNvbnN0cnVjdG9yKGdsb2JhbENvbmZpZz86IElHbG9iYWxVc2VyQ29uZmlnKSB7XG4gICAgY29uc3QgZ2xvYmFsQ29uZmlnU2VydmljZTogR2xvYmFsQ29uZmlnU2VydmljZSA9IFNlcnZpY2VMb2NhdG9yLmluamVjdG9yLmdldChHbG9iYWxDb25maWdTZXJ2aWNlKTtcbiAgICBpZiAoZ2xvYmFsQ29uZmlnKSB7XG4gICAgICBnbG9iYWxDb25maWdTZXJ2aWNlLnNldFVzZXJDb2xvcnMoZ2xvYmFsQ29uZmlnLmNvbG9yTGlzdCk7XG4gICAgICBnbG9iYWxDb25maWdTZXJ2aWNlLnNldE5vZGVTdHlsZXMoZ2xvYmFsQ29uZmlnU2VydmljZS5wcm9kdWN0aW9uR2xvYmFsQ29uZmlnLmRpc3BsYXlDb2xvciwgdHJ1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGdsb2JhbENvbmZpZ1NlcnZpY2UucmVzZXRTdHlsZXMoKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEdsb2JhbENvbmZpZyBpbXBsZW1lbnRzIElHbG9iYWxDb25maWcge1xuICBkaXNwbGF5Q29sb3I6IElDb2xvck9iamVjdCA9IG5ldyBEaXNwbGF5Q29sb3IoKTtcbn1cblxuZXhwb3J0IGNsYXNzIERpc3BsYXlDb2xvciBpbXBsZW1lbnRzIElDb2xvck9iamVjdCB7XG4gIHByaW1hcnk6IENvbG9yUHJvdmlkZXIgPSBudWxsO1xuICBzZWNvbmRhcnk6IENvbG9yUHJvdmlkZXIgPSBudWxsO1xuICBzdWNjZXNzOiBDb2xvclByb3ZpZGVyID0gbnVsbDtcbiAgaW5mbzogQ29sb3JQcm92aWRlciA9IG51bGw7XG4gIHdhcm5pbmc6IENvbG9yUHJvdmlkZXIgPSBudWxsO1xuICBkYW5nZXI6IENvbG9yUHJvdmlkZXIgPSBudWxsO1xuICBsaWdodDogQ29sb3JQcm92aWRlciA9IG51bGw7XG4gIGRhcms6IENvbG9yUHJvdmlkZXIgPSBudWxsO1xufVxuXG5leHBvcnQgY2xhc3MgQ29sb3JQcm92aWRlciB7XG4gIEJhc2U6IHN0cmluZyA9IG51bGw7XG4gIEJyaWdodGVuOiBzdHJpbmcgPSBudWxsO1xuICBCcmlnaHRlbkZvclNoYWRlOiBzdHJpbmcgPSBudWxsO1xuICBEYXJrZW46IHN0cmluZyA9IG51bGw7XG4gIERhcmtlbkZvclNoYWRlOiBzdHJpbmcgPSBudWxsO1xuICBDb250cmFzdENvbG9yOiBzdHJpbmcgPSBudWxsO1xuICBUcmFuc3BhcmVudERhcmtlblZhcmlhbmNlOiBzdHJpbmcgPSBudWxsO1xuICBCcmlnaHRTaGFkZTogc3RyaW5nID0gbnVsbDtcbiAgQnJpZ2h0V2FybWx5OiBzdHJpbmcgPSBudWxsO1xuICBJc0Jhc2VCcmlnaHQ6IGJvb2xlYW4gPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKF9Db2xvcjogc3RyaW5nKSB7XG4gICAgaWYgKCh0aGlzLkJhc2UgPSB0aGlzLmlzQ29sb3IoX0NvbG9yKSkpIHtcbiAgICAgIHRoaXMuQnJpZ2h0ZW4gPSB0aGlzLmJyaWdodG5lc3ModGhpcy5CYXNlLCAnYnJpZ2h0ZW4nLCAyNSk7XG4gICAgICB0aGlzLkJyaWdodGVuRm9yU2hhZGUgPSB0aGlzLmJyaWdodG5lc3ModGhpcy5CYXNlLCAnYnJpZ2h0ZW4nLCAxMCk7XG4gICAgICB0aGlzLkRhcmtlbiA9IHRoaXMuYnJpZ2h0bmVzcyh0aGlzLkJhc2UsICdkYXJrZW4nLCAyMCk7XG4gICAgICB0aGlzLkRhcmtlbkZvclNoYWRlID0gdGhpcy5icmlnaHRuZXNzKHRoaXMuQmFzZSwgJ2RhcmtlbicsIDEwKTtcbiAgICAgIGNvbnN0IGx1bWluYW5jZSA9IE1hdGguZmxvb3IodGhpcy5sdW1pbmFuY2UodGhpcy5CYXNlKSAqIDEwMCk7XG4gICAgICBjb25zdCBkYXJrZW4gPSBsdW1pbmFuY2UgPiA1MCA/IDUgOiBsdW1pbmFuY2UgPiA0MCA/IDEwIDogbHVtaW5hbmNlID4gMjAgPyAxNSA6IGx1bWluYW5jZTtcbiAgICAgIGNvbnN0IGJyaWdodGVuID0gbHVtaW5hbmNlID4gNTUgPyA2NSA6IGx1bWluYW5jZSA+IDQ1ID8gNjAgOiBsdW1pbmFuY2UgPiAyMCA/IDU1IDogbHVtaW5hbmNlID4gMTAgPyA0NSA6IDgwO1xuICAgICAgdGhpcy5CcmlnaHRTaGFkZSA9IHRoaXMuYnJpZ2h0bmVzcyh0aGlzLmJyaWdodG5lc3ModGhpcy5CYXNlLCAnZGFya2VuJywgZGFya2VuKSwgJ2JyaWdodGVuJywgYnJpZ2h0ZW4pO1xuICAgICAgdGhpcy5CcmlnaHRXYXJtbHkgPSB0aGlzLmJyaWdodG5lc3MoXG4gICAgICAgIHRoaXMuYnJpZ2h0bmVzcyh0aGlzLnNhdHVyYXRlKHRoaXMuQmFzZSksICdkYXJrZW4nLCBkYXJrZW4gLSAxMCksXG4gICAgICAgICdicmlnaHRlbicsXG4gICAgICAgIGJyaWdodGVuIC0gNVxuICAgICAgKTtcbiAgICAgIHRoaXMuVHJhbnNwYXJlbnREYXJrZW5WYXJpYW5jZSA9IHRoaXMuYnJpZ2h0bmVzcyh0aGlzLnRyYW5zcGFyZW50aXplKHRoaXMuQmFzZSwgODApLCAnZGFya2VuJywgNDApO1xuICAgICAgaWYgKHRoaXMuaXNCcmlnaHQodGhpcy5CYXNlKSkge1xuICAgICAgICB0aGlzLkNvbnRyYXN0Q29sb3IgPSAncmdiYSg1OCw2NSw3MSwwLjUpJztcbiAgICAgICAgdGhpcy5Jc0Jhc2VCcmlnaHQgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5Db250cmFzdENvbG9yID0gJ3JnYigyNTUsMjU1LDI1NSwgMC43KSc7XG4gICAgICAgIHRoaXMuSXNCYXNlQnJpZ2h0ID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIC8qXHQgICAgICAgY29uc29sZS5sb2coJyVjIEJyaWdodFNoYWRlICcsIGBiYWNrZ3JvdW5kOiAke3RoaXMuQnJpZ2h0U2hhZGV9OyBjb2xvcjogJHt0aGlzLkNvbnRyYXN0Q29sb3J9YCwgdGhpcy5CcmlnaHRTaGFkZSk7XG5cdFx0XHRcdFx0ICAgICAgIGNvbnNvbGUubG9nKCclYyBCcmlnaHRXYXJtbHkgJywgYGJhY2tncm91bmQ6ICR7dGhpcy5CcmlnaHRXYXJtbHl9OyBjb2xvcjogJHt0aGlzLkNvbnRyYXN0Q29sb3J9YCwgdGhpcy5CcmlnaHRXYXJtbHkpO1xuXHRcdFx0XHRcdFx0ICAgY29uc29sZS5sb2coJyVjIEJyaWdodGVuICcsIGBiYWNrZ3JvdW5kOiAke3RoaXMuQnJpZ2h0ZW59OyBjb2xvcjogJHt0aGlzLkNvbnRyYXN0Q29sb3J9YCwgdGhpcy5CcmlnaHRlbik7XG5cdFx0XHRcdFx0XHQgICBjb25zb2xlLmxvZygnJWMgQnJpZ2h0ZW5Gb3JTaGFkZSAnLCBgYmFja2dyb3VuZDogJHt0aGlzLkJyaWdodGVuRm9yU2hhZGV9OyBjb2xvcjogJHt0aGlzLkNvbnRyYXN0Q29sb3J9YCwgdGhpcy5CcmlnaHRlbkZvclNoYWRlKTtcblx0XHRcdFx0XHQgICAgICAgY29uc29sZS5sb2coJyVjIEJhc2UgJywgYGJhY2tncm91bmQ6ICR7dGhpcy5CYXNlfTsgY29sb3I6ICR7dGhpcy5Db250cmFzdENvbG9yfWAsIHRoaXMuQmFzZSk7XG5cdFx0XHRcdFx0ICAgICAgIGNvbnNvbGUubG9nKCclYyBEYXJrZW5Gb3JTaGFkZSAnLCBgYmFja2dyb3VuZDogJHt0aGlzLkRhcmtlbkZvclNoYWRlfTsgY29sb3I6ICR7dGhpcy5Db250cmFzdENvbG9yfWAsIHRoaXMuRGFya2VuRm9yU2hhZGUpO1xuXHRcdFx0XHRcdCAgICAgICBjb25zb2xlLmxvZygnJWMgRGFya2VuICcsIGBiYWNrZ3JvdW5kOiAke3RoaXMuRGFya2VufTsgY29sb3I6ICR7dGhpcy5Db250cmFzdENvbG9yfWAsIHRoaXMuRGFya2VuKTtcblx0XHRcdFx0XHRcdCAgIGNvbnNvbGUubG9nKCclYyBUcmFuc3BhcmVudERhcmtlblZhcmlhbmNlICcsIGBiYWNrZ3JvdW5kOiAke3RoaXMuVHJhbnNwYXJlbnREYXJrZW5WYXJpYW5jZX07IGNvbG9yOiAke3RoaXMuQ29udHJhc3RDb2xvcn1gLCB0aGlzLlRyYW5zcGFyZW50RGFya2VuVmFyaWFuY2UpO1xuXHRcdFx0Ki9cbiAgICB9XG4gIH1cblxuICBzYXR1cmF0ZShfUmdiOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHJnYkludEFycmF5ID0gdGhpcy5nZXRSR0JBcnJheShfUmdiKTtcbiAgICBjb25zdCBncmV5VmFsID0gdGhpcy5nZXRMaWdodG5lc3NPZlJHQihfUmdiKSAqIDU1O1xuICAgIGNvbnN0IFtsb3dlc3QsIG1pZGRsZSwgaGlnaGVzdF0gPSB0aGlzLmdldExvd01pZEhpKHJnYkludEFycmF5KTtcblxuICAgIGlmIChsb3dlc3QudmFsID09PSBoaWdoZXN0LnZhbCkge1xuICAgICAgcmV0dXJuIF9SZ2I7XG4gICAgfVxuXG4gICAgY29uc3Qgc2F0dXJhdGlvblJhbmdlID0gTWF0aC5yb3VuZChNYXRoLm1pbigyNTUgLSBncmV5VmFsLCBncmV5VmFsKSk7XG4gICAgY29uc3QgbWF4Q2hhbmdlID0gTWF0aC5taW4oMjU1IC0gaGlnaGVzdC52YWwsIGxvd2VzdC52YWwpO1xuICAgIGNvbnN0IGNoYW5nZUFtb3VudCA9IE1hdGgubWluKHNhdHVyYXRpb25SYW5nZSAvIDEwLCBtYXhDaGFuZ2UpO1xuICAgIGNvbnN0IG1pZGRsZVZhbHVlUmF0aW8gPSAoZ3JleVZhbCAtIG1pZGRsZS52YWwpIC8gKGdyZXlWYWwgLSBoaWdoZXN0LnZhbCkgKyAwLjA3O1xuXG4gICAgY29uc3QgcmV0dXJuQXJyYXkgPSBbXTtcbiAgICByZXR1cm5BcnJheVtoaWdoZXN0LmluZGV4XSA9IE1hdGgucm91bmQoaGlnaGVzdC52YWwgKyBjaGFuZ2VBbW91bnQpO1xuICAgIHJldHVybkFycmF5W2xvd2VzdC5pbmRleF0gPSBNYXRoLnJvdW5kKGxvd2VzdC52YWwgLSBjaGFuZ2VBbW91bnQpO1xuICAgIHJldHVybkFycmF5W21pZGRsZS5pbmRleF0gPSBNYXRoLnJvdW5kKGdyZXlWYWwgKyAocmV0dXJuQXJyYXlbaGlnaGVzdC5pbmRleF0gLSBncmV5VmFsKSAqIG1pZGRsZVZhbHVlUmF0aW8gKyA1KTtcbiAgICByZXR1cm4gYHJnYigke1tyZXR1cm5BcnJheV0uam9pbigpfSlgO1xuICB9XG5cbiAgcHVibGljIGJyaWdodG5lc3MoX1JnYjogc3RyaW5nLCBfQWN0aW9uOiAnYnJpZ2h0ZW4nIHwgJ2RhcmtlbicsIF9QZXJjZW50YWdlOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGNvbnN0IHJnYkludEFycmF5ID0gdGhpcy5nZXRSR0JBcnJheShfUmdiKTtcbiAgICBjb25zdCBbbG93ZXN0LCBtaWRkbGUsIGhpZ2hlc3RdID0gdGhpcy5nZXRMb3dNaWRIaShyZ2JJbnRBcnJheSk7XG5cbiAgICBpZiAoX0FjdGlvbiA9PT0gJ2JyaWdodGVuJyAmJiBsb3dlc3QudmFsID09PSAyNTUpIHtcbiAgICAgIHJldHVybiBfUmdiO1xuICAgIH1cblxuICAgIGlmIChfQWN0aW9uID09PSAnZGFya2VuJyAmJiBoaWdoZXN0LnZhbCA9PT0gMCkge1xuICAgICAgcmV0dXJuIF9SZ2I7XG4gICAgfVxuXG4gICAgY29uc3QgYW1vdW50ID0gKF9QZXJjZW50YWdlIC8gMTAwKSAqIDI1NTtcblxuICAgIGxldCByZXR1cm5MaXN0ID0gW107XG5cbiAgICBpZiAoX0FjdGlvbiA9PT0gJ2JyaWdodGVuJykge1xuICAgICAgcmV0dXJuTGlzdFtsb3dlc3QuaW5kZXhdID0gTWF0aC5yb3VuZChsb3dlc3QudmFsICsgTWF0aC5taW4oMjU1IC0gbG93ZXN0LnZhbCwgYW1vdW50KSk7XG4gICAgICBjb25zdCBpbmNyZWFzZUZyYWN0aW9uID0gKHJldHVybkxpc3RbbG93ZXN0LmluZGV4XSAtIGxvd2VzdC52YWwpIC8gKDI1NSAtIGxvd2VzdC52YWwpO1xuICAgICAgcmV0dXJuTGlzdFttaWRkbGUuaW5kZXhdID0gbWlkZGxlLnZhbCArICgyNTUgLSBtaWRkbGUudmFsKSAqIGluY3JlYXNlRnJhY3Rpb247XG4gICAgICByZXR1cm5MaXN0W2hpZ2hlc3QuaW5kZXhdID0gaGlnaGVzdC52YWwgKyAoMjU1IC0gaGlnaGVzdC52YWwpICogaW5jcmVhc2VGcmFjdGlvbjtcbiAgICB9XG4gICAgaWYgKF9BY3Rpb24gPT09ICdkYXJrZW4nKSB7XG4gICAgICByZXR1cm5MaXN0W2hpZ2hlc3QuaW5kZXhdID0gaGlnaGVzdC52YWwgLSBNYXRoLm1pbihoaWdoZXN0LnZhbCwgYW1vdW50KTtcbiAgICAgIGNvbnN0IGRlY3JlYXNlRnJhY3Rpb24gPSAoaGlnaGVzdC52YWwgLSByZXR1cm5MaXN0W2hpZ2hlc3QuaW5kZXhdKSAvIGhpZ2hlc3QudmFsO1xuICAgICAgcmV0dXJuTGlzdFttaWRkbGUuaW5kZXhdID0gbWlkZGxlLnZhbCAtIG1pZGRsZS52YWwgKiBkZWNyZWFzZUZyYWN0aW9uO1xuICAgICAgcmV0dXJuTGlzdFtsb3dlc3QuaW5kZXhdID0gbG93ZXN0LnZhbCAtIGxvd2VzdC52YWwgKiBkZWNyZWFzZUZyYWN0aW9uO1xuICAgIH1cblxuICAgIHJldHVybkxpc3QgPSByZXR1cm5MaXN0Lm1hcChpdGVtID0+IE1hdGgucm91bmQoaXRlbSkpO1xuICAgIGlmIChyZ2JJbnRBcnJheS5sZW5ndGggPiAzKSB7XG4gICAgICByZXR1cm5MaXN0LnB1c2gocmdiSW50QXJyYXlbM10pO1xuICAgICAgcmV0dXJuIGByZ2JhKCR7cmV0dXJuTGlzdC5qb2luKCl9KWA7XG4gICAgfVxuICAgIHJldHVybiBgcmdiKCR7cmV0dXJuTGlzdC5qb2luKCl9KWA7XG4gIH1cblxuICBnZXRMaWdodG5lc3NPZlJHQihfUmdiOiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGNvbnN0IHJnYkludEFycmF5ID0gdGhpcy5nZXRSR0JBcnJheShfUmdiKTtcblxuICAgIGNvbnN0IGhpZ2hlc3QgPSBNYXRoLm1heCguLi5yZ2JJbnRBcnJheSk7XG4gICAgY29uc3QgbG93ZXN0ID0gTWF0aC5taW4oLi4ucmdiSW50QXJyYXkpO1xuICAgIHJldHVybiAoaGlnaGVzdCArIGxvd2VzdCkgLyAyIC8gMjU1O1xuICB9XG5cbiAgcHJpdmF0ZSBpc0JyaWdodChfUmdiOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5jb250cmFzdCh0aGlzLmx1bWluYW5jZShfUmdiKSk7XG4gIH1cblxuICAvL1xuICBwcml2YXRlIGdldExvd01pZEhpKF9SZ2JBcnJheTogbnVtYmVyW10pOiB7IGluZGV4OiBudW1iZXI7IHZhbDogbnVtYmVyIH1bXSB7XG4gICAgY29uc3QgcmdiQXJyYXlDb3B5ID0gX1JnYkFycmF5LnNsaWNlKCk7XG4gICAgY29uc3QgcmdiQXJyYXlXaXRob3V0QWxwaGEgPSBfUmdiQXJyYXkubGVuZ3RoID4gMyA/IHJnYkFycmF5Q29weS5yZXZlcnNlKCkuc2xpY2UoMSkucmV2ZXJzZSgpIDogX1JnYkFycmF5O1xuICAgIGxldCBoaWdoZXN0ID0geyB2YWw6IC0xLCBpbmRleDogLTEgfTtcbiAgICBsZXQgbG93ZXN0ID0geyB2YWw6IEluZmluaXR5LCBpbmRleDogLTEgfTtcblxuICAgIHJnYkFycmF5V2l0aG91dEFscGhhLm1hcCgodmFsLCBpbmRleCkgPT4ge1xuICAgICAgaWYgKHZhbCA+IGhpZ2hlc3QudmFsKSB7XG4gICAgICAgIGhpZ2hlc3QgPSB7IHZhbDogdmFsLCBpbmRleDogaW5kZXggfTtcbiAgICAgIH1cbiAgICAgIGlmICh2YWwgPCBsb3dlc3QudmFsKSB7XG4gICAgICAgIGxvd2VzdCA9IHsgdmFsOiB2YWwsIGluZGV4OiBpbmRleCB9O1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKGxvd2VzdC5pbmRleCA9PT0gaGlnaGVzdC5pbmRleCkge1xuICAgICAgbG93ZXN0LmluZGV4ID0gaGlnaGVzdC5pbmRleCArIDE7XG4gICAgfVxuXG4gICAgY29uc3QgbWlkZGxlSW5kZXggPSAzIC0gaGlnaGVzdC5pbmRleCAtIGxvd2VzdC5pbmRleDtcbiAgICBjb25zdCBtaWRkbGUgPSB7XG4gICAgICB2YWw6IHJnYkFycmF5V2l0aG91dEFscGhhW21pZGRsZUluZGV4XSxcbiAgICAgIGluZGV4OiBtaWRkbGVJbmRleFxuICAgIH07XG4gICAgcmV0dXJuIFtsb3dlc3QsIG1pZGRsZSwgaGlnaGVzdF07XG4gIH1cblxuICBwcml2YXRlIGNvbnRyYXN0KF9MdW1pbmFuY2UpOiBib29sZWFuIHtcbiAgICBjb25zdCBicmlnaHRlc3QgPSBNYXRoLm1heCgxLjA1LCBfTHVtaW5hbmNlICsgMC4wNSk7XG4gICAgY29uc3QgZGFya2VzdCA9IE1hdGgubWluKDEuMDUsIF9MdW1pbmFuY2UgKyAwLjA1KTtcbiAgICBjb25zdCBjb250cmFzdCA9IGJyaWdodGVzdCAvIGRhcmtlc3Q7XG4gICAgcmV0dXJuIGNvbnRyYXN0IDwgMi43O1xuICB9XG5cbiAgcHJpdmF0ZSBpc0NvbG9yKF9TdHJDb2xvcik6IHN0cmluZyB7XG4gICAgY29uc3QgQ1NTRGVjbGFyYXRpb24gPSBuZXcgT3B0aW9uKCkuc3R5bGU7XG4gICAgQ1NTRGVjbGFyYXRpb24uY29sb3IgPSBfU3RyQ29sb3I7XG4gICAgcmV0dXJuIENTU0RlY2xhcmF0aW9uLmNvbG9yID8gQ1NTRGVjbGFyYXRpb24uY29sb3IgOiBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRSR0JBcnJheShfUmdiOiBzdHJpbmcpOiBudW1iZXJbXSB7XG4gICAgcmV0dXJuIF9SZ2JcbiAgICAgIC5yZXBsYWNlKC9eKHJnYnxyZ2JhKVxcKC8sICcnKVxuICAgICAgLnJlcGxhY2UoL1xcKSQvLCAnJylcbiAgICAgIC5yZXBsYWNlKC9cXHMvZywgJycpXG4gICAgICAuc3BsaXQoJywnKVxuICAgICAgLm1hcCh4ID0+ICt4KTtcbiAgfVxuXG4gIHByaXZhdGUgbHVtaW5hbmNlKF9SZ2I6IHN0cmluZyk6IG51bWJlciB7XG4gICAgY29uc3QgcmdiSW50QXJyYXkgPSB0aGlzLmdldFJHQkFycmF5KF9SZ2IpO1xuICAgIGNvbnN0IFczYWxnb3JpdGhtID0gcmdiSW50QXJyYXkubWFwKGl0ZW0gPT4ge1xuICAgICAgaXRlbSAvPSAyNTU7XG4gICAgICByZXR1cm4gaXRlbSA8PSAwLjAzOTI4ID8gaXRlbSAvIDEyLjkyIDogTWF0aC5wb3coKGl0ZW0gKyAwLjA1NSkgLyAxLjA1NSwgMi40KTtcbiAgICB9KTtcbiAgICByZXR1cm4gVzNhbGdvcml0aG1bMF0gKiAwLjIxMjYgKyBXM2FsZ29yaXRobVsxXSAqIDAuNzE1MiArIFczYWxnb3JpdGhtWzJdICogMC4wNzIyO1xuICB9XG5cbiAgcHJpdmF0ZSB0cmFuc3BhcmVudGl6ZShfUmdiOiBzdHJpbmcsIF9QZXJjZW50YWdlOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGNvbnN0IGJhc2VBcnJheSA9IHRoaXMuQmFzZS5yZXBsYWNlKC9eKHJnYnxyZ2JhKVxcKC8sICcnKVxuICAgICAgLnJlcGxhY2UoL1xcKSQvLCAnJylcbiAgICAgIC5yZXBsYWNlKC9cXHMvZywgJycpXG4gICAgICAuc3BsaXQoJywnKVxuICAgICAgLm1hcCh4ID0+ICt4KTtcbiAgICBpZiAoYmFzZUFycmF5Lmxlbmd0aCA+IDMpIHtcbiAgICAgIGJhc2VBcnJheS5wb3AoKTtcbiAgICB9XG4gICAgY29uc3QgYW1vdW50ID0gKDEwMCAtIF9QZXJjZW50YWdlKSAvIDEwMDtcbiAgICBiYXNlQXJyYXkucHVzaChhbW91bnQpO1xuICAgIHJldHVybiBgcmdiKCR7YmFzZUFycmF5LmpvaW4oKX0pYDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgRGF0YUNvbnRyb2wge1xuICAvKipcbiAgICogQGlnbm9yZVxuICAgKi9cbiAgcHVibGljIGNvcHlWYWx1ZXNGcm9tKF9EYXRhOiBhbnksIF9EZXN0aW5hdGlvbk9iamVjdDogYW55KTogYW55IHtcbiAgICBpZiAodHlwZW9mIF9EYXRhICE9PSAnb2JqZWN0Jykge1xuICAgICAgcmV0dXJuIF9EZXN0aW5hdGlvbk9iamVjdDtcbiAgICB9XG5cbiAgICBjb25zdCBkYXRhS2V5cyA9IE9iamVjdC5rZXlzKF9EYXRhKTtcbiAgICBjb25zdCBkZXN0aW5hdGlvbk9iamVjdEtleXMgPSBPYmplY3Qua2V5cyhfRGVzdGluYXRpb25PYmplY3QpO1xuXG4gICAgZGF0YUtleXMuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgaWYgKGRlc3RpbmF0aW9uT2JqZWN0S2V5cy5maW5kKHRLZXkgPT4gdEtleSA9PT0ga2V5IHx8IHRLZXkgPT09ICdfJyArIGtleSkpIHtcbiAgICAgICAgaWYgKGtleS5pbmNsdWRlcygnRGF0ZScpKSB7XG4gICAgICAgICAgY29uc3QgZGF0ZSA9IERhdGUucGFyc2UoX0RhdGFba2V5XSk7XG4gICAgICAgICAgaWYgKGRhdGUpIHtcbiAgICAgICAgICAgIF9EZXN0aW5hdGlvbk9iamVjdFtrZXldID0gbmV3IERhdGUoZGF0ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChfRGF0YVtrZXldICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgIF9EZXN0aW5hdGlvbk9iamVjdFtrZXldID0gX0RhdGFba2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKF9EYXRhW2tleV0gIT09IG51bGwpIHtcbiAgICAgICAgICAgIF9EZXN0aW5hdGlvbk9iamVjdFtrZXldID0gX0RhdGFba2V5XTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBfRGVzdGluYXRpb25PYmplY3Q7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFRpbWVyIHtcbiAgVGltZVBhc3NlZCA9IDA7XG4gIFRpbWVyOiBhbnk7XG4gIFByb2dyZXNzID0gMDtcbiAgUmVtYWluaW5nID0gMTAwO1xuICBNaWxsaXNlY29uZHM6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgc2V0TWlsbGlzZWNvbmRzKF9NaWxsaXNlY29uZHM6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuTWlsbGlzZWNvbmRzID0gX01pbGxpc2Vjb25kcztcbiAgfVxuXG4gIHJlc2V0KCk6IHZvaWQge1xuICAgIHRoaXMuVGltZVBhc3NlZCA9IDA7XG4gICAgdGhpcy5Qcm9ncmVzcyA9IDA7XG4gIH1cblxuICBwYXVzZSgpOiB2b2lkIHtcbiAgICB0aGlzLlRpbWVQYXNzZWQgPSAwO1xuICAgIHRoaXMuUHJvZ3Jlc3MgPSAwO1xuICB9XG5cbiAgc3RvcCgpOiB2b2lkIHtcbiAgICB0aGlzLlRpbWVQYXNzZWQgPSAwO1xuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5UaW1lcik7XG4gIH1cblxuICBzdGFydCgpOiB2b2lkIHtcbiAgICB0aGlzLlRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuVGltZVBhc3NlZCA+PSB0aGlzLk1pbGxpc2Vjb25kcykge1xuICAgICAgICBjbGVhckludGVydmFsKHRoaXMuVGltZXIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLlRpbWVQYXNzZWQgKz0gMTAwO1xuICAgICAgdGhpcy5Qcm9ncmVzcyA9ICh0aGlzLlRpbWVQYXNzZWQgKiAxMDApIC8gdGhpcy5NaWxsaXNlY29uZHM7XG4gICAgICB0aGlzLlJlbWFpbmluZyA9IDEwMCAtIHRoaXMuUHJvZ3Jlc3M7XG4gICAgfSwgMTAwKTtcbiAgfVxufVxuIl19